<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>TopGit &#x2013; A Different Patch Queue Manager</title>
<meta charset="utf-8" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
/* <![CDATA[
 *
 * Style sheet for TopGit topgit.html documentation
 * Copyright (C) 2021,2025 Kyle J. McKay
 * All rights reserved
 * License GPL2
 *
 */

body {
	font-family: Times, Liberation Serif, Times New Roman, Source Serif 4, serif;
	font-size: medium;
	font-weight: normal;
}
h1, h2, h3, th.field-name, a.reference.internal {
	font-family: Helvetica, Liberation Sans, Arial, Public Sans, sans-serif;
	font-weight: normal;
}
h1 {
	font-size: large;
	margin-top: 1.25em;
	margin-bottom: 0.75em;
}
h1.title {
	font-size: xx-large;
	text-align: center;
	margin-top: 1em;
	margin-bottom: 1em;
}
h2 {
	font-size: medium;
	margin-top: 1em;
	margin-bottom: 1em;
	font-variant: small-caps;
}
div#usage h2 {
	margin-top: 1.25em;
	margin-bottom: 0.75em;
	font-variant: normal;
	font-weight: bold;
}
div#usage blockquote {
	margin-top: 0;
	margin-bottom: 0;
}
h3 {
	font-size: medium;
	margin-top: 1em;
	margin-bottom: 1em;
}
div {
	margin: 0;
}
pre, tt {
	font-family: Menlo, DejaVu Sans Mono, Liberation Mono, Consolas, Courier, Courier New, monospace;
	font-size: smaller;
	font-weight: normal;
}
pre {
	margin: 0 3ex;
	border: thin dotted;
	padding: 0.5em 1ex;
}
tt {
	white-space: nowrap;
	padding: 0 0.5ex;
}
div.line-block {
	margin-bottom: 1em;
}
div.line-block > div.line-block {
	margin-left: 2ex;
}
div.line {
	padding-left: 4ex;
	text-indent: -4ex;
}
div.line tt {
	white-space: pre-wrap;
}
p {
	text-align: justify;
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}
div#usage p, div#merge-strategies ol * {
	text-align: left;
}
dl, ol {
	margin-top: 1em;
}
li > dl, dt, div#conventions li, div#the-update-process li {
	margin-top: 0.5em;
}
dd > p {
	margin: 0;
}
th, td {
	vertical-align: top;
}
td.option-group {
	padding-right: 1ex;
}
td.option-group span.option {
	white-space: nowrap;
}
tr.field {
	line-height: 1.0;
}
th.field-name {
	padding-right: 2ex;
}
th.field-name,
th.field-name + td {
	padding-top: 0.33333em;
}
tbody > tr:first-child > th.field-name,
tbody > tr:first-child > th.field-name + td {
	padding-top: 0;
}
th[colspan="2"].field-name {
	vertical-align: bottom;
	padding-bottom: 0;
}
tr.field > td:first-child, tr.field > td:first-child + td {
	padding-top: 0;
}
th.field-name > tt, dt > tt {
	padding-right: 0;
}
ol.loweralpha {
	list-style-type: lower-alpha;
}
ol.lowerroman {
	list-style-type: lower-roman;
}

/*
 * ]]>
 */
</style>
</head>
<body style="text-align:center">
<div style="display:inline-block;text-align:left;max-width:44pc">
<div class="document" id="topgit-a-different-patch-queue-manager">
<h1 class="title">TopGit &#x2013; A Different Patch Queue Manager</h1>

<div class="section" id="description">
<h1>DESCRIPTION</h1>
<p>TopGit aims to make handling of large amounts of interdependent topic
branches easier. In fact, it is designed especially for the case where
you maintain a queue of third-party patches on top of another (perhaps
Git-controlled) project and want to easily organize, maintain and submit
them &#x2013; TopGit achieves that by keeping a separate topic branch for each
patch and providing some tools to maintain the branches.</p>
<p>See also:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#requirements">REQUIREMENTS</a>:</th><td class="field-body">Installation requirements</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#synopsis">SYNOPSIS</a>:</th><td class="field-body">Command line example session</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#usage">USAGE</a>:</th><td class="field-body">Command line details</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#no-undo">NO UNDO</a>:</th><td class="field-body">Where's the undo!!!</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#conventions">CONVENTIONS</a>:</th><td class="field-body">Suggestions for organizing your TopGit branches</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#extra-settings">EXTRA SETTINGS</a>:</th><td class="field-body">Various possible &quot;topgit.*&quot; config settings</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#aliases">ALIASES</a>:</th><td class="field-body">Git-like TopGit command aliases</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#navigation">NAVIGATION</a>:</th><td class="field-body">Getting around with &quot;next&quot; and &quot;prev&quot;</td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><a class="reference internal" href="#wayback-machine">WAYBACK MACHINE</a>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body">Turn back the clock and then come back</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#glossary">GLOSSARY</a>:</th><td class="field-body">All the TopGit vocabulary in one place</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#technical">TECHNICAL</a>:</th><td class="field-body">How it works behind the scenes</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#testing-topgit">TESTING TOPGIT</a>:</th><td class="field-body">How to run the TopGit test suite</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
<div class="section" id="requirements">
<h1>REQUIREMENTS</h1>
<p>TopGit is a collection of POSIX shell scripts so a POSIX-compliant shell is
required along with some standard POSIX-compliant utilities (e.g. sed, awk,
cat, etc.).  Git version 1.9.2 or later is also required.</p>
<p>To use TopGit with linked working trees (the <tt class="docutils literal">git worktree add</tt> command),
at least Git version 2.5.0 (obviously, since that's when the <tt class="docutils literal">git worktree</tt>
command first appeared) is needed in which case linked working trees are then
fully supported for use with TopGit.</p>
<p>The scripts need to be preprocessed and installed.  The Makefile that does
this requires a POSIX make utility (using &quot;<tt class="docutils literal">make</tt>&quot; and &quot;<tt class="docutils literal">make install</tt>&quot;)
and some version of <tt class="docutils literal">perl</tt> in the <tt class="docutils literal">PATH</tt> somewhere (the <tt class="docutils literal">perl</tt> binary
is needed for correct help text file generation prior to the actual install).</p>
<p>Once installed, TopGit uses only POSIX-compliant utilities (except that it
also requires, obviously, Git).</p>
<p>Running the tests (see <a class="reference internal" href="#testing-topgit">TESTING TOPGIT</a>) has the same requirements as for
installation (i.e. POSIX plus Perl).</p>
<p>It is possible to use the DESTDIR functionality to install TopGit to a
staging area on one machine, archive that and then unarchive it on another
machine to perform an install (provided the build prefix and other options are
compatible with the final installed location).</p>
</div>
<div class="section" id="installation">
<h1>INSTALLATION</h1>
<p>See the file <tt class="docutils literal">INSTALL</tt>.</p>
</div>
<div class="section" id="git-repository">
<h1>GIT REPOSITORY</h1>
<p>The TopGit git repository can be found at &lt;<a class="reference external" href="https://repo.or.cz/topgit/pro">https://repo.or.cz/topgit/pro</a>&gt;.</p>
</div>
<div class="section" id="rationale">
<h1>RATIONALE</h1>
<p>Why not use something like StGIT or Guilt or <tt class="docutils literal">rebase <span class="pre">-i</span></tt> for maintaining
your patch queue?  The advantage of these tools is their simplicity;
they work with patch <em>series</em> and defer to the reflog facility for
version control of patches (reordering of patches is not
version-controlled at all).  But there are several disadvantages &#x2013; for
one, these tools (especially StGIT) do not actually fit well with plain
Git at all: it is basically impossible to take advantage of the index
effectively when using StGIT.  But more importantly, these tools
horribly fail in the face of a distributed environment.</p>
<p>TopGit has been designed around three main tenets:</p>
<blockquote>
<p>(i) TopGit is as thin a layer on top of Git as possible.  You
still maintain your index and commit using Git; TopGit will only
automate a few indispensable tasks.</p>
<p>(ii) TopGit is anxious about <em>keeping</em> your history.  It will
never rewrite your history, and all metadata is also tracked
by Git, smoothly and non-obnoxiously.  It is good to have a
<em>single</em> point when the history is cleaned up, and that is at
the point of inclusion in the upstream project; locally, you
can see how your patch has evolved and easily return to older
versions.</p>
<p>(iii) TopGit is specifically designed to work in a
distributed environment.  You can have several instances of
TopGit-aware repositories and smoothly keep them all
up-to-date and transfer your changes between them.</p>
</blockquote>
<p>As mentioned above, the main intended use-case for TopGit is tracking
third-party patches, where each patch is effectively a single topic
branch.  In order to flexibly accommodate even complex scenarios when
you track many patches where many are independent but some depend on
others, TopGit ignores the ancient Quilt heritage of patch series and
instead allows the patches to freely form graphs (DAGs just like Git
history itself, only &quot;one level higher&quot;).  For now, you have to manually
specify which patches the current one depends on, but TopGit might help
you with that in the future in a darcs-like fashion.</p>
<p>A <a class="reference internal" href="#glossary">glossary</a> plug: The union (i.e. merge) of patch dependencies is called
a <em>base</em> of the patch (topic branch).</p>
<p>Of course, TopGit is perhaps not the right tool for you:</p>
<blockquote>
<p>(i) TopGit is not complicated, but StGIT et al. are somewhat
simpler, conceptually.  If you just want to make a linear
purely-local patch queue, deferring to StGIT instead might
make more sense.</p>
<p>(ii) When using TopGit, your history can get a little hairy
over time, especially with all the merges rippling through.
;-)</p>
</blockquote>
</div>
<div class="section" id="synopsis">
<h1>SYNOPSIS</h1>
<pre class="literal-block">
## Create and evolve a topic branch
$ tg create t/gitweb/pathinfo-action
tg: automatically marking dependency on master
tg: creating t/gitweb/pathinfo-action base from master...
$ ..hack..
$ git commit
$ ..fix a mistake..
$ git commit

## Create another topic branch on top of the former one
$ tg create t/gitweb/nifty-links
tg: automatically marking dependency on t/gitweb/pathinfo-action
tg: creating t/gitweb/nifty-links base from t/gitweb/pathinfo-action...
$ ..hack..
$ git commit

## Create another topic branch on top of master and submit
## the resulting patch upstream
$ tg create t/revlist/author-fixed master
tg: creating t/revlist/author-fixed base from master...
$ ..hack..
$ git commit
$ tg patch -m
tg: Sent t/revlist/author-fixed
From: pasky&#64;suse.cz
To: git&#64;vger.kernel.org
Cc: gitster&#64;pobox.com
Subject: [PATCH] Fix broken revlist --author when --fixed-string

## Create another topic branch depending on two others non-trivially
$ tg create t/whatever t/revlist/author-fixed t/gitweb/nifty-links
tg: creating t/whatever base from t/revlist/author-fixed...
tg: Topic branch t/whatever created.
tg: Running tg update to merge in dependencies.
tg: Updating t/whatever base with t/gitweb/nifty-links changes...
Automatic merge failed; fix conflicts and then commit the result.
tg: Please commit merge resolution and call `tg update --continue`
tg: (use `tg status` to see more options)
$ ..resolve..
$ git commit
$ tg update --continue
$ ..hack..
$ git commit

## Update a single topic branch and propagate the changes to
## a different one
$ git checkout t/gitweb/nifty-links
$ ..hack..
$ git commit
$ git checkout t/whatever
$ tg info
Topic Branch: t/whatever (2/1 commits)
Subject: [PATCH] Whatever patch
Base: 3f47ebc1
Depends: t/revlist/author-fixed
         t/gitweb/nifty-links
Needs update from:
        t/gitweb/nifty-links (1/1 commit)
$ tg update
tg: Updating t/whatever base with t/gitweb/nifty-links changes...
Automatic merge failed; fix conflicts and then commit the result.
tg: Please commit merge resolution and call `tg update --continue`
tg: (use `tg status` to see more options)
$ ..resolve..
$ git commit
$ tg update --continue
tg: Updating t/whatever against new base...
Automatic merge failed; fix conflicts and then commit the result.
tg: Please commit merge resolution and call `tg update --continue`
tg: (use `tg status` to see more options)
$ ..resolve..
$ git commit
$ tg update --continue

## Update a single topic branch and propagate the changes
## further through the dependency chain
$ git checkout t/gitweb/pathinfo-action
$ ..hack..
$ git commit
$ git checkout t/whatever
$ tg info
Topic Branch: t/whatever (1/2 commits)
Subject: [PATCH] Whatever patch
Base: 0ab2c9b3
Depends: t/revlist/author-fixed
         t/gitweb/nifty-links
Needs update from:
        t/gitweb/pathinfo-action (&lt;= t/gitweb/nifty-links) (1/1 commit)
$ tg update
tg: Recursing to t/gitweb/nifty-links...
==&gt; [t/gitweb/nifty-links]
tg: Updating t/gitweb/nifty-links base with t/gitweb/pathinfo-action changes...
Automatic merge failed; fix conflicts and then commit the result.
tg: Please commit merge resolution and call `tg update --continue`
tg: (use `tg status` to see more options)
$ ..resolve..
$ git commit
$ tg update --continue
==&gt; [t/gitweb/nifty-links]
tg: Updating t/gitweb/nifty-links against new base...
Automatic merge failed; fix conflicts and then commit the result.
tg: Please commit merge resolution and call `tg update --continue`
tg: (use `tg status` to see more options)
$ ..resolve..
$ git commit
$ tg update --continue
tg: Updating t/whatever base with t/gitweb/nifty-links changes...
tg: Updating t/whatever against new base...

## Clone a TopGit-controlled repository
$ git clone URL repo
$ cd repo
$ tg remote --populate origin
...
$ git fetch
$ tg update

## Add a TopGit remote to a repository and push to it
$ git remote add foo URL
$ tg remote foo
$ tg push -r foo

## Update from a non-default TopGit remote
$ git fetch foo
$ tg -r foo summary
$ tg -r foo update
</pre>
</div>
<div class="section" id="conventions">
<h1>CONVENTIONS</h1>
<p>When using TopGit there are several common conventions used when working with
TopGit branches.  None of them are enforced, they are only suggestions.</p>
<p>There are three typical uses for a TopGit branch:</p>
<blockquote>
<ol class="arabic simple">
<li>[PATCH]
Normal TopGit branches that represent a single patch.  These are known
as &quot;patch&quot; TopGit branches.</li>
<li>[BASE]
Empty TopGit branches with no dependencies (an empty <tt class="docutils literal">.topdeps</tt> file)
that represent a base upon which other &quot;normal&quot; TopGit branches depend.
These are known as &quot;base&quot; TopGit branches (not to be confused with
the refs/top-bases/... refs).  When such a branch is created on an
unborn branch (meaning the base has no parent commit), it will typically
be named [ROOT] instead of [BASE].  When the base refers to the release
of some external dependency these branches are sometimes named [RELEASE]
instead of [BASE].</li>
<li>[STAGE]
Empty TopGit branches that serve as a staging area to bring together
several other TopGit branches into one place so they can be used/tested
all together.  These are known as &quot;stage&quot; TopGit branches and are
sometimes named [RELEASE] instead of [STAGE].</li>
</ol>
</blockquote>
<p>An &quot;empty&quot; TopGit branch is one that does not have any changes of its own &#x2013; it
may still have dependencies though (&quot;stage&quot; branches do, &quot;base&quot; branches do
not).  The <tt class="docutils literal">tg summary</tt> output shows empty branches annotated with a <tt class="docutils literal">0</tt> in
the output.  Branches which have not been annihilated (but which still might be
&quot;empty&quot;) such as normal &quot;patch&quot; branches, &quot;base&quot; and &quot;stage&quot; branches are shown
in the <tt class="docutils literal">tg summary</tt> output by default.  Annihilated branches are normally
omitted from the <tt class="docutils literal">tg summary</tt> output but can be shown if given explicitly as
an argument to the <tt class="docutils literal">tg summary</tt> command.  However, the message line will be
unavailable since an annihilated branch has no <tt class="docutils literal">.topmsg</tt> file of its own.</p>
<p>A &quot;patch&quot; branch name typically starts with <tt class="docutils literal">t/</tt> whereas &quot;base&quot; and &quot;stage&quot;
branch names often do not.</p>
<p>A &quot;base&quot; branch is created by using the <tt class="docutils literal"><span class="pre">--base</span></tt> option of <tt class="docutils literal">tg create</tt>
(aka <tt class="docutils literal"><span class="pre">--no-deps</span></tt>) which will automatically suggest a &quot;[BASE]&quot; message prefix
rather than &quot;[PATCH]&quot;.  A &quot;stage&quot; branch is created like a normal patch branch
except that the only changes that will ever be made to it are typically to
add/remove dependencies.  Its subject prefix must be manually changed to
&quot;[STAGE]&quot; to reflect its purpose.</p>
<p>Since both &quot;base&quot; and &quot;stage&quot; branches typically only have a use for the
&quot;Subject:&quot; line from their <tt class="docutils literal">.topmsg</tt> file, they are quite easily created
using the <tt class="docutils literal"><span class="pre">--topmsg</span></tt> option of <tt class="docutils literal">tg create</tt>.</p>
<p>Use of &quot;stage&quot; and &quot;base&quot; branches is completely optional.  However, without
use of a &quot;stage&quot; branch it will be difficult to test multiple independent
patches together all at once.  A &quot;base&quot; branch is merely a convenience that
provides more explicit control over when a common base for a set of patches
gets updated as well as providing a branch that shows in <tt class="docutils literal">tg summary</tt> output
and participates in <tt class="docutils literal">tg remote <span class="pre">--populate</span></tt> setup.</p>
<p>Occasionally the functionality of a &quot;base&quot; branch is needed but it may not
be possible to add any <tt class="docutils literal">.topdeps</tt> or <tt class="docutils literal">.topmsg</tt> files to the desired branch
(perhaps it's externally controlled).  <a class="reference internal" href="#bare-branches">BARE BRANCHES</a> can be used in this
case, but while TopGit allows them it deliberately does not provide assistance
in setting them up.</p>
<p>Another advantage to using a &quot;stage&quot; branch is that if a new &quot;patch&quot; branch
is created remotely and that new branch is added to a pre-existing &quot;stage&quot;
branch on the remote then when the local version of the &quot;stage&quot; branch is
updated (after fetching remote updates of course), that new dependency will
be merged into the local &quot;stage&quot; branch and the local version of the new remote
&quot;patch&quot; branch will be automatically set up at &quot;tg update&quot; time.</p>
<p>When using the <tt class="docutils literal">tg tag</tt> command to create tags that record the current state
of one or more TopGit branches, the tags are often created with a name that
starts with <tt class="docutils literal">t/</tt>.</p>
<p>One last thing, you have enabled <tt class="docutils literal">git rerere</tt> haven't you?</p>
</div>
<div class="section" id="no-undo">
<h1>NO UNDO</h1>
<p>Beware, there is no &quot;undo&quot; after running a <tt class="docutils literal">tg update</tt>!</p>
<p>Well, that's not entirely correct.  Since <tt class="docutils literal">tg update</tt> never discards commits
an &quot;undo&quot; operation is technically feasible provided the old values of all the
refs that were affected by the <tt class="docutils literal">tg update</tt> operation can be determined and
then they are simply changed back to their previous values.</p>
<p>In practice though, it can be extremely tedious and error prone looking through
log information to try and determine what the correct previous values were.
Although, since TopGit tries to make sure reflogs are enabled for top-bases
refs, using Git's <tt class="docutils literal">&#64;{date}</tt> notation on all the refs dumped out by a
<tt class="docutils literal">tg tag <span class="pre">--refs</span> foo</tt>, where &quot;foo&quot; is the branch that was updated whose update
needs to be undone, may work.</p>
<p>Alternatively, <tt class="docutils literal">tg tag <span class="pre">--stash</span></tt> can be used prior to the update and then
<tt class="docutils literal">tg revert</tt> used after the update to restore the previous state.  This
assumes, of course, that you remember to run <tt class="docutils literal">tg tag <span class="pre">--stash</span></tt> first.</p>
<p>The <tt class="docutils literal">tg update</tt> command understands a <tt class="docutils literal"><span class="pre">--stash</span></tt> option that tells it to
automatically run <tt class="docutils literal">tg tag <span class="pre">--stash</span></tt> before it starts making changes (if
everything is up-to-date it won't run the stash command at all).</p>
<p>The <tt class="docutils literal"><span class="pre">--stash</span></tt> option is the default nowadays when running <tt class="docutils literal">tg update</tt>,
add the <tt class="docutils literal"><span class="pre">--no-stash</span></tt> option to turn it off.</p>
<p>There is a preference for this.  Setting the config value <tt class="docutils literal">topgit.autostash</tt>
to <tt class="docutils literal">false</tt> will implicitly add the <tt class="docutils literal"><span class="pre">--no-stash</span></tt> option to any <tt class="docutils literal">tg update</tt>
command unless an explicit <tt class="docutils literal"><span class="pre">--stash</span></tt> option is given.</p>
<p>If you are likely to ever want to undo a <tt class="docutils literal">tg update</tt>, setting
<tt class="docutils literal">topgit.autostash</tt> to <tt class="docutils literal">false</tt> is highly discouraged!</p>
<p>Note that if you have foolishly disabled the autostash functionality and
suddenly find yourself in an emergency &quot;WHERE'S THE UNDO???&quot; situation you
<em>may</em> be able to use the special <tt class="docutils literal">TG_STASH</tt> ref.  But only if you're quick.
It's only set if you've foolishly disabled autostash and it always overwrites
the previous <tt class="docutils literal">TG_STASH</tt> value if there was one (there's no reflog for it)
and it will most likely <em>not</em> survive a <tt class="docutils literal">git gc</tt> (even an automatic one) no
matter what gc expiration values are used.  However, as a last gasp attempt
to save your butt, a previously existing <tt class="docutils literal">TG_STASH</tt> will first be renamed
to <tt class="docutils literal">ORIG_TG_STASH</tt> immediately before a new <tt class="docutils literal">TG_STASH</tt> gets written
(stepping on any previously existing <tt class="docutils literal">ORIG_TG_STASH</tt> at that point).</p>
<p>Note that the tags saved by <tt class="docutils literal">tg tag <span class="pre">--stash</span></tt> are stored in the
<tt class="docutils literal">refs/tgstash</tt> ref and its reflog.  Unfortunately, while Git is happy to
maintain the reflog (once it's been enabled which <tt class="docutils literal">tg tag</tt> guarantees for
<tt class="docutils literal">refs/tgstash</tt>), Git is unable to view an annotated/signed tag's reflog!
Instead Git dereferences the tag and shows the wrong thing.</p>
<p>Use the <tt class="docutils literal">tg tag <span class="pre">-g</span></tt> command to view the <tt class="docutils literal">refs/tgstash</tt> reflog instead.</p>
</div>
<div class="section" id="wayback-machine">
<h1>WAYBACK MACHINE</h1>
<p>After reading about <a class="reference internal" href="#no-undo">NO UNDO</a> and the <a class="reference internal" href="#tg-tag">tg tag</a> command used to provide a
semblance of undo in some cases, you have the foundation to understand the
wayback machine.</p>
<p>The &quot;wayback machine&quot; provides a way to go back to a previous ref state as
stored in a TopGit tag created by <a class="reference internal" href="#tg-tag">tg tag</a>.  It actually normally returns to a
hybrid state as it does not prune (unless you prefix the wayback tag with
a <tt class="docutils literal">:</tt>).  In other words, any refs that have been newly created since the
target tag was made will continue to exist in the &quot;wayback&quot; view of things
(unless you used a pruning wayback tag &#x2013; one prefixed with a <tt class="docutils literal">:</tt>).</p>
<p>Any operations that are read-only and do not require working tree files (e.g.
the <tt class="docutils literal"><span class="pre">-i</span></tt> or <tt class="docutils literal"><span class="pre">-w</span></tt> options of <a class="reference internal" href="#tg-patch">tg patch</a>) are allowed using the wayback
machine.  Simply add a global <tt class="docutils literal"><span class="pre">-w</span> &lt;tgtag&gt;</tt> option to the command.</p>
<p>This functionality can be extremely useful for quickly examining/querying a
previous state recorded some time ago with a <a class="reference internal" href="#tg-tag">tg tag</a>.</p>
<p>As the wayback machine uses a separate caching area, expect initial operations
to be less speedy, but repeated wayback operations on the same wayback tag
should happen at normal speed.</p>
<p>One new command exists expressly for use with the wayback machine.</p>
<p>The <a class="reference internal" href="#tg-shell">tg shell</a> command will spawn an interactive shell or run a specific shell
command in a temporary writable and non-bare repository that has its ref
namespace set to the (possibly pruned if it's a pruning wayback tag) wayback
tag's view of the world.  This pretty much lifts all wayback restrictions, but
read the description for <a class="reference internal" href="#tg-shell">tg shell</a> for more details.  There is an option
available to specify the location where this &quot;temporary&quot; directory is created
thereby allowing it to persist, but the same warnings then apply as using the
<tt class="docutils literal">git clone <span class="pre">--shared</span></tt> command.</p>
</div>
<div class="section" id="extra-settings">
<h1>EXTRA SETTINGS</h1>
<p>TopGit supports various config settings:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-tag">tg tag</a>:</th><td class="field-body"><tt class="docutils literal">color.tgtag</tt> on/off color for <tt class="docutils literal">tg tag <span class="pre">-g</span></tt></td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-tag">tg tag</a>:</th><td class="field-body"><tt class="docutils literal">color.tgtag.commit</tt> reflog hash color</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-tag">tg tag</a>:</th><td class="field-body"><tt class="docutils literal">color.tgtag.date</tt> reflog date line color</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-tag">tg tag</a>:</th><td class="field-body"><tt class="docutils literal">color.tgtag.meta</tt> reflog object type color</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-tag">tg tag</a>:</th><td class="field-body"><tt class="docutils literal">color.tgtag.time</tt> reflog time info color</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-create">tg create</a>:</th><td class="field-body"><tt class="docutils literal">format.signoff</tt> template Signed-off-by line</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#aliases">ALIASES</a>:</th><td class="field-body"><tt class="docutils literal">topgit.alias.*</tt> for Git-like command aliases</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-update">tg update</a>:</th><td class="field-body"><tt class="docutils literal">topgit.autostash</tt> automatic stash control</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-create">tg create</a>:</th><td class="field-body"><tt class="docutils literal">topgit.bcc</tt> default &quot;Bcc:&quot; value for create</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-create">tg create</a>:</th><td class="field-body"><tt class="docutils literal">topgit.cc</tt> default &quot;Cc:&quot; value for create</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-patch">tg patch</a>:</th><td class="field-body"><tt class="docutils literal">topgit.from</tt> &quot;From:&quot; fixups by <tt class="docutils literal">tg patch</tt></td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-export">tg export</a>:</th><td class="field-body"><tt class="docutils literal">topgit.notesExport</tt> export <tt class="docutils literal"><span class="pre">---</span></tt> notes</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-import">tg import</a>:</th><td class="field-body"><tt class="docutils literal">topgit.notesImport</tt> import <tt class="docutils literal"><span class="pre">---</span></tt> notes</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-push">tg push</a>:</th><td class="field-body"><tt class="docutils literal">topgit.pushRemote</tt> default push remote</td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><a class="reference internal" href="#remote-handling">REMOTE HANDLING</a>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body"><tt class="docutils literal">topgit.remote</tt> TopGit's default remote</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#sequestration">SEQUESTRATION</a>:</th><td class="field-body"><tt class="docutils literal">topgit.sequester</tt> for sequestration control</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-update">tg update</a>:</th><td class="field-body"><tt class="docutils literal">topgit.setAutoUpdate</tt> =&gt; <tt class="docutils literal">rerere.autoUpdate</tt></td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-export">tg export</a>:</th><td class="field-body"><tt class="docutils literal">topgit.subjectMode</tt> export [...] tag removal</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-create">tg create</a>:</th><td class="field-body"><tt class="docutils literal">topgit.subjectPrefix</tt> &quot;[$prefix PATCH] foo&quot;</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-create">tg create</a>:</th><td class="field-body"><tt class="docutils literal">topgit.to</tt> default &quot;To:&quot; value for create</td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><a class="reference internal" href="#tg-migrate-bases">tg migrate-bases</a>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body"><tt class="docutils literal"><span class="pre">topgit.top-bases</span></tt> for refs bases location</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
<div class="section" id="aliases">
<h1>ALIASES</h1>
<p>These work exactly like Git's aliases except they are stored under
<tt class="docutils literal">topgit.alias.*</tt> instead.  See the <tt class="docutils literal">git help config</tt> output under
the <tt class="docutils literal">alias.*</tt> section for details.  Do note that while alias nesting is
explicitly permitted, a maximum nesting depth of 10 is enforced to help
detect accidental aliasing loops and keep them from wedging the machine.</p>
<p>For example, to create an <tt class="docutils literal">lc</tt> alias for the <tt class="docutils literal">tg log <span class="pre">--compact</span></tt> command
this command may be used:</p>
<pre class="literal-block">
git config --global topgit.alias.lc &quot;log --compact&quot;
</pre>
<p>To make it specific to a particular repository just omit the <tt class="docutils literal"><span class="pre">--global</span></tt>
option from the command.</p>
<p>There is one implicit universal alias as though this were set:</p>
<pre class="literal-block">
git config topgit.alias.goto &quot;checkout goto&quot;
</pre>
<p>But only if no explicit alias has already been set for <tt class="docutils literal">topgit.alias.goto</tt>.</p>
</div>
<div class="section" id="navigation">
<h1>NAVIGATION</h1>
<div class="section" id="from-previous-to-next">
<h2>From Previous to Next</h2>
<p>For this section, consider the following patch series, to be applied
in numerical order as shown:</p>
<pre class="literal-block">
0001-F_first-patch.diff
0002-G_second-builds-on-F.diff
0003-H_third-builds-on-G.diff
0004-I_fourth-builds-on-H.diff
0005-J_fifth-builds-on-I.diff
0006-K_sixth-builds-on-J.diff
0007-L_last-patch-needs-K.diff
</pre>
<p>If these were applied to some commit in a Git repository, say commit &quot;A&quot;
then a history that looks like this would be created:</p>
<pre class="literal-block">
A---F---G---H---I---J---K---L
</pre>
<p>Where the parent of commit &quot;F&quot; is &quot;A&quot; and so on to where the parent of
commit &quot;L&quot; is commit &quot;K&quot;.</p>
<p>If that commit history, from A through L, was then imported into TopGit, one
TopGit branch would be created corresponding to each of the commits F
through L.  This way, for example, if the fourth patch in the series
(<tt class="docutils literal"><span class="pre">0004-I_...diff</span></tt>) needs work, the TopGit branch corresponding to its patch
can be checked out and changes made and then a new version of its patch
created (using <tt class="docutils literal">tg patch</tt>) without disturbing the other patches in the series
and when <tt class="docutils literal">tg update</tt> is run, the patches that &quot;follow&quot; the fourth patch
(i.e. 5, 6 and 7) will have their corresponding TopGit branches automatically
updated to take into account the changes made to the fourth patch.</p>
<div class="section" id="okay-enough-with-the-review-of-topgit-systemology">
<h3>Okay, enough with the review of TopGit systemology</h3>
<p>Imagine then that you are working on the fourth patch (i.e. you have its
branch checked out into the working tree) and you want to move to the following
patch in the series because you have a nit to pick with it too.</p>
<p>If you can't remember the exact name you might have to fumble around or, you
can display the name of the following or &quot;next&quot; patch's branch with the, you
guessed it, <tt class="docutils literal">tg next</tt> command.  Think of &quot;next&quot; as the &quot;next&quot; logical patch
in the series or the next following patch.  If the patches are numbered as in
the list above, &quot;next&quot; corresponds to the &quot;+1&quot; (plus one) patch.</p>
<p>You might have already guessed there's a corresponding <tt class="docutils literal">tg prev</tt> command
which displays the &quot;-1&quot; (minus one) patch.  If these commands (<tt class="docutils literal">tg next</tt>
and <tt class="docutils literal">tg prev</tt>) are not given a branch name to start at they start at the
patch corresponding to the current <tt class="docutils literal">HEAD</tt>.</p>
<p>Displaying, however, is not so helpful as actually going there.  That's where
the <tt class="docutils literal">tg checkout</tt> command comes in.  <tt class="docutils literal">tg checkout next</tt> does a
<tt class="docutils literal">git checkout</tt> of the <tt class="docutils literal">tg next</tt> branch and, not surprisingly,
<tt class="docutils literal">tg checkout prev</tt> does a <tt class="docutils literal">git checkout</tt> of the <tt class="docutils literal">tg prev</tt> branch.  For
the lazy a single <tt class="docutils literal">n</tt> or <tt class="docutils literal">p</tt> can be used with <tt class="docutils literal">tg checkout</tt> instead of
typing out the entire <tt class="docutils literal">next</tt> or <tt class="docutils literal">prev</tt>.  Or, for the anal, <tt class="docutils literal">previous</tt>
will also be accepted for <tt class="docutils literal">prev</tt>.</p>
<p>Referring to the A...L commit graph shown above, I is the parent of J and,
conversely, J is the child of I.  (Git only explicitly records the child to
parent links, in other words a &quot;child&quot; points to zero or more &quot;parents&quot;, but
parents are completely clueless about their own children.)</p>
<p>For historical reasons, the <tt class="docutils literal">tg checkout</tt> command accepts <tt class="docutils literal">child</tt> as a
synonym for <tt class="docutils literal">next</tt> and <tt class="docutils literal">parent</tt> as a synonym for <tt class="docutils literal">prev</tt>.  However, this
terminology can be confusing since Git has &quot;parent&quot; links but <tt class="docutils literal">tg checkout</tt>
is referring to the TopGit DAG, not Git's.  Best to just avoid using <tt class="docutils literal">child</tt>
or <tt class="docutils literal">parent</tt> to talk about navigating the TopGit DAG and reserve them
strictly for discussing the Git DAG.</p>
</div>
<div class="section" id="there-may-be-more-than-one">
<h3>There may be more than one</h3>
<p>In a simple linear history as shown above there's always only one &quot;next&quot; or
&quot;prev&quot; patch.  However, TopGit does not restrict one to only a linear
history (although that can make patch exports just a bushel of fun).</p>
<p>Suffice it to say that there is always a single linearized ordering for any
TopGit patch series since it's always a DAG (Directed Acyclic Graph), but it
may not be immediately obvious to the casual observer what that is.</p>
<p>The <tt class="docutils literal">tg checkout</tt> command will display a list to choose from if <tt class="docutils literal">next</tt>
or <tt class="docutils literal">prev</tt> would be ambiguous.</p>
</div>
<div class="section" id="use-the-tg-info-checkout-series-command">
<h3>Use the <tt class="docutils literal">tg info/checkout <span class="pre">--series</span></tt> command</h3>
<p>To see the full, linearized, list of patches with their summary displayed in
order from first to last patch in the series, just run the <tt class="docutils literal">tg info <span class="pre">--series</span></tt>
command.  It takes the name of any patch in the series automatically using
<tt class="docutils literal">HEAD</tt> if none is given.  It even provides a nice &quot;YOU ARE HERE&quot; mark in
the output list helpful to those who have been absent for a time engaging in
otherwise distracting activities and need to be reminded where they are.</p>
<p>Using <tt class="docutils literal">tg checkout <span class="pre">--series</span></tt> can take you there (picking from a list) if
you've forgotten the way back to wherever you're supposed to be.</p>
</div>
<div class="section" id="don-t-get-pushy-there-s-just-one-more-thing">
<h3>Don't get pushy, there's just one more thing</h3>
<p>For historical reasons, <tt class="docutils literal">tg checkout</tt> with no arguments whatsoever behaves
like <tt class="docutils literal">tg checkout next</tt>.  For the same historical reasons, <tt class="docutils literal">tg checkout ..</tt>
behaves like <tt class="docutils literal">tg checkout prev</tt> (think of <tt class="docutils literal">..</tt> as the &quot;parent&quot; directory
and since &quot;parent&quot; means &quot;prev&quot; in this context it will then make sense).</p>
<p>Now, for that one more thing.  Consider that you have a pristine &quot;upstream&quot;
tarball, repository, source dump or otherwise obtained set of unmodified
source files that need to be patched.  View them like so:</p>
<pre class="literal-block">
+-------------------------------+
| Unmodified &quot;upstream&quot; source  |
| files represented with &quot;A&quot;    |
+-------------------------------+
</pre>
<p>Now, add the first patch, 0001, to them and view the result like so:</p>
<pre class="literal-block">
+--------------------------+----+
| Patch 0001 represented by &quot;F&quot; |
+-------------------------------+
| Unmodified &quot;upstream&quot; source  |
| files represented with &quot;A&quot;    |
+-------------------------------+
</pre>
<p>Not stopping there, &quot;push&quot; patches 2, 3 and 4 onto the stack as well like so:</p>
<pre class="literal-block">
+--------------------------+----+
| Patch 0004 represented by &quot;I&quot; |
+--------------------------+----+
| Patch 0003 represented by &quot;H&quot; |
+--------------------------+----+
| Patch 0002 represented by &quot;G&quot; |
+--------------------------+----+
| Patch 0001 represented by &quot;F&quot; |
+-------------------------------+
| Unmodified &quot;upstream&quot; source  |
| files represented with &quot;A&quot;    |
+-------------------------------+
</pre>
<p>In other words, to go to the &quot;next&quot; patch in the series it needs to be &quot;push&quot;ed
onto the stack.  <tt class="docutils literal">tg checkout</tt> accepts <tt class="docutils literal">push</tt> as an alias for <tt class="docutils literal">next</tt>.</p>
<p>Similarly to go to the &quot;previous&quot; patch in the series the current one needs
to be &quot;pop&quot;ped off the stack.  <tt class="docutils literal">tg checkout</tt> accepts <tt class="docutils literal">pop</tt> as an alias
for <tt class="docutils literal">prev</tt>.</p>
<p>Unfortunately for these aliases, in Git terminology a &quot;push&quot; has quite a
different meaning and the <tt class="docutils literal">tg push</tt> command does something quite different
from <tt class="docutils literal">tg checkout push</tt>.  Then there's the matter of using a single letter
abbreviation for the lazy &#x2013; <tt class="docutils literal">p</tt> would mean what exactly?</p>
<p><tt class="docutils literal">tg checkout</tt> continues to accept the <tt class="docutils literal">push</tt> and <tt class="docutils literal">pop</tt> aliases for
<tt class="docutils literal">next</tt> and <tt class="docutils literal">prev</tt> respectively,  but it's best to avoid them since
<tt class="docutils literal">push</tt> has an alternate meaning everywhere else in TopGit and Git and that
leaves <tt class="docutils literal">pop</tt> all alone in the dark.</p>
</div>
</div>
</div>
<div class="section" id="sequestration">
<h1>SEQUESTRATION</h1>
<p>No, this is not a section about budget nonsense.  ;)</p>
<p>TopGit keeps its metadata in <tt class="docutils literal">.topdeps</tt> and <tt class="docutils literal">.topmsg</tt> files.  In an effort
to facilitate cherry-picking and other Git activities on the patch changes
themselves while ignoring the TopGit metadata, TopGit attempts to keep all
changes to <tt class="docutils literal">.topdeps</tt> and <tt class="docutils literal">.topmsg</tt> files limited to commits that do NOT
contain changes to any other files.</p>
<p>This is a departure from previous TopGit versions that made no such effort.</p>
<p>Primarily this affects <tt class="docutils literal">tg create</tt> and <tt class="docutils literal">tg import</tt> (which makes use of
<tt class="docutils literal">tg create</tt>) as <tt class="docutils literal">tg create</tt> will commit the initial versions of
<tt class="docutils literal">.topdeps</tt> and <tt class="docutils literal">.topmsg</tt> for a new TopGit-controlled branch in their own
commit instead of mixing them in with changes to other files.</p>
<p>The <tt class="docutils literal"><span class="pre">pre-commit</span></tt> hook will also attempt to separate out any <tt class="docutils literal">.topdeps</tt> and
<tt class="docutils literal">.topmsg</tt> changes from commits that include changes to other files.</p>
<p>It is possible to defeat these checks without much effort (<tt class="docutils literal"><span class="pre">pre-commit</span></tt> hooks
can easily be bypassed, <tt class="docutils literal">tg create</tt> has a <tt class="docutils literal"><span class="pre">--no-commit</span></tt> option, many Git
commands simply do not run the <tt class="docutils literal"><span class="pre">pre-commit</span></tt> hook, etc.).</p>
<p>If you really, really, really, really want to change the default back to the
old behavior of previous TopGit versions where no such sequestration took
place, then set the <tt class="docutils literal">topgit.sequester</tt> config variable explicitly to the
value <tt class="docutils literal">false</tt>.  But this is not recommended.</p>
</div>
<div class="section" id="amending-and-rebasing-and-update-ref-ing">
<h1>AMENDING AND REBASING AND UPDATE-REF'ING</h1>
<p>In a word, &quot;don't&quot;.</p>
<p>It is okay to manually update a top-bases/... ref when a) it has no depedencies
(i.e. it was created with the <tt class="docutils literal">tg create</tt> <tt class="docutils literal"><span class="pre">--base</span></tt> option) and b) the
old top-bases/... ref value can be fast-forwarded to the new top-bases/...
value OR the new value contains ALL of the changes in the old value through
some other mechanism (perhaps they were cherry-picked or otherwise applied to
the new top-bases/... ref).  The same rules apply to non-TopGit-controlled
dependencies.  Use the <tt class="docutils literal">tg update <span class="pre">--base</span> &lt;branch&gt; <span class="pre">&lt;new-ref&gt;</span></tt> command to
safely make such an update while making it easy to set the merge commit
message at the same time.</p>
<p>Ignoring this rule and proceeding anyway with a non-fast-forward update to a
top-bases/... ref will result in changes present in the new value being merged
into the branch (at <tt class="docutils literal">tg update</tt> time) as expected (possibly with conflicts),
but any changes that were contained in the old version of the top-bases/... ref
which have been dropped (i.e. are NOT contained in the new version of the
top-bases/... ref) will continue to be present in the branch!  To get rid of
the dropped commits, one or more &quot;revert&quot; commits will have to be manually
applied to the tip of the new top-bases/... value (which will then be merged
into the branch at next <tt class="docutils literal">tg update</tt> time).</p>
<p>The only time it's safe to amend, rebase, filter or otherwise rewrite commits
contained in a TopGit controlled branch or non-TopGit branch is when those
commits are NOT reachable via any other ref!</p>
<p>Furthermore, while it is safe to rewrite merge commits (provided they meet the
same conditions) the merge commits themselves and the branches they are merging
in must be preserved during the rewrite and that can be rather tricky to get
right so it's not recommended.</p>
<p>For example, if, while working on a TopGit-controlled branch <tt class="docutils literal">foo</tt>, a bad
typo is noticed, it's okay to ammend/rebase to fix that provided neither
<tt class="docutils literal">tg update</tt> nor <tt class="docutils literal">tg create</tt> has already been used to cause some other ref
to be able to reach the commit with the typo.</p>
<p>If an amend or rewrite is done anyway even though the commit with the typo is
reachable from some other ref, the typo won't really be removed.  What will
happen instead is that the new version without the typo will ultimately be
merged into the other ref(s) (at <tt class="docutils literal">tg update</tt> time) likely causing a conflict
that will have to be manually resolved and the commit with the typo will
continue to be reachable from those other refs!</p>
<p>Instead just make a new commit to fix the typo.  The end result will end up
being the same but without the merge conflicts.</p>
<p>See also the discussion in the <a class="reference internal" href="#no-undo">NO UNDO</a> section.</p>
</div>
<div class="section" id="bare-branches">
<h1>BARE BRANCHES</h1>
<p>A &quot;TopGit bare branch&quot; (or just &quot;bare branch&quot; for short), refers to a TopGit
branch that has neither a <tt class="docutils literal">.topdeps</tt> nor a <tt class="docutils literal">.topmsg</tt> file stored in it.
And it's neither a new, still-empty empty branch nor an annihilated branch.</p>
<p>Such branches are not recommended but are reluctantly accomodated.</p>
<p>There are three situtations in which TopGit may encounter a TopGit branch
that has neither a <tt class="docutils literal">.topdeps</tt> nor a <tt class="docutils literal">.topmsg</tt> file.</p>
<blockquote>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Branch creation with <tt class="docutils literal"><span class="pre">--no-commit</span></tt></dt>
<dd><p class="first last">Before the initial commit is made, the branch will still be
pointing to the same commit as its &quot;top-bases&quot; ref.  Branches
in this condition (where the branch and top-bases ref point to
the same commit) show up as having &quot;No commits&quot; in listings.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Annihilated branches</dt>
<dd><p class="first last">A branch is annihilated by making a new commit on the branch
that makes its tree identical to the tree of its corresponding
top-bases ref.  Although the trees will be the same, the
commits will be different and annihilated branches are
distinguished from &quot;No commits&quot; branches in this way.
Annihilated branches are generally invisible and do not show up
in listings or other status displays.  Intentionally so.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Bare branches</dt>
<dd><p class="first last">Any TopGit branch with neither a <tt class="docutils literal">.topdeps</tt> file nor a
<tt class="docutils literal">.topmsg</tt> file whose branch and top-bases trees differ falls
into this category.  TopGit will not create such a branch
itself nor does it provide any commands to do so.</p>
</dd>
</dl>
</li>
</ol>
</blockquote>
<p>Whenever possible, a TopGit &quot;[BASE]&quot; branch should be preferred to using a
&quot;bare branch&quot; because a) it can never be mistaken for an annihilated branch,
b) it has a nice subject attached (via its <tt class="docutils literal">.topmsg</tt> file) that shows
up in listings and c) exactly when and which updates are taken can be planned.</p>
<p>Nevertheless, situations may arise where it's useful to have TopGit treat a
branch as a &quot;TopGit branch&quot; so that it fully participates in all update
activities (such as updating local branches based on their remote branches),
but it's not feasible to turn it into a real &quot;TopGit branch&quot; as it comes from
an external source and rather than controlling exactly when and what updates
are picked up from it by TopGit (the precise use case of a &quot;[BASE]&quot; branch),
all updates that appear on it are to be assimilated as soon as they occur.</p>
<p>For this reason, TopGit will accomodate such &quot;bare branches&quot; but it will not
create (nor provide the means to create) them itself.</p>
<p>In order to create a &quot;bare branch&quot; all that's required is to create the
necessary top-bases ref.  The choice of commit for the top-bases ref will
affect the output of the &quot;files&quot;, &quot;log&quot; and &quot;patch&quot; commands most directly
(but all commands will be affected).</p>
<p>To work properly as a &quot;bare branch&quot;, the commit the &quot;bare branch&quot;'s base points
to should be contained within the branch, be a different commit than the branch
tip itself and have a different tree than the branch tip.  Simply setting the
base to the parent commit of the &quot;bare branch&quot; will usually work, but should
that commit at the tip of the &quot;bare branch&quot; end up getting reverted as the next
commit, the trees would match and it would appear to be an annihilated branch
rather than a &quot;bare branch&quot;.  That is one of the reasons these branches are not
recommended in the first place.</p>
<p>Setting the base to the root commit of the branch is more reliable and may
be accomplished like so for a local branch named &quot;mybranch&quot;:</p>
<pre class="literal-block">
git update-ref $(tg --top-bases)/mybranch \
  $(git rev-list --first-parent --max-parents=0 mybranch) &quot;&quot;
</pre>
<p>Typically though it's more likely a remote bare branch will be needed.  For
a remote named &quot;origin&quot; and a remote branch name of &quot;vendor&quot; this will do it:</p>
<pre class="literal-block">
git update-ref $(tg --top-bases -r origin)/vendor \
  $(git rev-list --first-parent --max-parents=0 origin/vendor) &quot;&quot;
</pre>
<p>Such &quot;bare branches&quot; are not likely ever to receive any more direct support in
TopGit than acknowleging they can be useful in some situations and tolerating
their existence by functioning properly with them even to the point of the
<tt class="docutils literal"><span class="pre">pre-commit</span></tt> hook tacitly allowing continued commits on such branches without
complaints about missing <tt class="docutils literal">.topdeps</tt> and <tt class="docutils literal">.topmsg</tt> files.</p>
<p>Note, however, that creating a regular TopGit branch that has no changes of its
own with the &quot;bare branch&quot; as its single dependency provides a means to supply
some kind of documentation if all other uses of the &quot;bare branch&quot; depend on
this &quot;wrapper&quot; branch instead of directly on the &quot;bare branch&quot;.</p>
</div>
<div class="section" id="speed-and-caching">
<h1>SPEED AND CACHING</h1>
<p>TopGit needs to check many things to determine whether a TopGit branch is
up-to-date or not.  This can involve a LOT of git commands for a complex
dependency tree.  In order to speed things up, TopGit keeps a cache of results
in a <tt class="docutils literal"><span class="pre">tg-cache</span></tt> subdirectory in the <tt class="docutils literal">.git</tt> directory.</p>
<p>Results are tagged with the original hash values used to get that result so
that items which have not been changed return their results quickly and items
which have been changed compute their new result and cache it for future use.</p>
<p>The <tt class="docutils literal"><span class="pre">.git/tg-cache</span></tt> directory may be removed at any time and the cache will
simply be recreated in an on-demand fashion as needed, at some speed penalty,
until it's fully rebuilt.</p>
<p>To force the cache to be fully pre-loaded, run the <tt class="docutils literal">tg summary</tt> command
without any arguments.  Otherwise, normal day-to-day TopGit operations should
keep it more-or-less up-to-date.</p>
<p>While each TopGit command is running, it uses a temporary subdirectory also
located in the <tt class="docutils literal">.git</tt> directory.  These directories are named
<tt class="docutils literal"><span class="pre">tg-tmp.XXXXXX</span></tt> where the <tt class="docutils literal">XXXXXX</tt> part will be random letters and digits.</p>
<p>These temporary directories should always be removed automatically after each
TopGit command finishes running.  As long as you are not in a subshell as a
result of a TopGit command stopping and waiting for a manual merge resolution,
it's safe to remove any of these directories that may have somehow accidentally
been left behind as a result of some failure that occurred while running a
TopGit command (provided, of course, it's not actually being used by a TopGit
command currently running in another terminal window or by another user on the
same repository).</p>
</div>
<div class="section" id="usage">
<h1>USAGE</h1>
<p><tt class="docutils literal">tg [global options] &lt;command&gt; [&lt;command <span class="pre">option/argument&gt;...]</span></tt></p>
<p>Global options:</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">[-C</span> <span class="pre">&lt;dir&gt;]...</span> <span class="pre">[-r</span> &lt;remote&gt; | <span class="pre">-u]</span> <span class="pre">[-c</span> <span class="pre">&lt;name&gt;=&lt;val&gt;]...</span> <span class="pre">[--[no-]pager]</span></tt></p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-C <var>&lt;dir&gt;</var></span></kbd></td>
<td>Change directory to &lt;dir&gt; before doing anything more</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-r <var>&lt;remote&gt;</var></span></kbd></td>
<td>Pretend <tt class="docutils literal">topgit.remote</tt> is set to &lt;remote&gt;</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-u</span></kbd></td>
<td>Pretend <tt class="docutils literal">topgit.remote</tt> is not set</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-c <var>&lt;name=val&gt;</var></span></kbd></td>
<td>Pass config option to git, may be repeated</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-w <var>&lt;tgtag&gt;</var></span></kbd></td>
<td>Activate <a class="reference internal" href="#wayback-machine">wayback machine</a> using the <a class="reference internal" href="#tg-tag">tg tag</a> &lt;tgtag&gt;</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--no-pager</span></kbd></td>
<td>Disable all pagers (by both TopGit and Git aka <tt class="docutils literal"><span class="pre">-P</span></tt>)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--pager</span></kbd></td>
<td>Enable use of a pager (aka <tt class="docutils literal"><span class="pre">-p</span></tt> aka <tt class="docutils literal"><span class="pre">--paginate</span></tt>)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--top-bases</span></kbd></td>
<td>Show full <tt class="docutils literal"><span class="pre">top-bases</span></tt> ref prefix and exit</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--exec-path</span></kbd></td>
<td>Show path to command scripts location and exit</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--help</span></kbd></td>
<td>Show brief usage help and exit (aka <tt class="docutils literal"><span class="pre">-h</span></tt>)</td></tr>
</tbody>
</table>
</blockquote>
<p>The <tt class="docutils literal">tg</tt> tool has several commands:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-annihilate">tg annihilate</a>:</th><td class="field-body">Mark a TopGit-controlled branch as defunct</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-base">tg base</a>:</th><td class="field-body">Show base commit for one or more TopGit branches</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-checkout">tg checkout</a>:</th><td class="field-body">Shortcut for git checkout with name matching</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-contains">tg contains</a>:</th><td class="field-body">Which TopGit-controlled branch contains the commit</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-create">tg create</a>:</th><td class="field-body">Create a new TopGit-controlled branch</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-delete">tg delete</a>:</th><td class="field-body">Delete a TopGit-controlled branch cleanly</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-depend">tg depend</a>:</th><td class="field-body">Add a new dependency to a TopGit-controlled branch</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-export">tg export</a>:</th><td class="field-body">Export TopGit branch patches to files or a branch</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-files">tg files</a>:</th><td class="field-body">Show files changed by a TopGit branch</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-help">tg help</a>:</th><td class="field-body">Show TopGit help optionally using a browser</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-import">tg import</a>:</th><td class="field-body">Import commit(s) to separate TopGit branches</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-info">tg info</a>:</th><td class="field-body">Show status information about a TopGit branch</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-log">tg log</a>:</th><td class="field-body">Run git log limiting revisions to a TopGit branch</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-mail">tg mail</a>:</th><td class="field-body">Shortcut for git send-email with <tt class="docutils literal">tg patch</tt> output</td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><a class="reference internal" href="#tg-migrate-bases">tg migrate-bases</a>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body">Transition top-bases to new location</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-next">tg next</a>:</th><td class="field-body">Show next branch in the patch series</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-patch">tg patch</a>:</th><td class="field-body">Generate a patch file for a TopGit branch</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-prev">tg prev</a>:</th><td class="field-body">Show previous branch in the patch series</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-push">tg push</a>:</th><td class="field-body">Run git push on TopGit branch(es) and depedencies</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-rebase">tg rebase</a>:</th><td class="field-body">Auto continue git rebase if rerere resolves conflicts</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-remote">tg remote</a>:</th><td class="field-body">Set up remote for fetching/pushing TopGit branches</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-revert">tg revert</a>:</th><td class="field-body">Revert ref(s) to a state stored in a <tt class="docutils literal">tg tag</tt></td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-shell">tg shell</a>:</th><td class="field-body">Extended <a class="reference internal" href="#wayback-machine">wayback machine</a> mode</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-status">tg status</a>:</th><td class="field-body">Show current TopGit status (e.g. in-progress update)</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-summary">tg summary</a>:</th><td class="field-body">Show various information about TopGit branches</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-tag">tg tag</a>:</th><td class="field-body">Create tag that records current TopGit branch state</td>
</tr>
<tr class="field"><th align="left" class="field-name"><a class="reference internal" href="#tg-update">tg update</a>:</th><td class="field-body">Update TopGit branch(es) with respect to dependencies</td>
</tr>
</tbody>
</table>
</blockquote>
<div class="section" id="tg-help">
<h2>tg help</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg help <span class="pre">[-w]</span> [&lt;command&gt;]</tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-w</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; view help in browser</tt></div>
</div>
</div>
<p>Our sophisticated integrated help facility.  Mostly duplicates
what is below:</p>
<pre class="literal-block">
# to list commands:
$ tg help
# to get help for a particular command:
$ tg help &lt;command&gt;
# to get help for a particular command in a browser window:
$ tg help -w &lt;command&gt;
# to get help on TopGit itself
$ tg help tg
# to get help on TopGit itself in a browser
$ tg help -w tg
</pre>
</blockquote>
</div>
<div class="section" id="tg-status">
<h2>tg status</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg st[atus] <span class="pre">[-v]</span> <span class="pre">[--exit-code]</span></tt></div>
</div>
<p>Our sophisticated status facility.  Similar to Git's status command
but shows any in-progress update that's awaiting a merge resolution
or any other on-going TopGit activity (such as a branch creation).</p>
<p>With a single <tt class="docutils literal"><span class="pre">--verbose</span></tt> (or <tt class="docutils literal"><span class="pre">-v</span></tt>) option include a short status
display for any dirty (but not untracked) files.  This also causes all
non file status lines to be prefixed with &quot;## &quot;.</p>
<p>With two (or more) <tt class="docutils literal"><span class="pre">--verbose</span></tt> (or <tt class="docutils literal"><span class="pre">-v</span></tt>) options, additionally
show full symbolic ref names and unabbreviated hash values.</p>
<p>With the <tt class="docutils literal"><span class="pre">--exit-code</span></tt> option the exit code will be non-zero if any
TopGit or Git operation is currently in progress or the working
directory is unclean.</p>
</blockquote>
</div>
<div class="section" id="tg-create">
<h2>tg create</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> create <span class="pre">[&lt;option&gt;...]</span> [&lt;name&gt; <span class="pre">[&lt;dep&gt;...]]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> create <span class="pre">[&lt;option&gt;...]</span> <span class="pre">--base</span> &lt;name&gt; [&lt;committish&gt;]</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[-r</span> &lt;remote&gt;] create <span class="pre">[&lt;option&gt;...]</span> &lt;name&gt; <span class="pre">-r</span> [&lt;rbranch&gt;]</tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-deps</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; alternate spelling of <span class="pre">'--base'</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--quiet</span> / <span class="pre">-q</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; suppress most informational messages</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--message</span> &lt;msg&gt;&#160;&#160;&#160;&#160; replace default commit message</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-m</span> &lt;msg&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (default message is &quot;tg create <span class="pre">&lt;name&gt;&quot;)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--file</span> &lt;file&gt;&#160;&#160;&#160;&#160;&#160;&#160; replace default commit message</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-F</span> &lt;file&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; with contents of &lt;file&gt;</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--topmsg</span> &lt;msg&gt;&#160;&#160;&#160;&#160;&#160; use &lt;msg&gt; as .topmsg and skip editor</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--tm</span> &lt;msg&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (&lt;msg&gt; may be reformatted with a warning)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--topmsg-file</span> &lt;f&gt;&#160;&#160; use contents of file &lt;f&gt; as <span class="pre">--topmsg</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--tF</span> &lt;file&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; alias for <span class="pre">--topmsg-file</span> &lt;file&gt;</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--force</span> / <span class="pre">-f</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ignore tag with same name as new branch</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-edit</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; do not run the editor on default .topmsg</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-commit</span> / <span class="pre">-n</span>&#160;&#160;&#160; stop before actually making the commit</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-update</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; do not run 'tg update' (implied by <span class="pre">-n)</span></tt></div>
</div>
</div>
<p>Create a new TopGit-controlled topic branch of the given name
(required argument) and switch to it.  If no dependencies are
specified (by extra arguments passed after the first one), the
current branch is assumed to be the only dependency.</p>
<p>By default <tt class="docutils literal">tg create</tt> opens an editor on the new <tt class="docutils literal">.topmsg</tt> file
and then commits the new <tt class="docutils literal">.topmsg</tt> and <tt class="docutils literal">.topdeps</tt> files
automatically with a suitable default commit message.</p>
<p>The commit message can be changed with the <tt class="docutils literal"><span class="pre">-m</span></tt> (or <tt class="docutils literal"><span class="pre">--message</span></tt>) or
<tt class="docutils literal"><span class="pre">-F</span></tt> (or <tt class="docutils literal"><span class="pre">--file</span></tt>) option.  The automatic commit can be suppressed
by using the <tt class="docutils literal"><span class="pre">--no-commit</span></tt> (or <tt class="docutils literal"><span class="pre">-n</span></tt>) option.  Running the editor on
the new <tt class="docutils literal">.topmsg</tt> file can be suppressed by using <tt class="docutils literal"><span class="pre">--no-edit</span></tt>
(which does <em>NOT</em> suppress the automatic commit unless <tt class="docutils literal"><span class="pre">--no-commit</span></tt>
is also given) or by providing an explicit value for the new
<tt class="docutils literal">.topmsg</tt> file using the <tt class="docutils literal"><span class="pre">--topmsg</span></tt> or <tt class="docutils literal"><span class="pre">--topmsg-file</span></tt> option.
In any case the <tt class="docutils literal">.topmsg</tt> content will be automatically reformated to
have a <tt class="docutils literal">Subject:</tt> header line if needed.</p>
<p>If the <tt class="docutils literal">format.signoff</tt> config variable (see <tt class="docutils literal">git help config</tt>)
has been set to true then the <tt class="docutils literal"><span class="pre">Signed-off-by:</span></tt> header line added to
the end of the initial version of the <tt class="docutils literal">.topmsg</tt> file will be
uncommented by default.  Otherwise it will still be there but will be
commented out and will be automatically stripped if no action is taken
to remove the comment character.</p>
<p>If more than one dependency is listed an automatic <tt class="docutils literal">tg update</tt> runs
after the branch has been created to merge in the additional
dependencies and bring the branch up-to-date.  This can be suppressed
with the <tt class="docutils literal"><span class="pre">--no-commit</span></tt> option (which also suppresses the initial
commit) or the <tt class="docutils literal"><span class="pre">--no-update</span></tt> option (which allows the initial commit
while suppressing only the update operation portion).</p>
<p>Previous versions of TopGit behaved as though both the <tt class="docutils literal"><span class="pre">--no-edit</span></tt>
and <tt class="docutils literal"><span class="pre">--no-commit</span></tt> options were always given on the command line.</p>
<p>The default behavior has been changed to promote a separation between
commits that modify <tt class="docutils literal">.topmsg</tt> and/or <tt class="docutils literal">.topdeps</tt> and commits that
modify other files.  This facilitates cleaner cherry picking and other
patch maintenance activities.</p>
<p>You should edit the patch description (contained in the <tt class="docutils literal">.topmsg</tt>
file) as appropriate.  It will already contain some prefilled bits.
You can set the <tt class="docutils literal">topgit.to</tt>, <tt class="docutils literal">topgit.cc</tt> and <tt class="docutils literal">topgit.bcc</tt>
git configuration variables (see <tt class="docutils literal">git help config</tt>) in order to
have <tt class="docutils literal">tg create</tt> add these headers with the given default values
to <tt class="docutils literal">.topmsg</tt> before invoking the editor.  If the configuration
variable <tt class="docutils literal">topgit.subjectPrefix</tt> is set its value will be inserted
<em>between</em> the initial <tt class="docutils literal">[</tt> and the word <tt class="docutils literal">PATCH</tt> in the subject
line (with a space added before the word <tt class="docutils literal">PATCH</tt> of course).</p>
<p>The main task of <tt class="docutils literal">tg create</tt> is to set up the topic branch base
from the dependencies.  This may fail due to merge conflicts if more
than one dependency is given.   In that case, after you commit the
conflict resolution, you should call <tt class="docutils literal">tg update <span class="pre">--continue</span></tt> to
finish merging the dependencies into the new topic branch base.</p>
<p>With the <tt class="docutils literal"><span class="pre">--base</span></tt> (aka <tt class="docutils literal"><span class="pre">--no-deps</span></tt>) option at most one dependency
may be listed which may be any valid committish (instead of just
refs/heads/...) and the newly created TopGit-controlled branch will
have an empty <tt class="docutils literal">.topdeps</tt> file.  This may be desirable in order to
create a TopGit-controlled branch that has no changes of its own and
serves merely to mark the common dependency that all other
TopGit-controlled branches in some set of TopGit-controlled branches
depend on.  A plain, non-TopGit-controlled branch can be used for the
same purpose, but the advantage of a TopGit-controlled branch with no
dependencies is that it will be pushed with <tt class="docutils literal">tg push</tt>, it will show
up in the <tt class="docutils literal">tg summary</tt> and <tt class="docutils literal">tg info</tt> output with the subject from
its <tt class="docutils literal">.topmsg</tt> file thereby documenting what it's for and finally it
can be set up with <tt class="docutils literal">tg create <span class="pre">-r</span></tt> and/or <tt class="docutils literal">tg remote <span class="pre">--populate</span></tt> to
facilitate sharing.</p>
<p>For example, <tt class="docutils literal">tg create <span class="pre">--base</span> t/release v2.1</tt> will create a TopGit-
controlled <tt class="docutils literal">t/release</tt> branch based off the <tt class="docutils literal">v2.1</tt> tag that can then
be used as a base for creation of other TopGit-controlled branches.
Then when the time comes to move the base for an entire set of changes
up to <tt class="docutils literal">v2.2</tt> the command <tt class="docutils literal">tg update <span class="pre">--base</span> t/release v2.2</tt> can be
used followed by <tt class="docutils literal">tg update <span class="pre">--all</span></tt>.</p>
<p>Using <tt class="docutils literal"><span class="pre">--base</span></tt> it's also possible to use <tt class="docutils literal">tg create</tt> on an
unborn branch (omit the dependency name or specify <tt class="docutils literal">HEAD</tt>).  The
unborn branch itself can be made into the new TopGit branch (rather
than being born empty and then having the new TopGit branch based off
that) by specifying <tt class="docutils literal">HEAD</tt> as the new branch's name (which is
probably what you normally want to do in this case anyway so you can
just run <tt class="docutils literal">tg create <span class="pre">--base</span> HEAD</tt> to accomplish that).</p>
<p>In an alternative use case, if <tt class="docutils literal"><span class="pre">-r</span> &lt;rbranch&gt;</tt> is given instead of a
dependency list, the topic branch is created based on the given
remote branch.  With just <tt class="docutils literal"><span class="pre">-r</span></tt> the remote branch name is assumed
to be the same as the local topic branch being created.  Since no
new commits are created in this mode (only two refs will be updated)
the editor will never be run for this use case.  Note that no other
options may be combined with <tt class="docutils literal"><span class="pre">-r</span></tt> although a global <tt class="docutils literal"><span class="pre">-r</span></tt> option
can be used to alter which remote <tt class="docutils literal">&lt;rbranch&gt;</tt> refers to.</p>
<p>The <tt class="docutils literal"><span class="pre">--quiet</span></tt> (or <tt class="docutils literal"><span class="pre">-q</span></tt>) option suppresses most informational
messages.</p>
</blockquote>
</div>
<div class="section" id="tg-delete">
<h2>tg delete</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> delete <span class="pre">[-f]</span> &lt;name&gt;</tt></div>
</div>
<p>Remove a TopGit-controlled topic branch of the given name
(required argument). Normally, this command will remove only an
empty branch (base == head) without dependents; use <tt class="docutils literal"><span class="pre">-f</span></tt> to
remove a non-empty branch or a branch that is depended upon by
another branch.</p>
<p>The <tt class="docutils literal"><span class="pre">-f</span></tt> option is also useful to force removal of a branch's
base, if you used <tt class="docutils literal">git branch <span class="pre">-D</span> B</tt> to remove branch B, and then
certain TopGit commands complain, because the base of branch B
is still there.</p>
<p>Normally <tt class="docutils literal">tg delete</tt> will refuse to delete the current branch.
However, giving <tt class="docutils literal"><span class="pre">-f</span></tt> twice (or more) will force it to do so but it
will first detach your HEAD.</p>
<p>IMPORTANT: Currently, this command will <em>NOT</em> remove the branch
from the dependency list in other branches. You need to take
care of this <em>manually</em>.  This is even more complicated in
combination with <tt class="docutils literal"><span class="pre">-f</span></tt> &#x2013; in that case, you need to manually
unmerge the removed branch's changes from the branches depending
on it.</p>
<p>The same <tt class="docutils literal"><span class="pre">--stash</span></tt> and <tt class="docutils literal"><span class="pre">--no-stash</span></tt> options are accepted with
the same exact semantics as for <a class="reference internal" href="#tg-update">tg update</a>.</p>
<p>See also <tt class="docutils literal">tg annihilate</tt>.</p>
<div class="line-block">
<div class="line">TODO: <tt class="docutils literal"><span class="pre">-a</span></tt> to delete all empty branches, depfix, revert</div>
</div>
</blockquote>
</div>
<div class="section" id="tg-annihilate">
<h2>tg annihilate</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> annihilate <span class="pre">[-f]</span> <span class="pre">[--no-update]</span> [&lt;name&gt;]</tt></div>
</div>
<p>Make a commit on the current or given TopGit-controlled topic
branch that makes it equal to its base, including the presence or
absence of .topmsg and .topdeps.  Annihilated branches are not
displayed by <tt class="docutils literal">tg summary</tt>, so they effectively get out of your
way.  However, the branch still exists, and <tt class="docutils literal">tg push</tt> will
push it (except if given the <tt class="docutils literal"><span class="pre">-a</span></tt> option).  This way, you can
communicate that the branch is no longer wanted.</p>
<p>When annihilating a branch that has dependents (i.e. branches
that depend on it), those dependents have the dependencies of
the branch being annihilated added to them if they do not already
have them as dependencies.  Essentially the DAG is repaired to
skip over the annihilated branch.</p>
<p>Normally, this command will remove only an empty branch
(base == head, except for changes to the .top* files); use
<tt class="docutils literal"><span class="pre">-f</span></tt> to annihilate a non-empty branch.</p>
<p>After completing the annihilation itself, normally <tt class="docutils literal">tg update</tt>
is run on any modified dependents.  Use the <tt class="docutils literal"><span class="pre">--no-update</span></tt> option
to suppress running <tt class="docutils literal">tg update</tt>.</p>
<p>The same <tt class="docutils literal"><span class="pre">--stash</span></tt> and <tt class="docutils literal"><span class="pre">--no-stash</span></tt> options are accepted with
the same exact semantics as for <a class="reference internal" href="#tg-update">tg update</a>.</p>
</blockquote>
</div>
<div class="section" id="tg-depend">
<h2>tg depend</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> depend add <span class="pre">[--no-update</span> | <span class="pre">--no-commit]</span> <span class="pre">&lt;name&gt;...</span></tt></div>
</div>
<p>Change the dependencies of a TopGit-controlled topic branch.
This should have several subcommands, but only <tt class="docutils literal">add</tt> is
supported right now.</p>
<p>The <tt class="docutils literal">add</tt> subcommand takes an argument naming a topic branch to
be added, adds it to <tt class="docutils literal">.topdeps</tt>, performs a commit and then
updates your topic branch accordingly.  If you want to do other
things related to the dependency addition, like adjusting
<tt class="docutils literal">.topmsg</tt>, use the option <tt class="docutils literal"><span class="pre">--no-commit</span></tt>.  Adding the
<tt class="docutils literal"><span class="pre">--no-update</span></tt> (or <tt class="docutils literal"><span class="pre">--no-commit</span></tt>) option will suppress the
<tt class="docutils literal">tg update</tt> normally performed after committing the change.</p>
<p>It is safe to run <tt class="docutils literal">tg depend add</tt> in a dirty worktree, but the
normally performed <tt class="docutils literal">tg update</tt> will be suppressed in that case
(even if neither <tt class="docutils literal"><span class="pre">--no-update</span></tt> nor <tt class="docutils literal"><span class="pre">--no-commit</span></tt> is given).</p>
<p>You have enabled <tt class="docutils literal">git rerere</tt> haven't you?</p>
<div class="line-block">
<div class="line">TODO: Subcommand for removing dependencies, obviously</div>
</div>
</blockquote>
</div>
<div class="section" id="tg-files">
<h2>tg files</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> files <span class="pre">[-i</span> | <span class="pre">-w]</span> [&lt;name&gt;]</tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-i</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use TopGit metadata from index instead of HEAD branch</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-w</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use metadata from working directory instead of branch</tt></div>
</div>
</div>
<p>List files changed by the current or specified topic branch.</p>
</blockquote>
</div>
<div class="section" id="tg-info">
<h2>tg info</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> info <span class="pre">[-i</span> | <span class="pre">-w]</span> <span class="pre">[--heads</span> | <span class="pre">--leaves</span> | <span class="pre">--series[=&lt;head&gt;]]</span> [&lt;name&gt;]</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> info <span class="pre">[-i</span> | <span class="pre">-w]</span> <span class="pre">[--deps</span> | <span class="pre">--dependencies</span> | <span class="pre">--dependents]</span> [&lt;name&gt;]</tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-i</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use TopGit metadata from index instead of HEAD branch</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-w</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use metadata from working directory instead of branch</tt></div>
</div>
</div>
<p>Show summary information about the current or specified topic
branch.</p>
<p>Numbers in parenthesis after a branch name such as &quot;(11/3 commits)&quot;
indicate how many commits on the branch (11) and how many of those
are non-merge commits (3).</p>
<p>With <tt class="docutils literal"><span class="pre">--verbose</span></tt> (or <tt class="docutils literal"><span class="pre">-v</span></tt>) include a list of dependents (i.e. other
branches that depend on this one).  Another <tt class="docutils literal"><span class="pre">--verbose</span></tt> annotates
them with &quot;[needs merge]&quot; if the current tip of branch for which info
is being shown has not yet been merged into the base of the dependent.
Two <tt class="docutils literal"><span class="pre">--verbose</span></tt> options also cause annihilated dependencies to be
shown in the &quot;Depends:&quot; list.</p>
<p>Alternatively, if <tt class="docutils literal"><span class="pre">--heads</span></tt> is used then which of the independent
TopGit branch heads (as output by <tt class="docutils literal">tg summary <span class="pre">--topgit-heads</span></tt>)
logically contains the specified commit (which may be any committish --
defaults to <tt class="docutils literal">HEAD</tt> if not given).  Zero or more results will be
output.  Note that &quot;logically&quot; means with regard to the TopGit
dependency relationships as established by the <tt class="docutils literal">.topdeps</tt> file(s).
It's the answer that would be given when all the TopGit branches are
up-to-date (even though they need not be to use this option) and the
<tt class="docutils literal">git branch <span class="pre">--contains</span></tt> command is run and the output then filtered
to only those branches that appear in <tt class="docutils literal">tg summary <span class="pre">--topgit-heads</span></tt>.
This computation may require several seconds on complex repositories.</p>
<p>If <tt class="docutils literal"><span class="pre">--leaves</span></tt> is used then the unique list of leaves of the current
or specified topic branch is shown as one fully-qualified ref per line.
Duplicates are suppressed and a tag name will be used when appropriate.
A &quot;leaf&quot; is any dependency that is either not a TopGit branch or is
the base of a non-annihilated TopGit branch with no non-annihilated
dependencies.</p>
<p>The <tt class="docutils literal"><span class="pre">--deps</span></tt> option shows non-annihilated TopGit dependencies of the
specified branch (default is <tt class="docutils literal">HEAD</tt>).  (It can also be spelled out
as <tt class="docutils literal"><span class="pre">--dependencies</span></tt> for the pedantically inclined.)</p>
<p>The <tt class="docutils literal"><span class="pre">--dependents</span></tt> option shows non-annihilated TopGit dependents
(i.e. branches that depend on the specified branch).  The default
branch to operate on is again <tt class="docutils literal">HEAD</tt>.</p>
<p>A linearized patch series can only be automatically created for a
TopGit topic branch (including its recursive dependencies) when exactly
one line is output by <tt class="docutils literal">tg info <span class="pre">--leaves</span> <span class="pre">&lt;topic-branch&gt;</span></tt> unless it's
always possible to merge all the leaves using a trivial aggressive
(exactly 2 leaves) or trivial aggressive octopus (3 or more leaves)
merge with an empty tree as the common base (aka tree1).</p>
<p>With <tt class="docutils literal"><span class="pre">--series</span></tt> the list of TopGit branches in the order they would
be linearized into a patch series is shown along with the description
of each branch.  If the branch name passed to <tt class="docutils literal">tg info</tt> is not the
last branch in the series a marker column will be provided to quickly
locate it in the list.  This same option can be used with <a class="reference internal" href="#tg-checkout">tg checkout</a>.</p>
<p>Some patches shown in the list may not actually end up introducing any
changes if exported and will therefore end up being omitted.  The <tt class="docutils literal">0</tt>
indicator in <tt class="docutils literal">tg summary</tt> output can help to identify some of these.</p>
<p>The patches shown in the series in the order they are shown form the
basis for the <tt class="docutils literal">tg next</tt> and <tt class="docutils literal">tg prev</tt> operations with the first
patch shown being considered the first and so on up to the last.</p>
</blockquote>
</div>
<div class="section" id="tg-patch">
<h2>tg patch</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> patch <span class="pre">[-q]</span> <span class="pre">[-i</span> | <span class="pre">-w]</span> <span class="pre">[--binary]</span> [&lt;name&gt;] <span class="pre">[--]</span> <span class="pre">[&lt;git-diff-tree-option&gt;...]</span></tt></div>
</div>
<p>Generate a patch from the current or specified topic branch.
This means that the diff between the topic branch base and head
(latest commit) is shown, appended to the description found in
the <tt class="docutils literal">.topmsg</tt> file.</p>
<p>The patch is simply dumped to stdout.  In the future, <tt class="docutils literal">tg patch</tt>
will be able to automatically send the patches by mail or save
them to files. (TODO)</p>
<dl class="docutils">
<dt>Options:</dt>
<dd><table class="first last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-i</span></kbd></td>
<td>base patch generation on index instead of branch</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-w</span></kbd></td>
<td>base patch generation on working tree instead of branch</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--binary</span></kbd></td>
<td>pass --binary to <tt class="docutils literal">git <span class="pre">diff-tree</span></tt> to enable generation
of binary patches</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--quiet</span></kbd></td>
<td>be quiet (aka <tt class="docutils literal"><span class="pre">-q</span></tt>) about missing and unfixed From:</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--from</span></kbd></td>
<td>make sure patch has a From: line, if not add one</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--from=<var>&lt;a&gt;</var></span></kbd></td>
<td>&lt;a&gt; or Signed-off-by value or ident value; <tt class="docutils literal">git am</tt>
really gets unhappy with patches missing From: lines;
will NOT replace an existing non-empty From: header</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--no-from</span></kbd></td>
<td>leave all From: lines alone, missing or not (default)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--diff-opt</span></kbd></td>
<td>options after the branch name (and an optional <tt class="docutils literal"><span class="pre">--</span></tt>)
are passed directly to <tt class="docutils literal">git <span class="pre">diff-tree</span></tt></td></tr>
</tbody>
</table>
</dd>
</dl>
<p>In order to pass a sole explicit <tt class="docutils literal"><span class="pre">-w</span></tt> through to <tt class="docutils literal">git <span class="pre">diff-tree</span></tt> it
must be separated from the <tt class="docutils literal">tg</tt> options by an explicit <tt class="docutils literal"><span class="pre">--</span></tt>.
Or it can be spelled as <tt class="docutils literal"><span class="pre">--ignore-all-space</span></tt> to distinguuish it from
<tt class="docutils literal">tg</tt>'s <tt class="docutils literal"><span class="pre">-w</span></tt> option.</p>
<p>If the config variable <tt class="docutils literal">topgit.from</tt> is set to a boolean it can be
used to enable or disable the <tt class="docutils literal"><span class="pre">--from</span></tt> option by default.  If it's
set to the special value <tt class="docutils literal">quiet</tt> the <tt class="docutils literal"><span class="pre">--quiet</span></tt> option is enabled
and From: lines are left alone by default.  Any other non-empty value
is taken as a default <tt class="docutils literal"><span class="pre">--from=&lt;value&gt;</span></tt> option.  The <tt class="docutils literal"><span class="pre">--no-from</span></tt>
option will temporarily disable use of the config value.</p>
<p>If additional non-<tt class="docutils literal">tg</tt> options are passed through to
<tt class="docutils literal">git <span class="pre">diff-tree</span></tt> (other than <tt class="docutils literal"><span class="pre">--binary</span></tt> which is fully supported)
the resulting <tt class="docutils literal">tg patch</tt> output may not be appliable.</p>
</blockquote>
</div>
<div class="section" id="tg-mail">
<h2>tg mail</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> mail <span class="pre">[-s</span> <span class="pre">&lt;send-email-args&gt;]</span> <span class="pre">[-r</span> <span class="pre">&lt;reference-msgid&gt;]</span> <span class="pre">[-i</span> | <span class="pre">-w]</span> [&lt;name&gt;]</tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-i</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use TopGit metadata from index instead of HEAD branch</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-w</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use metadata from working directory instead of branch</tt></div>
</div>
</div>
<p>Send a patch from the current or specified topic branch as
email(s).</p>
<p>Takes the patch given on the command line and emails it out.
Destination addresses such as To, Cc and Bcc are taken from the
patch header.</p>
<p>Since it actually boils down to <tt class="docutils literal">git <span class="pre">send-email</span></tt>, please refer
to the documentation for that for details on how to setup email
for git.  You can pass arbitrary options to this command through
the <tt class="docutils literal"><span class="pre">-s</span></tt> parameter, but you must double-quote everything.  The
<tt class="docutils literal"><span class="pre">-r</span></tt> parameter with a msgid can be used to generate in-reply-to
and reference headers to an earlier mail.</p>
<p>WARNING: be careful when using this command.  It easily sends
out several mails.  You might want to run:</p>
<pre class="literal-block">
git config sendemail.confirm always
</pre>
<p>to let <tt class="docutils literal">git <span class="pre">send-email</span></tt> ask for confirmation before sending any
mail.</p>
<div class="line-block">
<div class="line">TODO: <tt class="docutils literal">tg mail patchfile</tt> to mail an already exported patch</div>
<div class="line">TODO: mailing patch series</div>
<div class="line">TODO: specifying additional options and addresses on command line</div>
</div>
</blockquote>
</div>
<div class="section" id="tg-remote">
<h2>tg remote</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> remote <span class="pre">[--populate]</span> [&lt;remote&gt;]</tt></div>
</div>
<p>Register the given remote as TopGit-controlled. This will create
the namespace for the remote branch bases and teach <tt class="docutils literal">git fetch</tt>
to operate on them. However, from TopGit 0.8 onwards you need to
use <tt class="docutils literal">tg push</tt>, or <tt class="docutils literal">git push <span class="pre">--mirror</span></tt>, for pushing
TopGit-controlled branches.</p>
<p><tt class="docutils literal">tg remote</tt> takes an optional remote name argument, and an
optional <tt class="docutils literal"><span class="pre">--populate</span></tt> switch.  Use <tt class="docutils literal"><span class="pre">--populate</span></tt> for your
origin-style remotes: it will seed the local topic branch system
based on the remote topic branches.  <tt class="docutils literal"><span class="pre">--populate</span></tt> will also make
<tt class="docutils literal">tg remote</tt> automatically fetch the remote, and <tt class="docutils literal">tg update</tt> look
at branches of this remote for updates by default.</p>
<p>Using <tt class="docutils literal"><span class="pre">--populate</span></tt> with a remote name causes the <tt class="docutils literal">topgit.remote</tt>
git configuration variable to be set to the given remote name.</p>
</blockquote>
</div>
<div class="section" id="tg-summary">
<h2>tg summary</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">[--terse</span> | <span class="pre">--list]</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">--rdeps[-full]</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">--heads[-independent]</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">--deps</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">--deps-only</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">--sort</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> summary <span class="pre">--graphviz</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">[--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--terse</span> / <span class="pre">--list</span>&#160;&#160;&#160; list TopGit branches (aka <span class="pre">'-t'</span> / <span class="pre">'-l')</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--rdeps[-once]</span>&#160;&#160;&#160;&#160;&#160; show branch dependencies as <span class="pre">multi-indented</span> list</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--rdeps-full</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; like <span class="pre">'--rdeps'</span> but do not collapse repeated items</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--rdeps</span> <span class="pre">--heads</span>&#160;&#160;&#160;&#160; use <span class="pre">'--rdeps'</span> and <span class="pre">$('--heads'</span> of <span class="pre">&lt;branch&gt;...)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--[topgit-]heads</span>&#160;&#160;&#160; list only independent TopGit branch heads</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--heads-independent</span> list only <span class="pre">merge-base</span> <span class="pre">--independent</span> heads</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--deps</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; list all .topdeps branch dependencies</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--deps-only</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; list sorted unique .topdeps branches + dependencies</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--sort</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; feed output of <span class="pre">'--deps'</span> through 'tsort'</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--graphviz</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; generate dependency graph description in DOT format</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--verbose</span> / <span class="pre">-v</span>&#160;&#160;&#160;&#160;&#160; include subjects with <span class="pre">'-l'</span> (twice shows annihilated)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--exclude</span> &lt;branch&gt;&#160; exclude &lt;branch&gt; during operation (may be repeated)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--tgish-only</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; exclude <span class="pre">non-TopGit</span> branches (aka <span class="pre">'--tgish')</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--with-deps</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; include dependencies of given <span class="pre">&lt;branch&gt;...</span> (default)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--without-deps</span>&#160;&#160;&#160;&#160;&#160; do not include dependencies of given <span class="pre">&lt;branch&gt;...</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--with-related</span>&#160;&#160;&#160;&#160;&#160; use <span class="pre">'--with-deps'</span> and <span class="pre">$('--heads'</span> of <span class="pre">&lt;branch&gt;...)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--without-related</span>&#160;&#160; do not use <span class="pre">'--with-related'</span> processing</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--heads-only</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; use <span class="pre">'--without-deps'</span> and <span class="pre">$('--heads'</span> of <span class="pre">&lt;branch&gt;...)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-i</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use TopGit metadata from index instead of HEAD branch</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-w</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use metadata from working directory instead of branch</tt></div>
</div>
</div>
<p>Show overview of all TopGit-tracked topic branches and their
up-to-date status.  With a branch name limit output to that branch.
Using <tt class="docutils literal"><span class="pre">--deps-only</span></tt> or <tt class="docutils literal"><span class="pre">--rdeps</span></tt> changes the default from all
branches to just the current <tt class="docutils literal">HEAD</tt> branch but using <tt class="docutils literal"><span class="pre">--all</span></tt> as
the branch name will show results for all branches instead of <tt class="docutils literal">HEAD</tt>.</p>
<blockquote>
<dl class="docutils">
<dt><tt class="docutils literal">&gt;</tt></dt>
<dd>marks the current topic branch</dd>
<dt><tt class="docutils literal">0</tt></dt>
<dd>indicates that it introduces no changes of its own</dd>
<dt><tt class="docutils literal">l</tt>/<tt class="docutils literal">r</tt></dt>
<dd>indicates respectively whether it is local-only
or has a remote mate</dd>
<dt><tt class="docutils literal">L</tt>/<tt class="docutils literal">R</tt></dt>
<dd>indicates respectively if it is ahead or out-of-date
with respect to its remote mate</dd>
<dt><tt class="docutils literal">D</tt></dt>
<dd>indicates that it is out-of-date with respect to its
dependencies</dd>
<dt><tt class="docutils literal">!</tt></dt>
<dd>indicates that it has missing dependencies [even if
they are recursive ones]</dd>
<dt><tt class="docutils literal">B</tt></dt>
<dd>indicates that it is out-of-date with respect to
its base</dd>
<dt><tt class="docutils literal">*</tt></dt>
<dd>indicates it is ahead of (and needs to be merged into)
at least one of its dependents &#x2013; only computed when
showing all branches or using the (possibly implied)
<tt class="docutils literal"><span class="pre">--with-deps</span></tt> option.</dd>
</dl>
</blockquote>
<p>This can take a longish time to accurately determine all the
relevant information about each branch; you can pass <tt class="docutils literal"><span class="pre">-t</span></tt> (or <tt class="docutils literal"><span class="pre">-l</span></tt>
or <tt class="docutils literal"><span class="pre">--list</span></tt>) to get just a terse list of topic branch names quickly.
Also adding <tt class="docutils literal"><span class="pre">--verbose</span></tt> (or <tt class="docutils literal"><span class="pre">-v</span></tt>) includes the subjects too.
Adding a second <tt class="docutils literal"><span class="pre">--verbose</span></tt> includes annihilated branches as well.</p>
<p>Passing <tt class="docutils literal"><span class="pre">--heads</span></tt> shows independent topic branch names and when
combined with <tt class="docutils literal"><span class="pre">--rdeps</span></tt> behaves as though <tt class="docutils literal"><span class="pre">--rdeps</span></tt> were run with
the output of <tt class="docutils literal"><span class="pre">--heads</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">--heads-independent</span></tt> option works just like <tt class="docutils literal"><span class="pre">--heads</span></tt> except
that it computes the heads using <tt class="docutils literal">git <span class="pre">merge-base</span> <span class="pre">--independent</span></tt>
rather than examining the TopGit <tt class="docutils literal">.topdeps</tt> relationships.  If the
TopGit branches are all up-to-date (as shown in <tt class="docutils literal">tg summary</tt>) then
both <tt class="docutils literal"><span class="pre">--heads</span></tt> and <tt class="docutils literal"><span class="pre">--heads-independent</span></tt> should compute the same
list of heads (unless some overlapping TopGit branches have been
manually created).  If not all the TopGit branches are up-to-date then
the <tt class="docutils literal"><span class="pre">--heads-independent</span></tt> results may have extra items in it, but
occasionally that's what's needed; usually it's the wrong answer.
(Note that <tt class="docutils literal"><span class="pre">--topgit-heads</span></tt> is accepted as an alias for <tt class="docutils literal"><span class="pre">--heads</span></tt>
as well.)</p>
<p>Using <tt class="docutils literal"><span class="pre">--heads-only</span></tt> behaves as though the output of <tt class="docutils literal"><span class="pre">--heads</span></tt> was
passed as the list of branches along with <tt class="docutils literal"><span class="pre">--without-deps</span></tt>.</p>
<p>Alternatively, you can pass <tt class="docutils literal"><span class="pre">--graphviz</span></tt> to get a dot-suitable output
for drawing a dependency graph between the topic branches.</p>
<p>You can also use the <tt class="docutils literal"><span class="pre">--sort</span></tt> option to sort the branches using
a topological sort.  This is especially useful if each
TopGit-tracked topic branch depends on a single parent branch,
since it will then print the branches in the dependency order.
In more complex scenarios, a text graph view would be much more
useful, but that has not yet been implemented.</p>
<p>The <tt class="docutils literal"><span class="pre">--deps</span></tt> option outputs dependency information between
branches in a machine-readable format.  Feed this to <tt class="docutils literal">tsort</tt> to
get the output from --sort.</p>
<p>The <tt class="docutils literal"><span class="pre">--deps-only</span></tt> option outputs a sorted list of the unique branch
names given on the command line plus all of their recursive
dependencies (subject to <tt class="docutils literal"><span class="pre">--exclude</span></tt> of course).  When
<tt class="docutils literal"><span class="pre">--deps-only</span></tt> is given the default is to just display information for
<tt class="docutils literal">HEAD</tt>, but that can be changed by using <tt class="docutils literal"><span class="pre">--all</span></tt> as the branch
name.  Each branch name will appear only once in the output no matter
how many times it's visited while tracing the dependency graph or how
many branch names are given on the command line to process.</p>
<p>The <tt class="docutils literal"><span class="pre">--rdeps</span></tt> option outputs dependency information in an indented
text format that clearly shows all the dependencies and their
relationships to one another.  When <tt class="docutils literal"><span class="pre">--rdeps</span></tt> is given the default is
to just display information for <tt class="docutils literal">HEAD</tt>, but that can be changed by
using <tt class="docutils literal"><span class="pre">--all</span></tt> as the branch name or by adding the <tt class="docutils literal"><span class="pre">--heads</span></tt> option.
Note that <tt class="docutils literal">tg summary <span class="pre">--rdeps</span> <span class="pre">--heads</span></tt> can be particularly helpful in
seeing all the TopGit-controlled branches in the repository and their
relationships to one another.</p>
<p>Note that <tt class="docutils literal"><span class="pre">--rdeps</span></tt> has two flavors.  The first (and default) is
<tt class="docutils literal"><span class="pre">--rdeps-once</span></tt> which only shows the dependencies of a branch when
it's first visited.  For example, if D depends on several other
branches perhaps recursively and both branch A and B depend on D, then
whichever of A or B is shown first will show the entire dependency
chain for D underneath it and the other one will just show a line for
D itself with a &quot;^&quot; appended to indicate that the rest of the deps for
D can be found above.  This can make the output a bit more compact
without actually losing any information which is why it's the default.
However, using the <tt class="docutils literal"><span class="pre">--rdeps-full</span></tt> variant will repeat the full
dependency chain every time it's encountered.</p>
<p>Adding <tt class="docutils literal"><span class="pre">--with-deps</span></tt> replaces the given list of branches (which will
default to <tt class="docutils literal">HEAD</tt> if none are given) with the result of running
<tt class="docutils literal">tg summary <span class="pre">--deps-only</span> <span class="pre">--tgish</span></tt> on the list of branches.  This can
be helpful in limiting <tt class="docutils literal">tg summary</tt> output to only the list of given
branches and their dependencies when many TopGit-controlled branches
are present in the repository.  Use <tt class="docutils literal"><span class="pre">--without-deps</span></tt> to switch back
to the old behavior.</p>
<p>The <tt class="docutils literal"><span class="pre">--with-related</span></tt> option extends (and therefore implies)
<tt class="docutils literal"><span class="pre">--with-deps</span></tt>.  First the list of branches (which will default to
<tt class="docutils literal">HEAD</tt> if none are given) is replaced with the result of running
<tt class="docutils literal">tg summary <span class="pre">--heads</span></tt> (aka <tt class="docutils literal"><span class="pre">--topgit-heads</span></tt>) and the result is then
processed as though it had been specified using <tt class="docutils literal"><span class="pre">--with-deps</span></tt>.</p>
<p>When it would be allowed, <tt class="docutils literal"><span class="pre">--with-deps</span></tt> is now the default.  But,
if in addition, exactly one branch is specified (either explicitly
or implicitly) and it's spelled <em>exactly</em> as <tt class="docutils literal">HEAD</tt> or <tt class="docutils literal">&#64;</tt> then
the default <tt class="docutils literal"><span class="pre">--with-deps</span></tt> will be promoted to a default
<tt class="docutils literal"><span class="pre">--with-related</span></tt> instead.  Since duplicate branches are removed
before processing, explicitly listing <tt class="docutils literal">&#64;</tt> twice provides an easy way
to defeat this automatic promotion and ask for <tt class="docutils literal"><span class="pre">--with-deps</span></tt> on the
<tt class="docutils literal">HEAD</tt> symbolic ref with minimal typing when <tt class="docutils literal"><span class="pre">--with-related</span></tt> isn't
really wanted and typing the full <tt class="docutils literal"><span class="pre">--with-deps</span></tt> option is too hard.</p>
<p>With <tt class="docutils literal"><span class="pre">--exclude</span> branch</tt>, branch can be excluded from the output
meaning it will be skipped and its name will be omitted from any
dependency output.  The <tt class="docutils literal"><span class="pre">--exclude</span></tt> option may be repeated to omit
more than one branch from the output.  Limiting the output to a single
branch that has been excluded will result in no output at all.</p>
<p>The <tt class="docutils literal"><span class="pre">--tgish-only</span></tt> option behaves as though any non-TopGit-controlled
dependencies encountered during processing had been listed after an
<tt class="docutils literal"><span class="pre">--exclude</span></tt> option.</p>
<p>Note that the branch name can be specified as <tt class="docutils literal">HEAD</tt> or <tt class="docutils literal">&#64;</tt> as a
shortcut for the TopGit-controlled branch that <tt class="docutils literal">HEAD</tt> is a
symbolic ref to.  The <tt class="docutils literal">tg summary &#64;</tt> and <tt class="docutils literal">tg summary &#64; &#64;</tt> commands
can be quite useful.</p>
</blockquote>
</div>
<div class="section" id="tg-contains">
<h2>tg contains</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> contains <span class="pre">[-v]</span> <span class="pre">[-r]</span> <span class="pre">[--ann]</span> <span class="pre">[--no-strict]</span> <span class="pre">[--]</span> &lt;committish&gt;</tt></div>
</div>
<p>Search all TopGit-controlled branches (and optionally their remotes)
to find which TopGit-controlled branch contains the specified commit.</p>
<p>This is more than just basic branch containment as provided for by the
<tt class="docutils literal">git branch <span class="pre">--contains</span></tt> command.  While the shown branch name(s)
will, indeed, be one (or more) of those output by the
<tt class="docutils literal">git branch <span class="pre">--contains</span></tt> command, the result(s) will exclude any
TopGit-controlled branches from the result(s) that have one (or more)
of their TopGit dependencies (either direct or indirect) appearing in
the <tt class="docutils literal">git branch <span class="pre">--contains</span></tt> output.</p>
<p>Normally the result will be only the one, single TopGit-controlled
branch for which the specified committish appears in the <tt class="docutils literal">tg log</tt>
output for that branch (unless the committish lies outside the
TopGit-controlled portion of the DAG and <tt class="docutils literal"><span class="pre">--no-strict</span></tt> was used).</p>
<p>Unless <tt class="docutils literal"><span class="pre">--annihilated-okay</span></tt> (or <tt class="docutils literal"><span class="pre">--ann</span></tt> or <tt class="docutils literal"><span class="pre">--annihilated</span></tt>) is
used then annihilated branches will be immediately removed from the
<tt class="docutils literal">git branch <span class="pre">--contains</span></tt> output before doing anything else.  This
means a committish that was originally located in a now-annihilated
branch will show up in whatever branch picked up the annihilated
branch's changes (if there is one).  This is usually the correct
answer, but occasionally it's not; hence this option.  If this option
is used together with <tt class="docutils literal"><span class="pre">--verbose</span></tt> then annihilated branches will
be shown as &quot;[:annihilated:]&quot;.</p>
<p>In other words, if a <tt class="docutils literal">tg patch</tt> is generated for the found branch
(assuming one was found and a subsequent commit in the same branch
didn't then revert or otherwise back out the change), then that patch
will include the changes introduced by the specified committish
(unless, of course, that committish is outside the TopGit-controlled
portion of the DAG and <tt class="docutils literal"><span class="pre">--no-strict</span></tt> was given).</p>
<p>This can be very helpful when, for example, a bug is discovered and
then after using <tt class="docutils literal">git bisect</tt> (or some other tool) to find the
offending commit it's time to commit the fix.  But because the
TopGit merging history can be quite complicated and maybe the one
doing the fix wasn't the bug's author (or the author's memory is just
going), it can sometimes be rather tedious to figure out which
TopGit branch the fix belongs in.  The <tt class="docutils literal">tg contains</tt> command can
quickly tell you the answer to that question.</p>
<p>With the <tt class="docutils literal"><span class="pre">--remotes</span></tt> (or <tt class="docutils literal"><span class="pre">-r</span></tt>) option a TopGit-controlled remote
branch name may be reported as the result but only if there is no
non-remote branch containing the committish (this can only happen
if at least one of the TopGit-controlled local branches are not yet
up-to-date with their remotes).</p>
<p>With the <tt class="docutils literal"><span class="pre">--verbose</span></tt> option show which TopGit DAG head(s) (one or
more of the TopGit-controlled branch names output by
<tt class="docutils literal">tg summary <span class="pre">--heads</span></tt>) have the result as a dependency (either direct
or indirect).  Using this option will noticeably increase running time.</p>
<p>With the default <tt class="docutils literal"><span class="pre">--strict</span></tt> option, results for which the base of the
TopGit-controlled branch contains the committish will be suppressed.
For example, if the committish was deep-down in the master branch
history somewhere far outside of the TopGit-controlled portion of
the DAG, with <tt class="docutils literal"><span class="pre">--no-strict</span></tt>, whatever TopGit-controlled branch(es)
first picked up history containing that committish will be shown.
While this is a useful result it's usually not the desired result
which is why it's not the default.</p>
<p>To summarize, even with <tt class="docutils literal"><span class="pre">--remotes</span></tt>, remote results are only shown
if there are no non-remote results.  Without <tt class="docutils literal"><span class="pre">--no-strict</span></tt> (because
<tt class="docutils literal"><span class="pre">--strict</span></tt> is the default) results outside the TopGit-controlled
portion of the DAG are never shown and even with <tt class="docutils literal"><span class="pre">--no-strict</span></tt> they
will only be shown if there are no <tt class="docutils literal"><span class="pre">--strict</span></tt> results.  Finally,
the TopGit head info shown with <tt class="docutils literal"><span class="pre">--verbose</span></tt> only ever appears for
local (i.e. not a remote branch) results.  Annihilated branches are
never considered possible matches without <tt class="docutils literal"><span class="pre">--annihilated-okay</span></tt>.</p>
</blockquote>
</div>
<div class="section" id="tg-checkout">
<h2>tg checkout</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> checkout <span class="pre">[&lt;opt&gt;...]</span> <span class="pre">[-b</span> &lt;branch&gt;] (next | prev) [&lt;steps&gt;]</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> checkout <span class="pre">[&lt;opt&gt;...]</span> (next | prev) <span class="pre">-a</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> checkout <span class="pre">[&lt;opt&gt;...]</span> [goto] <span class="pre">[--]</span> &lt;pattern&gt; | <span class="pre">--series[=&lt;head&gt;]</span></tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--iow</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pass <span class="pre">'--ignore-other-worktrees'</span> to git &gt;= v2.5.0</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--force</span> / <span class="pre">-f</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; pass <span class="pre">'--force'</span> option to git</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--merge</span> / <span class="pre">-m</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; pass <span class="pre">'--merge'</span> option to git</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--quiet</span> / <span class="pre">-q</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; pass <span class="pre">'--quiet'</span> option to git</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--branch</span> &lt;branch&gt;&#160;&#160; start at branch &lt;branch&gt; instead of HEAD</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-b</span> &lt;branch&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; alias for <span class="pre">--branch</span> &lt;branch&gt;</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--all</span> / <span class="pre">-a</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; step as many times as possible</tt></div>
</div>
</div>
<p>Switch to a topic branch.  You can use <tt class="docutils literal">git checkout &lt;branch&gt;</tt>
to get the same effect, but this command helps you navigate
the dependency graph, or allows you to match the topic branch
name using a regular expression, so it can be more convenient.</p>
<p>The <tt class="docutils literal"><span class="pre">--branch</span></tt> (or <tt class="docutils literal"><span class="pre">-b</span></tt> or <tt class="docutils literal"><span class="pre">--branch=&lt;name&gt;</span></tt>) option changes
the default starting point from <tt class="docutils literal">HEAD</tt> to the specified branch.</p>
<p>For the &quot;next&quot; and &quot;previous&quot; commands, the <tt class="docutils literal">&lt;steps&gt;</tt> value may
be <tt class="docutils literal"><span class="pre">--all</span></tt> (or <tt class="docutils literal"><span class="pre">-a</span></tt>) to take &quot;As many steps As possible&quot; or
&quot;step ALL the way&quot; or &quot;ALL steps at once&quot; (or make something better
up yourself).</p>
<p>The following subcommands are available:</p>
<blockquote>
<dl class="docutils">
<dt><tt class="docutils literal">tg checkout next [&lt;steps&gt;]</tt></dt>
<dd>Check out a subsequent branch in the
dependency graph (see <tt class="docutils literal">tg info <span class="pre">--series</span></tt>).
Move <tt class="docutils literal">&lt;steps&gt;</tt> (default 1) step(s) in
the &quot;next&quot; direction (AKA <tt class="docutils literal">n</tt>).</dd>
<dt><tt class="docutils literal">tg checkout prev [&lt;steps&gt;]</tt></dt>
<dd>Check out a preceding branch in the
dependency graph (see <tt class="docutils literal">tg info <span class="pre">--series</span></tt>).
Move <tt class="docutils literal">&lt;steps&gt;</tt> (default 1) step(s) in the
&quot;previous&quot; direction (AKA <tt class="docutils literal">p</tt> or <tt class="docutils literal">previous</tt>).</dd>
<dt><tt class="docutils literal">tg checkout [goto] <span class="pre">[--]</span> &lt;pattern&gt;</tt></dt>
<dd>Check out a topic branch that
matches <tt class="docutils literal">&lt;pattern&gt;</tt>.  <tt class="docutils literal">&lt;pattern&gt;</tt>
is used as a grep BRE pattern to filter
all the topic branches.  Both <tt class="docutils literal">goto</tt> and
<tt class="docutils literal"><span class="pre">--</span></tt> may be omitted provided <tt class="docutils literal">&lt;pattern&gt;</tt>
is not <tt class="docutils literal"><span class="pre">-a</span></tt>, <tt class="docutils literal"><span class="pre">--all</span></tt>, <tt class="docutils literal"><span class="pre">-h</span></tt>, <tt class="docutils literal"><span class="pre">--help</span></tt>,
<tt class="docutils literal">goto</tt>, <tt class="docutils literal"><span class="pre">--</span></tt>, <tt class="docutils literal">n</tt>, <tt class="docutils literal">next</tt>, <tt class="docutils literal">push</tt>,
<tt class="docutils literal">child</tt>, <tt class="docutils literal">p</tt>, <tt class="docutils literal">prev</tt>, <tt class="docutils literal">previous</tt>,
<tt class="docutils literal">pop</tt>, <tt class="docutils literal">parent</tt>, <tt class="docutils literal">+</tt>, <tt class="docutils literal">-</tt> or <tt class="docutils literal">..</tt>.</dd>
<dt><tt class="docutils literal">tg checkout [goto] <span class="pre">[--]</span> <span class="pre">--series[=&lt;head&gt;]</span></tt></dt>
<dd>Check out a topic branch that belongs to
the current (or <tt class="docutils literal">&lt;head&gt;</tt>) patch series.
A list with descriptions (<tt class="docutils literal">tg info <span class="pre">--series</span></tt>)
will be shown to choose from if more than one.</dd>
<dt><tt class="docutils literal">tg checkout + [&lt;steps&gt;]</tt></dt>
<dd>An alias for <tt class="docutils literal">next</tt>.</dd>
<dt><tt class="docutils literal">tg checkout push [&lt;steps&gt;]</tt></dt>
<dd>An alias for <tt class="docutils literal">next</tt>.</dd>
<dt><tt class="docutils literal">tg checkout child [&lt;steps&gt;]</tt></dt>
<dd>Deprecated alias for <tt class="docutils literal">next</tt>.</dd>
<dt><tt class="docutils literal">tg checkout</tt></dt>
<dd>Semi-deprecated alias for <tt class="docutils literal">next</tt>.</dd>
<dt><tt class="docutils literal">tg checkout - [&lt;steps&gt;]</tt></dt>
<dd>An alias for <tt class="docutils literal">prev</tt>.</dd>
<dt><tt class="docutils literal">tg checkout pop [&lt;steps&gt;]</tt></dt>
<dd>An alias for <tt class="docutils literal">prev</tt>.</dd>
<dt><tt class="docutils literal">tg checkout parent [&lt;steps&gt;]</tt></dt>
<dd>Deprecated alias for <tt class="docutils literal">prev</tt>.</dd>
<dt><tt class="docutils literal">tg checkout .. [&lt;steps&gt;]</tt></dt>
<dd>Semi-deprecated alias for <tt class="docutils literal">prev</tt>.</dd>
</dl>
</blockquote>
<p>If any of the above commands can find more than one possible
branch to switch to, you will be presented with the matches
and asked to select one of them.</p>
<p>Note that unless overridden by an explicit alias (see <a class="reference internal" href="#aliases">ALIASES</a>),
<tt class="docutils literal">tg goto</tt> is an implicit alias for <tt class="docutils literal">tg checkout goto</tt>.</p>
<p>If the <tt class="docutils literal"><span class="pre">--ignore-other-worktrees</span></tt> (or <tt class="docutils literal"><span class="pre">--iow</span></tt>) option is given and
the current Git version is at least 2.5.0 then the full
<tt class="docutils literal"><span class="pre">--ignore-other-worktrees</span></tt> option will be passed along to the
<tt class="docutils literal">git checkout</tt> command when it's run (otherwise the option will be
silently ignored and not passed to Git as it would cause an error).</p>
<p>The <tt class="docutils literal"><span class="pre">--force</span></tt> (or <tt class="docutils literal"><span class="pre">-f</span></tt>) option, when given, gets passed through to
the <tt class="docutils literal">git checkout</tt> command.</p>
<p>The <tt class="docutils literal"><span class="pre">--merge</span></tt> (or <tt class="docutils literal"><span class="pre">-m</span></tt>) option, when given, gets passed through to
the <tt class="docutils literal">git checkout</tt> command.</p>
<p>The <tt class="docutils literal"><span class="pre">--quiet</span></tt> (or <tt class="docutils literal"><span class="pre">-q</span></tt>) option, when given, gets passed through to
the <tt class="docutils literal">git checkout</tt> command.</p>
<p>The <tt class="docutils literal">&lt;pattern&gt;</tt> of <tt class="docutils literal">tg checkout goto</tt> is not optional and is
intepreted as a BRE pattern (basic regular expression).  To select
from all the available topic branches, supply <tt class="docutils literal">.</tt> as the pattern.
(In other words <tt class="docutils literal">tg checkout goto .</tt>)</p>
<p>Normally, the <tt class="docutils literal">next</tt> and <tt class="docutils literal">prev</tt> commands move one step in
the dependency graph of the topic branches.  The <tt class="docutils literal"><span class="pre">-a</span></tt> option
causes them (and their aliases) to move as far as possible.
That is, <tt class="docutils literal">tg checkout next <span class="pre">-a</span></tt> moves to the final topic branch
in the dependency graph (see <tt class="docutils literal">tg info <span class="pre">--series</span></tt>) for the
current branch.  <tt class="docutils literal">tg checkout prev <span class="pre">-a</span></tt> moves to the first
topic branch in the dependency graph (see <tt class="docutils literal">tg info <span class="pre">--series</span></tt>)
for the current branch.  If there is more than one
possibility, you will be prompted for your selection.</p>
<p>See also <a class="reference internal" href="#navigation">NAVIGATION</a>.</p>
</blockquote>
</div>
<div class="section" id="tg-export">
<h2>tg export</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> export <span class="pre">[--collapse]</span> <span class="pre">[--force]</span> <span class="pre">[&lt;option&gt;...]</span> &lt;newbranch&gt;</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> export <span class="pre">--linearize</span> <span class="pre">[--force]</span> <span class="pre">[&lt;option&gt;...]</span> &lt;newbranch&gt;</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> export <span class="pre">--quilt</span> <span class="pre">[--force]</span> <span class="pre">[-a</span> | <span class="pre">--all</span> | <span class="pre">-b</span> <span class="pre">&lt;branch&gt;...]</span> <span class="pre">[--binary]</span> <span class="pre">[--flatten]</span> <span class="pre">[--numbered]</span> <span class="pre">[--strip[=N]]</span> &lt;directory&gt;</tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-s</span> &lt;mode&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set subject bracketed [strings] strip mode</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--notes[=&lt;ref&gt;]</span>&#160;&#160;&#160;&#160; export .topmsg <span class="pre">---</span> comment to notes ref &lt;ref&gt;</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-notes</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; discard .topmsg <span class="pre">---</span> comment (default)</tt></div>
</div>
</div>
<p>Export a tidied-up history of the current topic branch and its
dependencies, suitable for feeding upstream.  Each topic branch
corresponds to a single commit or patch in the cleaned up
history (corresponding basically exactly to <tt class="docutils literal">tg patch</tt> output
for the topic branch).</p>
<p>The command has three possible outputs now &#x2013; either a Git branch
with the collapsed history, a Git branch with a linearized
history, or a quilt series in new directory.</p>
<p>In the case where you are producing collapsed history in a new
branch, you can use this collapsed structure either for
providing a pull source for upstream, or for further
linearization e.g. for creation of a quilt series using git log:</p>
<pre class="literal-block">
git log --pretty=email -p --topo-order origin..exported
</pre>
<p>To better understand the function of <tt class="docutils literal">tg export</tt>, consider this
dependency structure:</p>
<pre class="literal-block">
origin/master - t/foo/blue - t/foo/red - master
             `- t/bar/good &lt;,----------'
             `- t/baz      ------------'
</pre>
<p>(where each of the branches may have a hefty history). Then:</p>
<pre class="literal-block">
master$ tg export for-linus
</pre>
<p>will create this commit structure on the branch <tt class="docutils literal"><span class="pre">for-linus</span></tt>:</p>
<pre class="literal-block">
origin/master - t/foo/blue -. merge - t/foo/red -.. merge - master
             `- t/bar/good &lt;,-------------------'/
             `- t/baz      ---------------------'
</pre>
<p>In this mode, <tt class="docutils literal">tg export</tt> works on the current topic branch, and
can be called either without an option (in that case,
<tt class="docutils literal"><span class="pre">--collapse</span></tt> is assumed), or with the <tt class="docutils literal"><span class="pre">--collapse</span></tt> option, and
with one mandatory argument: the name of the branch where the
exported result will be stored.</p>
<p>Both the <tt class="docutils literal"><span class="pre">--collapse</span></tt> and <tt class="docutils literal"><span class="pre">--linearize</span></tt> modes also accept a
<tt class="docutils literal"><span class="pre">-s</span> &lt;mode&gt;</tt> option to specify subject handling behavior for the
freshly created commits.  There are five possible modes:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th align="left" class="field-name">keep:</th><td class="field-body">Like <tt class="docutils literal">git mailinfo <span class="pre">-k</span></tt></td>
</tr>
<tr class="field"><th align="left" class="field-name">mailinfo:</th><td class="field-body">Like <tt class="docutils literal">git mailinfo</tt></td>
</tr>
<tr class="field"><th align="left" class="field-name">patch:</th><td class="field-body">Remove first [PATCH*] if any</td>
</tr>
<tr class="field"><th align="left" class="field-name">topgit:</th><td class="field-body">Remove first [PATCH*], [BASE], [ROOT] or [STAGE]</td>
</tr>
<tr class="field"><th align="left" class="field-name">trim:</th><td class="field-body">Trim runs of spaces/tabs to a single space</td>
</tr>
</tbody>
</table>
</blockquote>
<p>The <tt class="docutils literal">topgit</tt> (aka <tt class="docutils literal">tg</tt>) mode is the default (quelle surprise) and
like the <tt class="docutils literal">patch</tt> mode will only strip the first square brackets tag
(if there is one) provided it's a TopGit-known tag (the <tt class="docutils literal">patch</tt>
variation will only strip a &quot;[PATCH*]&quot; tag but still just the first
one).  Note that TopGit does understand &quot;[RELEASE]&quot; in <tt class="docutils literal">topgit</tt> mode.
With <tt class="docutils literal">trim</tt> (aka <tt class="docutils literal">ws</tt>) internal runs of spaces/tabs are converted
to a single space, but no square brackets tags are removed.  The <tt class="docutils literal">ws</tt>
mode should generally be preferred instead of using <tt class="docutils literal">keep</tt> mode.
All modes always remove leading/trailing spaces and tabs and if the
<tt class="docutils literal">topgit.subjectPrefix</tt> value (see <a class="reference internal" href="#tg-create">tg create</a>) has been set both the
<tt class="docutils literal">topgit</tt> and <tt class="docutils literal">patch</tt> modes will match tags with that prefix too.</p>
<p>Setting the config variable <tt class="docutils literal">topgit.subjectMode</tt> to one of the mode
values shown above will change the default to that mode.</p>
<p>Both the <tt class="docutils literal"><span class="pre">--collapse</span></tt> and <tt class="docutils literal"><span class="pre">--linearize</span></tt> modes also accept a
<tt class="docutils literal"><span class="pre">--notes[=&lt;ref&gt;]</span></tt> option to export the portion of the .topmsg file
following a <tt class="docutils literal"><span class="pre">---</span></tt> separator line to the specified notes ref.  If
<tt class="docutils literal">&lt;ref&gt;</tt> is omitted then <tt class="docutils literal">refs/notes/commits</tt> will be used.  If
<tt class="docutils literal">&lt;ref&gt;</tt> does not start with <tt class="docutils literal">refs/notes/</tt> then <tt class="docutils literal">refs/notes/</tt>
will be prepended unless it starts with <tt class="docutils literal">notes/</tt> in which case
only <tt class="docutils literal">refs/</tt> will be prepended.</p>
<p>Setting the config variable <tt class="docutils literal">topgit.notesExport</tt> to a boolean or
to a <tt class="docutils literal">&lt;ref&gt;</tt> name will set the default for the <tt class="docutils literal"><span class="pre">--notes</span></tt> option
(with no config or <tt class="docutils literal"><span class="pre">--notes[=&lt;ref&gt;]</span></tt> option the <tt class="docutils literal"><span class="pre">---</span></tt> comment is
discarded by default).  To override a <tt class="docutils literal">topgit.notesExport</tt> option
and discard any <tt class="docutils literal"><span class="pre">---</span></tt> comments, use <tt class="docutils literal"><span class="pre">--no-notes</span></tt>.</p>
<p>When using the linearize mode:</p>
<pre class="literal-block">
master$ tg export --linearize for-linus
</pre>
<p>you get a linear history respecting the dependencies of your
patches in a new branch <tt class="docutils literal"><span class="pre">for-linus</span></tt>.  The result should be more
or less the same as using quilt mode and then reimporting it
into a Git branch.  (More or less because the topological order
can usually be extended in more than one way into a total order,
and the two methods may choose different ones.)  The result
might be more appropriate for merging upstream, as it contains
fewer merges.</p>
<p>Note that you might get conflicts during linearization because
the patches are reordered to get a linear history.  If linearization
would produce conflicts then using <tt class="docutils literal"><span class="pre">--quilt</span></tt> will also likely result
in conflicts when the exported quilt series is applied.  Since the
<tt class="docutils literal"><span class="pre">--quilt</span></tt> mode simply runs a series of <tt class="docutils literal">tg patch</tt> commands to
generate the patches in the exported quilt series and those patches
will end up being applied linearly, the same conflicts that would be
produced by the <tt class="docutils literal"><span class="pre">--linearize</span></tt> option will then occur at that time.</p>
<p>To avoid conflicts produced by <tt class="docutils literal"><span class="pre">--linearize</span></tt> (or by applying the
<tt class="docutils literal"><span class="pre">--quilt</span></tt> output), use the default <tt class="docutils literal"><span class="pre">--collapse</span></tt> mode and then use
<tt class="docutils literal">tg rebase</tt> (or <tt class="docutils literal">git rebase <span class="pre">-m</span></tt> directly) on the collapsed branch
(with a suitable &lt;upstream&gt;) followed by <tt class="docutils literal">git <span class="pre">format-patch</span></tt> on the
rebased result to produce a conflict-free patch set.  A suitable
upstream may be determined with the <tt class="docutils literal">tg info <span class="pre">--leaves</span></tt> command (if
it outputs more than one line, linearization will be problematic).</p>
<p>You have enabled <tt class="docutils literal">git rerere</tt> haven't you?</p>
<p>When using the quilt mode:</p>
<pre class="literal-block">
master$ tg export --quilt for-linus
</pre>
<p>would create the following directory <tt class="docutils literal"><span class="pre">for-linus</span></tt>:</p>
<pre class="literal-block">
for-linus/t/foo/blue.diff
for-linus/t/foo/red.diff
for-linus/t/bar/good.diff
for-linus/t/baz.diff
for-linus/series:
       t/foo/blue.diff -p1
       t/bar/good.diff -p1
       t/foo/red.diff -p1
       t/baz.diff -p1
</pre>
<p>With <tt class="docutils literal"><span class="pre">--quilt</span></tt>, you can also pass the <tt class="docutils literal"><span class="pre">-b</span></tt> parameter followed
by a comma-separated explicit list of branches to export, or
the <tt class="docutils literal"><span class="pre">--all</span></tt> parameter (which can be shortened to <tt class="docutils literal"><span class="pre">-a</span></tt>) to
export them all.  The <tt class="docutils literal"><span class="pre">--binary</span></tt> option enables producing Git
binary patches.  These options are currently only supported
with <tt class="docutils literal"><span class="pre">--quilt</span></tt>.</p>
<p>In <tt class="docutils literal"><span class="pre">--quilt</span></tt> mode the patches are named like the originating
topgit branch.  So usually they end up in subdirectories of the
output directory.  With the <tt class="docutils literal"><span class="pre">--flatten</span></tt> option the names are
mangled so that they end up directly in the output dir (slashes
are replaced with underscores).  With the <tt class="docutils literal"><span class="pre">--strip[=N]</span></tt> option
the first <tt class="docutils literal">N</tt> subdirectories (all if no <tt class="docutils literal">N</tt> is given) get
stripped off.  Names are always <tt class="docutils literal"><span class="pre">--strip</span></tt>'d before being
<tt class="docutils literal"><span class="pre">--flatten</span></tt>'d.  With the option <tt class="docutils literal"><span class="pre">--numbered</span></tt> (which implies
<tt class="docutils literal"><span class="pre">--flatten</span></tt>) the patch names get a number as prefix to allow
getting the order without consulting the series file, which
eases sending out the patches.</p>
<p>Note that <tt class="docutils literal">tg export</tt> is fully compatible with the <a class="reference internal" href="#wayback-machine">wayback machine</a>
and when used with the <tt class="docutils literal"><span class="pre">--collapse</span></tt> or <tt class="docutils literal"><span class="pre">--linearize</span></tt> options will
&quot;push&quot; the resulting branch back into the main repository when used in
wayback mode.</p>
<div class="line-block">
<div class="line">TODO: Make stripping of non-essential headers configurable</div>
<div class="line">TODO: <tt class="docutils literal"><span class="pre">--mbox</span></tt> option to export instead as an mbox file</div>
<div class="line">TODO: support <tt class="docutils literal"><span class="pre">--all</span></tt> option in other modes of operation</div>
<div class="line">TODO: For quilt exporting, export the linearized history created in
a temporary branch--this would allow producing conflict-less
series</div>
</div>
</blockquote>
</div>
<div class="section" id="tg-import">
<h2>tg import</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> import <span class="pre">[-d</span> <span class="pre">&lt;base-branch&gt;]</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">&lt;range&gt;...</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> import <span class="pre">[-d</span> <span class="pre">&lt;base-branch&gt;]</span> <span class="pre">[&lt;option&gt;...]</span> <span class="pre">-s</span> &lt;name&gt; &lt;commit&gt;</tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-p</span> &lt;prefix&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; prepend &lt;prefix&gt; to branch names (default is <span class="pre">'t/')</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--notes[=&lt;ref&gt;]</span>&#160;&#160;&#160;&#160; import notes ref &lt;ref&gt; to .topmsg <span class="pre">---</span> comment</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-notes</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; do not import any notes ref <span class="pre">---</span> comment (default)</tt></div>
</div>
</div>
<p>Import commits within the given revision range(s) into TopGit,
creating one topic branch per commit. The dependencies are set
up to form a linear sequence starting on your current branch --
or a branch specified by the <tt class="docutils literal"><span class="pre">-d</span></tt> parameter, if present.</p>
<p>The branch names are auto-guessed from the commit messages and
prefixed by <tt class="docutils literal">t/</tt> by default; use <tt class="docutils literal"><span class="pre">-p</span> &lt;prefix&gt;</tt> to specify an
alternative prefix (even an empty one).</p>
<p>Each &quot;&lt;range&gt;&quot; must be of the form &lt;rev1&gt;..&lt;rev2&gt; where either
&lt;rev1&gt; or &lt;rev2&gt; can be omitted to mean HEAD.  Additionally the
shortcut &lt;rev&gt;^! (see <tt class="docutils literal">git help revisions</tt>) is permitted as a
&quot;&lt;range&gt;&quot; to select the single commit &lt;rev&gt; but only if the
commit &lt;rev&gt; has <em>exactly</em> one parent.  This is really just a
shortcut for &lt;rev&gt;^..&lt;rev&gt; but somewhat safer since it will fail
if &lt;rev&gt; has other than one parent.</p>
<p>Alternatively, you can use the <tt class="docutils literal"><span class="pre">-s</span> NAME</tt> parameter to specify
the name of the target branch; the command will then take one
more argument describing a <em>single</em> commit to import which must
not be a merge commit.</p>
<p>Use the <tt class="docutils literal"><span class="pre">--notes[=&lt;ref&gt;]</span></tt> option to import the <tt class="docutils literal">git notes</tt>
associated with the commit being imported to the .topmsg file &#x2013; if
non-empty notes are present, they will be appended to the generated
.topmsg file preceded by a <tt class="docutils literal"><span class="pre">---</span></tt> separator line.  If <tt class="docutils literal">&lt;ref&gt;</tt> is
omitted then <tt class="docutils literal">refs/notes/commits</tt> will be used.  If <tt class="docutils literal">&lt;ref&gt;</tt>
does not start with <tt class="docutils literal">refs/notes/</tt> then <tt class="docutils literal">refs/notes/</tt> will be
prepended unless it starts with <tt class="docutils literal">notes/</tt> in which case only
<tt class="docutils literal">refs/</tt> will be prepended.</p>
<p>Setting the config variable <tt class="docutils literal">topgit.notesImport</tt> to a boolean or
to a <tt class="docutils literal">&lt;ref&gt;</tt> name will set the default for the <tt class="docutils literal"><span class="pre">--notes</span></tt> option
(with no config or <tt class="docutils literal"><span class="pre">--notes[=&lt;ref&gt;]</span></tt> option no <tt class="docutils literal"><span class="pre">---</span></tt> comment is
added to the generated .topmsg file by default).  To override a
<tt class="docutils literal">topgit.notesImport</tt> option and not add any <tt class="docutils literal"><span class="pre">---</span></tt> comments, use
<tt class="docutils literal"><span class="pre">--no-notes</span></tt>.</p>
</blockquote>
</div>
<div class="section" id="tg-update">
<h2>tg update</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> update <span class="pre">[--[no-]stash]</span> <span class="pre">[--skip-missing]</span> <span class="pre">([&lt;name&gt;...]</span> | <span class="pre">-a</span> <span class="pre">[&lt;pattern&gt;...])</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> update <span class="pre">--base</span> <span class="pre">[-F</span> &lt;file&gt; | <span class="pre">-m</span> &lt;msg&gt;] <span class="pre">[--[no-]edit]</span> <span class="pre">[-f]</span> <span class="pre">&lt;base-branch&gt;</span> &lt;ref&gt;</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> update <span class="pre">--continue</span> | <span class="pre">--skip</span> | <span class="pre">--stop</span> | <span class="pre">--abort</span></tt></div>
</div>
<p>Update the current, specified or all topic branches with respect
to changes in the branches they depend on and remote branches.
This is performed in two phases &#x2013; first, changes within the
dependencies are merged to the base, then the base is merged
into the topic branch.  The output will guide you on what to do
next in case of conflicts.</p>
<p>You have enabled <tt class="docutils literal">git rerere</tt> haven't you?</p>
<p>Remember the default expiration time for resolved merge conflicts is
only 60 days.  Increase their longevity by setting the Git
configuration variable <tt class="docutils literal">gc.rerereResolved</tt> to a higher number such
as <tt class="docutils literal">9999</tt> like so:</p>
<pre class="literal-block">
git config --global gc.rerereResolved 9999
</pre>
<p>The <tt class="docutils literal"><span class="pre">--[no-]auto[-update]</span></tt> options together with the
<tt class="docutils literal">topgit.setAutoUpdate</tt> config item control whether or not TopGit
will automatically temporarily set <tt class="docutils literal">rerere.autoUpdate</tt> to true while
running <tt class="docutils literal">tg update</tt>.  The default is true.  Note that this does not
enable Git's <tt class="docutils literal">rerere</tt> feature, it merely makes it automatically stage
any previously resolved conflicts.  The <tt class="docutils literal">rerere.enabled</tt> setting must
still be separately enabled (i.e. set to <tt class="docutils literal">true</tt>) for the <tt class="docutils literal">rerere</tt>
feature to do anything at all.</p>
<p>Using <tt class="docutils literal"><span class="pre">--auto[-update]</span></tt> makes <tt class="docutils literal">tg update</tt> always temporarily set
<tt class="docutils literal">rerere.autoUpdate</tt> to <tt class="docutils literal">true</tt> while running <tt class="docutils literal">tg update</tt>.  The
<tt class="docutils literal"><span class="pre">--no-auto[-update]</span></tt> option prevents <tt class="docutils literal">tg update</tt> from changing the
<tt class="docutils literal">rerere.autoUpdate</tt> setting, but if <tt class="docutils literal">rerere.autoUpdate</tt> has already
been enabled in a config file, <tt class="docutils literal">tg update</tt> never disables it even
with <tt class="docutils literal"><span class="pre">--no-auto</span></tt>.  If <tt class="docutils literal">topgit.setAutoUpdate</tt> is unset or set to
<tt class="docutils literal">true</tt> then <tt class="docutils literal">tg update</tt> implicitly does <tt class="docutils literal"><span class="pre">--auto</span></tt>, otherwise it
does <tt class="docutils literal"><span class="pre">--no-auto</span></tt>.  An explicit command line <tt class="docutils literal"><span class="pre">--[no-]auto[-update]</span></tt>
option causes the <tt class="docutils literal">topgit.setAutoUpdate</tt> setting to be ignored.</p>
<p>When both <tt class="docutils literal">rerere.enabled</tt> and <tt class="docutils literal">rerere.autoUpdate</tt> are set to true
then <tt class="docutils literal">tg update</tt> will be able to automatically continue an update
whenever <tt class="docutils literal">git rerere</tt> resolves all the conflicts during a merge.
This can be such a huge time saver.  That's why the default is to have
TopGit automatically set <tt class="docutils literal">rerere.autoUpdate</tt> to true while
<tt class="docutils literal">tg update</tt> is running (but remember, unless <tt class="docutils literal">rerere.enabled</tt> has
been set to <tt class="docutils literal">true</tt> it won't make any difference).</p>
<p>When <tt class="docutils literal"><span class="pre">-a</span></tt> (or <tt class="docutils literal"><span class="pre">--all</span></tt>) is specified, updates all topic branches
matched by <tt class="docutils literal">&lt;pattern&gt;</tt>'s (see <tt class="docutils literal">git help <span class="pre">for-each-ref</span></tt> for details),
or all if no <tt class="docutils literal">&lt;pattern&gt;</tt> is given.  Any topic branches with missing
dependencies will be skipped entirely unless <tt class="docutils literal"><span class="pre">--skip-missing</span></tt> is
specified.</p>
<p>When <tt class="docutils literal"><span class="pre">--skip-missing</span></tt> is specified, an attempt is made to update topic
branches with missing dependencies by skipping only the dependencies
that are missing.  Caveat utilitor.</p>
<p>When <tt class="docutils literal"><span class="pre">--stash</span></tt> is specified (or the <tt class="docutils literal">topgit.autostash</tt> config
value is set to <tt class="docutils literal">true</tt>), a ref stash will be automatically created
just before beginning updates if any are needed.  The <tt class="docutils literal"><span class="pre">--no-stash</span></tt>
option may be used to disable a <tt class="docutils literal">topgit.autostash=true</tt> setting.
See the <tt class="docutils literal">tg tag</tt> <tt class="docutils literal"><span class="pre">--stash</span></tt> option for details.</p>
<p>After the update, the branch which was current at the beginning of the
update is returned to.</p>
<p>If your dependencies are not up-to-date, <tt class="docutils literal">tg update</tt> will first
recurse into them and update them.</p>
<p>If a remote branch update brings in dependencies on branches
that are not yet instantiated locally, you can either bring
in all the new branches from the remote using
<tt class="docutils literal">tg remote <span class="pre">--populate</span></tt>, or only pick out the missing ones using
<tt class="docutils literal">tg create <span class="pre">-r</span></tt> (<tt class="docutils literal">tg summary</tt> will point out branches with incomplete
dependencies by showing an <tt class="docutils literal">!</tt> next to them).  TopGit will attempt to
instantiate just the missing ones automatically for you, if possible,
when <tt class="docutils literal">tg update</tt> merges in the new dependencies from the remote.</p>
<p>Using the alternative <tt class="docutils literal"><span class="pre">--base</span></tt> mode, <tt class="docutils literal">tg update</tt> will update
the base of a specified <tt class="docutils literal">[BASE]</tt> branch (which is a branch created
by <tt class="docutils literal">tg create</tt> using the <tt class="docutils literal"><span class="pre">--base</span></tt> option) to the specified
committish (the second argument) and then immediately merge that into
the branch itself using the specified message for the merge commit.
If no message is specified on the command line, an editor will open.
Unless <tt class="docutils literal"><span class="pre">--force</span></tt> is used the new value for the base must contain
the old value (i.e. be a fast-forward update).  This is for safety.</p>
<p>This mode makes updates to <tt class="docutils literal">[BASE]</tt> branches quick and easy.</p>
<p>When <tt class="docutils literal">tg update</tt> has stopped as a result of a merge conflict,
there are four possible ways to handle this situation:</p>
<blockquote>
<dl class="docutils">
<dt><tt class="docutils literal">tg update <span class="pre">--continue</span></tt></dt>
<dd>Once the merge conflict has been resolved
and committed, this will resume the
<tt class="docutils literal">tg update</tt> operation that was interrupted
by encountering the merge conflict.</dd>
<dt><tt class="docutils literal">tg update <span class="pre">--abort</span></tt></dt>
<dd>This aborts the entire <tt class="docutils literal">tg update</tt>
operation that led to the merge conflict
and undoes everything that's been changed
since that <tt class="docutils literal">tg update</tt> started.  In other
words, after <tt class="docutils literal">tg update <span class="pre">--abort</span></tt> it's as
though the <tt class="docutils literal">tg update</tt> that led to the
merge conflict was never executed at all.</dd>
<dt><tt class="docutils literal">tg update <span class="pre">--skip</span></tt></dt>
<dd>This will attempt to resume the <tt class="docutils literal">tg update</tt>
operation that was interrupted by encountering
the merge conflict by skipping the current
branch that's being updated that encountered
the merge conflict.  The branch causing the
merge conflict will still be out-of-date (since
it's skipped by this command) and can still be
updated by a future <tt class="docutils literal">tg update</tt> command.</dd>
<dt><tt class="docutils literal">tg update <span class="pre">--stop</span></tt></dt>
<dd>This stops the <tt class="docutils literal">tg update</tt> that's been
interrupted by the merge conflict by simply
removing the tg-update-in-progress state.
Everything else will be <em>left as-is!</em>  In other
words, if there's a current unresolved merge
conflict, it will still be present.  The
<tt class="docutils literal">HEAD</tt> state may be detached, etc. etc.
Use of <tt class="docutils literal">tg update <span class="pre">--stop</span></tt> is not generally
helpful except in unusual circumstances.</dd>
</dl>
</blockquote>
<div class="line-block">
<div class="line">TODO: <tt class="docutils literal">tg update <span class="pre">-a</span> <span class="pre">-c</span></tt> to autoremove (clean) up-to-date branches</div>
</div>
</blockquote>
</div>
<div class="section" id="tg-push">
<h2>tg push</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> push <span class="pre">[--dry-run]</span> <span class="pre">[--force]</span> <span class="pre">[--no-deps]</span> <span class="pre">[--tgish-only]</span> <span class="pre">[-r</span> &lt;pushRemote&gt;] <span class="pre">[-a</span> | <span class="pre">--all</span> | <span class="pre">&lt;branch&gt;...]</span></tt></div>
</div>
<p>If <tt class="docutils literal"><span class="pre">-a</span></tt> or <tt class="docutils literal"><span class="pre">--all</span></tt> was specified, pushes all non-annihilated
TopGit-controlled topic branches, to a remote repository.
Otherwise, pushes the specified topic branches &#x2013; or the
current branch, if you don't specify which.  By default, the
remote gets all the dependencies (both TopGit-controlled and
non-TopGit-controlled) and bases pushed to it too.  If
<tt class="docutils literal"><span class="pre">--tgish-only</span></tt> was specified, only TopGit-controlled
dependencies will be pushed, and if <tt class="docutils literal"><span class="pre">--no-deps</span></tt> was specified,
no dependencies at all will be pushed.</p>
<p>All TopGit branches to be pushed must be up-to-date unless the
<tt class="docutils literal"><span class="pre">--allow-outdated</span></tt> option is given.  Branches <em>are</em> checked against
the configured TopGit remote (<tt class="docutils literal">topgit.remote</tt>) if it's set (as
modified by the global <tt class="docutils literal"><span class="pre">-u</span></tt> and <tt class="docutils literal"><span class="pre">-r</span> &lt;remote&gt;</tt> options).</p>
<p>The <tt class="docutils literal"><span class="pre">--dry-run</span></tt>, <tt class="docutils literal"><span class="pre">--force</span></tt>, <tt class="docutils literal"><span class="pre">--atomic</span></tt>, <tt class="docutils literal"><span class="pre">--follow-tags</span></tt>,
<tt class="docutils literal"><span class="pre">--no-follow-tags</span></tt>, <tt class="docutils literal"><span class="pre">--signed[=...]</span></tt>, <tt class="docutils literal"><span class="pre">-4</span></tt> and <tt class="docutils literal"><span class="pre">-6</span></tt> options
are passed through directly to <tt class="docutils literal">git push</tt> if given.</p>
<p>The push remote may be specified with the <tt class="docutils literal"><span class="pre">-r</span></tt> option. If no remote
was specified, the configured default TopGit push remote will be
used (<tt class="docutils literal">topgit.pushRemote</tt>) or if that's unset the regular remote
(<tt class="docutils literal">topgit.remote</tt>).</p>
<p>Note that when pushing to a configured Git remote (i.e. it appears in
the <tt class="docutils literal">git remote</tt> output) that appears to have local tracking branches
set up for the remote TopGit branches and/or TopGit bases, <tt class="docutils literal">tg push</tt>
will attempt to make sure the local tracking branches are updated to
reflect the result of a successful <tt class="docutils literal">tg push</tt>.  This is the same as
the normal Git behavior except that <tt class="docutils literal">tg push</tt> will always attempt to
make sure that <em>both</em> the local tracking branches for the remote TopGit
branches <em>and</em> their bases are always updated together even if the
configured Git remote only has a <tt class="docutils literal">fetch</tt> refspec for one of them.  If
the remote branches are being tracked by the configured Git remote in a
non-standard local tracking branch location, it may be necessary to
issue a subsequent <tt class="docutils literal">git fetch</tt> on that remote after a successful
<tt class="docutils literal">tg push</tt> in order for them to be updated to reflect the <tt class="docutils literal">tg push</tt>.</p>
<p>Use something like this to push to an <tt class="docutils literal">origin</tt> remote when it's set
as <tt class="docutils literal">topgit.remote</tt> while only checking for local out-of-dateness:</p>
<blockquote>
<tt class="docutils literal">tg <span class="pre">-u</span> push <span class="pre">-r</span> origin <span class="pre">&lt;optional-branch-names-here&gt;</span></tt></blockquote>
</blockquote>
</div>
<div class="section" id="tg-base">
<h2>tg base</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> base <span class="pre">[--short[=&lt;n&gt;]</span> | <span class="pre">--no-short]</span> <span class="pre">[--]</span> <span class="pre">[branch...]</span></tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--short[=&lt;n&gt;]</span>&#160;&#160;&#160;&#160;&#160;&#160; display shortened hashes (default)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-short</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; display full hashes</tt></div>
</div>
</div>
<p>Prints the base commit of each of the named topic branches, or
the current branch if no branches are named.  Prints an error
message and exits with exit code 1 if the named branch is not
a TopGit branch.</p>
</blockquote>
</div>
<div class="section" id="tg-log">
<h2>tg log</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> log <span class="pre">[--compact]</span> [&lt;name&gt;] <span class="pre">[--]</span> <span class="pre">[&lt;git-log-option&gt;...]</span></tt></div>
</div>
<p>Prints the git log of the named topgit branch &#x2013; or the current
branch, if you don't specify a name.</p>
<p>This is really just a convenient shortcut for:</p>
<blockquote>
<tt class="docutils literal">git log <span class="pre">--first-parent</span> <span class="pre">--no-merges</span> $(tg base <span class="pre">&lt;name&gt;)..&lt;name&gt;</span></tt></blockquote>
<p>where <tt class="docutils literal">&lt;name&gt;</tt> is the name of the TopGit topic branch (or omitted
for the current branch).</p>
<p>However, if <tt class="docutils literal">&lt;name&gt;</tt> is a <tt class="docutils literal">[BASE]</tt> branch the <tt class="docutils literal"><span class="pre">--no-merges</span></tt>
option is omitted.</p>
<p>If <tt class="docutils literal"><span class="pre">--compact</span></tt> is used then <tt class="docutils literal">git <span class="pre">log-compact</span></tt> will be used instead
of <tt class="docutils literal">git log</tt>.  The <tt class="docutils literal"><span class="pre">--command=&lt;git-alias&gt;</span></tt> option can be used to
replace &quot;log&quot; with any non-whitespace-containing command alias name,
<tt class="docutils literal"><span class="pre">--compact</span></tt> is just a shortcut for <tt class="docutils literal"><span class="pre">--command=log-compact</span></tt>.  The
<tt class="docutils literal"><span class="pre">git-log-compact</span></tt> tool may be found on its project page located at:</p>
<blockquote>
<a class="reference external" href="https://mackyle.github.io/git-log-compact">https://mackyle.github.io/git-log-compact</a></blockquote>
<p>Note that the <tt class="docutils literal"><span class="pre">--compact</span></tt> or <tt class="docutils literal"><span class="pre">--command=</span></tt> option must be used
before any <tt class="docutils literal"><span class="pre">--</span></tt> or <tt class="docutils literal">git log</tt> options to be recognized.</p>
<p>NOTE: if you have merged changes from a different repository, this
command might not list all interesting commits.</p>
</blockquote>
</div>
<div class="section" id="tg-tag">
<h2>tg tag</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> tag <span class="pre">[&lt;option&gt;...]</span> &lt;tagname&gt; <span class="pre">[&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> tag <span class="pre">[&lt;option&gt;...]</span> <span class="pre">--refs</span> <span class="pre">[&lt;branch&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> tag <span class="pre">[&lt;option&gt;...]</span> <span class="pre">(-g</span> | <span class="pre">--reflog)</span> [&lt;tagname&gt;]</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> tag <span class="pre">--clear</span> &lt;tagname&gt;</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> tag <span class="pre">--delete</span> &lt;tagname&gt;</tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> tag <span class="pre">--drop</span> <span class="pre">&lt;tagname&gt;&#64;{n}</span></tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--refs[-only]</span>&#160;&#160;&#160;&#160;&#160;&#160; show TOPGIT REFS but do not actually create a tag</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--reflog</span> / <span class="pre">-g</span>&#160;&#160;&#160;&#160;&#160;&#160; show tag reflog instead of creating a tag</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--walk-reflogs</span>&#160;&#160;&#160;&#160;&#160; alias for <span class="pre">--reflog</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--clear</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; clear tag's reflog to &#64;{0} instead of creating a tag</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--delete</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; delete the tag and its reflog instead of creating</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--drop</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; drop the tag's specified reflog entry (no create)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--quiet</span> / <span class="pre">-q</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; suppress info messages (repeating suppresses more)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--sign</span> / <span class="pre">-s</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; create a signed tag</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--force</span> / <span class="pre">-f</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; replace existing tag with same name</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-u</span> &lt;keyid&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sign with &lt;keyid&gt; (implies <span class="pre">'--sign')</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--local-user</span> &lt;k&gt;&#160;&#160;&#160; alias for <span class="pre">'-u</span> &lt;k&gt;'</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--message</span> &lt;msg&gt;&#160;&#160;&#160;&#160; replace default tag message</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-m</span> &lt;msg&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (default message is &quot;tag ... branches <span class="pre">...&quot;)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--file</span> &lt;file&gt;&#160;&#160;&#160;&#160;&#160;&#160; replace default tag message</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-F</span> &lt;file&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; with contents of &lt;file&gt;</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--edit</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; run the editor on the default tag message (default)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-edit</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; do not run the editor on the default tag message</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--tree</span> &lt;treeish&gt;&#160;&#160;&#160; force created <span class="pre">&lt;tagname&gt;^{tree}</span> to be &lt;treeish&gt;</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use all branches for <span class="pre">&lt;branch&gt;...</span> (default is HEAD)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--allow-outdated</span>&#160;&#160;&#160; allow outdated TopGit branches to be included</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--stash</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; use refs/tgstash for &lt;tagname&gt; (implies <span class="pre">'--all')</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--reflog-message</span>&#160;&#160;&#160; use reflog message for <span class="pre">'--walk-reflogs'</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--commit-message</span>&#160;&#160;&#160; use commit message for <span class="pre">'--walk-reflogs'</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-type</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; omit <span class="pre">non-tag</span> annotation in <span class="pre">'--walk-reflogs'</span> mode</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--max-count</span> &lt;n&gt;&#160;&#160;&#160;&#160; show at most &lt;n&gt; reflog entries in <span class="pre">'-g'</span> mode</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;-n</span> &lt;n&gt; / <span class="pre">-&lt;n&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160; alias for <span class="pre">'--max-count</span> &lt;n&gt;'</tt></div>
</div>
</div>
<p>Creates a TopGit annotated/signed tag or lists the reflog of one.</p>
<p>A TopGit annotated tag records the current state of one or more TopGit
branches and their dependencies and may be used to revert to the tagged
state at any point in the future.</p>
<p>When reflogs are enabled (the default in a non-bare repository) and
combined with the <tt class="docutils literal"><span class="pre">--force</span></tt> option a single tag name may be used as a
sort of TopGit branch state stash.  The special branch name <tt class="docutils literal"><span class="pre">--all</span></tt>
may be used to tag the state of all current TopGit branches to
facilitate this function and has the side-effect of suppressing the
out-of-date check allowing out-of-date branches to be included.</p>
<p>As a special feature, <tt class="docutils literal"><span class="pre">--stash</span></tt> may be used as the tag name in which
case <tt class="docutils literal"><span class="pre">--all</span></tt> is implied if no branch name is listed (instead of the
normal default of <tt class="docutils literal">HEAD</tt>), <tt class="docutils literal"><span class="pre">--force</span></tt> and <tt class="docutils literal"><span class="pre">--no-edit</span></tt> (use
<tt class="docutils literal"><span class="pre">--edit</span></tt> to change that) are automatically activated and the tag will
be saved to <tt class="docutils literal">refs/tgstash</tt> instead of <tt class="docutils literal"><span class="pre">refs/tags/&lt;tagname&gt;</span></tt>.
The <tt class="docutils literal"><span class="pre">--stash</span></tt> tag name may also be used with the <tt class="docutils literal"><span class="pre">-g</span></tt>/<tt class="docutils literal"><span class="pre">--reflog</span></tt>
option.</p>
<p>The mostly undocumented option <tt class="docutils literal"><span class="pre">--allow-outdated</span></tt> will bypass the
out-of-date check and is implied when <tt class="docutils literal"><span class="pre">--stash</span></tt> or <tt class="docutils literal"><span class="pre">--all</span></tt> is used.</p>
<p>A TopGit annotated/signed tag is simply a Git annotated/signed tag with
a &quot;TOPGIT REFS&quot; section appended to the end of the tag message (and
preceding the signature for signed tags).  PEM-style begin and end
lines surround one line per ref where the format of each line is
full-hash SP ref-name.  A line will be included for each branch given
on the command line and each ref they depend on either directly or
indirectly.</p>
<p>Note that when specifying branch names, if a given name is ambiguous
but prefixing the branch name with <tt class="docutils literal">refs/heads/</tt> successfully
disambiguates it, then that will be the interpretation used.</p>
<p>If more than one TopGit branch is given on the command line, a new
commit will be created that has an empty tree and all of the given
TopGit branches as parents and that commit will be tagged.  If a single
TopGit branch is given, then it will be tagged.  If the <tt class="docutils literal"><span class="pre">--tree</span></tt>
option is used then it will be used instead of an empty tree (a new
commit will be created if necessary to guarantee the specified tree is
what's in the commit the newly created tag refers to).  The argument to
the <tt class="docutils literal"><span class="pre">--tree</span></tt> option may be any valid treeish.</p>
<p>If exactly one of the branches to be tagged is prefixed with a tilde
(<tt class="docutils literal">~</tt>) it will be made the first parent of a consolidation commit if
it is not already the sole commit needing to be tagged.  If <tt class="docutils literal"><span class="pre">--tree</span></tt>
is NOT used, its tree will also be used instead of the empty tree for
any new consolidation commit if one is created.  Note that if
<tt class="docutils literal"><span class="pre">--tree</span></tt> is given explicitly its tree is always used but that does
not in any way affect the choice of first parent.  Beware that the
<tt class="docutils literal">~</tt> may need to be quoted to prevent the shell from misinterpreting
it into something else.</p>
<p>All the options for creating a tag serve the same purpose as their Git
equivalents except for two.  The <tt class="docutils literal"><span class="pre">--refs</span></tt> option suppresses tag
creation entirely and emits the &quot;TOPGIT REFS&quot; section that would have
been included with the tag.  If the <tt class="docutils literal"><span class="pre">--no-edit</span></tt> option is given and
no message is supplied (via the <tt class="docutils literal"><span class="pre">-m</span></tt> or <tt class="docutils literal"><span class="pre">-F</span></tt> option) then the
default message created by TopGit will be used without running the
editor.</p>
<p>With <tt class="docutils literal"><span class="pre">-g</span></tt> or <tt class="docutils literal"><span class="pre">--reflog</span></tt> show the reflog for a tag.  With the
<tt class="docutils literal"><span class="pre">--reflog-message</span></tt> option the message from the reflog is shown.
With the <tt class="docutils literal"><span class="pre">--commit-message</span></tt> option the first line of the tag's
message (if the object is a tag) or the commit message (if the object
is a commit) falling back to the reflog message for tree and blob
objects is shown.  The default is <tt class="docutils literal"><span class="pre">--reflog-message</span></tt> unless the
<tt class="docutils literal"><span class="pre">--stash</span></tt> (<tt class="docutils literal">refs/tgstash</tt>) is being shown in which case the default
is then <tt class="docutils literal"><span class="pre">--commit-message</span></tt>.  Just add either option explicitly to
override the default.</p>
<p>When showing reflogs, non-tag entries are annotated with their type
unless <tt class="docutils literal"><span class="pre">--no-type</span></tt> is given.  Custom colors can be set with these
git config options:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th align="left" class="field-name"><tt class="docutils literal">color.tgtag</tt>:</th><td class="field-body">enable/disable color, default is <tt class="docutils literal">color.ui</tt></td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><tt class="docutils literal">color.tgtag.commit</tt>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body">hash color, dflt <tt class="docutils literal">color.diff.commit</tt>/yellow</td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><tt class="docutils literal">color.tgtag.date</tt>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body">date line color, default is bold blue</td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><tt class="docutils literal">color.tgtag.meta</tt>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body">object type &quot;color&quot;, default is bold</td>
</tr>
<tr class="field"><th align="left" class="field-name" colspan="2"><tt class="docutils literal">color.tgtag.time</tt>:</th></tr>
<tr class="field"><td>&#160;</td><td class="field-body">time info color, default is green</td>
</tr>
</tbody>
</table>
</blockquote>
<p>TopGit tags are created with a reflog if core.logallrefupdates is
enabled (the default for non-bare repositories).  Unfortunately Git
is incapable of showing an annotated/signed tag's reflog (using either
<tt class="docutils literal">git log <span class="pre">-g</span></tt> or <tt class="docutils literal">git reflog show</tt>).  Git can, however, show
reflogs for lightweight tags just fine but that's not helpful here.
Use <tt class="docutils literal">tg tag</tt> with the <tt class="docutils literal"><span class="pre">-g</span></tt> or <tt class="docutils literal"><span class="pre">--reflog</span></tt> option to see the
reflog for an actual tag object.  This also works on non-TopGit
annotated/signed tags as well provided they have a reflog.</p>
<p>Note that the time and date shown for reflog entries by <tt class="docutils literal">tg tag <span class="pre">-g</span></tt>
is the actual time and date recorded in that reflog entry itself which
usually is the time and date that entry was added to the reflog, <em>not</em>
the time and date of the commit it refers to.  Git itself will only
ever show the time and date recorded in a reflog entry when given just
the right arguments to <tt class="docutils literal">git log</tt>, but then the reflog entry's time
and date are always shown <em>in place of</em> its index number.</p>
<p>By contrast, <tt class="docutils literal">tg tag <span class="pre">-g</span></tt> always shows the reflog entry's time and
date <em>together with</em> its reflog entry index number.</p>
<p>The number of entries shown may be limited with the <tt class="docutils literal"><span class="pre">-n</span></tt> option.  If
the tagname is omitted then <tt class="docutils literal"><span class="pre">--stash</span></tt> is assumed.</p>
<p>The <tt class="docutils literal"><span class="pre">--delete</span></tt> option is a convenience option that runs the
<tt class="docutils literal">git <span class="pre">update-ref</span> <span class="pre">--no-deref</span> <span class="pre">-d</span></tt> command on the specified tag removing
it and its reflog (if it has one).  Note that <cite>HEAD</cite> cannot be removed.</p>
<p>The <tt class="docutils literal"><span class="pre">--clear</span></tt> option clears all but the most recent (the <tt class="docutils literal">&#64;{0}</tt>)
reflog entry from the reflog for the specified tag.  It's equivalent
to dropping all the higher numbered reflog entries.</p>
<p>The <tt class="docutils literal"><span class="pre">--drop</span></tt> option drops the specified reflog entry and requires the
given tagname to have an <tt class="docutils literal">&#64;{n}</tt> suffix where <tt class="docutils literal">n</tt> is the reflog
entry number to be dropped.   This is really just a convenience option
that runs the appropriate <tt class="docutils literal">git reflog delete</tt> command.  Note that
even dropping the ...&#64;{0} entry when it's the last entry of a
non-symbolic ref will NOT delete the ref itself (unless the ref was
already somehow set to an invalid object hash); but dropping &#64;{0} of
a non-symbolic ref may have the side effect of removing some stale
reflog entries that were present in the reflog.</p>
<p>Note that when combined with <tt class="docutils literal">tg revert</tt>, a tag created by <tt class="docutils literal">tg tag</tt>
can be used to transfer TopGit branches.  Simply create the tag, push
it somewhere and then have the recipient run <tt class="docutils literal">tg revert</tt> to recreate
the TopGit branches.  This may be helpful in situations where it's not
feasible to push all the refs corresponding to the TopGit-controlled
branches and their top-bases.</p>
</blockquote>
</div>
<div class="section" id="tg-rebase">
<h2>tg rebase</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> rebase <span class="pre">(-m</span> | <span class="pre">--merge)</span> <span class="pre">[&lt;git-rebase-arg&gt;...]</span></tt></div>
</div>
<p>Provides a <tt class="docutils literal">git rebase</tt> rerere auto continue function.  It may be
used as a drop-in replacement front-end for <tt class="docutils literal">git rebase <span class="pre">-m</span></tt> that
automatically continues the rebase when <tt class="docutils literal">git rerere</tt> information is
sufficient to resolve all conflicts.</p>
<p>You have enabled <tt class="docutils literal">git rerere</tt> haven't you?</p>
<p>If the <tt class="docutils literal"><span class="pre">-m</span></tt> or <tt class="docutils literal"><span class="pre">--merge</span></tt> option is not present then <tt class="docutils literal">tg rebase</tt>
will complain and not do anything.</p>
<p>When <tt class="docutils literal">git rerere</tt> is enabled, previously resolved conflicts are
remembered and can be automatically staged (see <tt class="docutils literal">rerere.autoUpdate</tt>).</p>
<p>However, even with auto staging, <tt class="docutils literal">git rebase</tt> still stops and
requires an explicit <tt class="docutils literal">git rebase <span class="pre">--continue</span></tt> to keep going.</p>
<p>In the case where <tt class="docutils literal">git rebase <span class="pre">-m</span></tt> is being used to flatten history
(such as after a <tt class="docutils literal">tg export <span class="pre">--collapse</span></tt> prior to a
<tt class="docutils literal">git <span class="pre">format-patch</span></tt>), there's a good chance all conflicts have already
been resolved during normal merge maintenance operations so there's no
reason <tt class="docutils literal">git rebase</tt> could not automatically continue, but there's no
option to make it do so.</p>
<p>The <tt class="docutils literal">tg rebase</tt> command provides a <tt class="docutils literal">git rebase <span class="pre">--auto-continue</span></tt>
function.</p>
<p>All the same rebase options can be used (they are simply passed through
to Git unchanged).  However, the <tt class="docutils literal">rerere.autoUpdate</tt> option is
automatically temporarily enabled while running <tt class="docutils literal">git rebase</tt> and
should <tt class="docutils literal">git rebase</tt> stop, asking one to resolve and continue, but all
conflicts have already been resolved and staged using rerere
information, then <tt class="docutils literal">git rebase <span class="pre">--continue</span></tt> will be automatically run.</p>
</blockquote>
</div>
<div class="section" id="tg-revert">
<h2>tg revert</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> revert <span class="pre">(-f</span> | <span class="pre">-i</span> | <span class="pre">-n)</span> <span class="pre">[&lt;opt&gt;...]</span> (&lt;tagname&gt; | <span class="pre">--stash)</span> <span class="pre">[&lt;ref&gt;...]</span></tt></div>
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> revert <span class="pre">[&lt;opt&gt;...]</span> (&lt;tagname&gt; | <span class="pre">--stash)</span> <span class="pre">[(--[topgit-]heads]</span> | <span class="pre">&lt;ref&gt;...)]</span></tt></div>
<div class="line"><br /></div>
<div class="line"><tt class="docutils literal">Options:</tt></div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--quiet</span> / <span class="pre">-q</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; suppress <span class="pre">non-dry-run</span> ref change messages</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--force</span> / <span class="pre">-f</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; force revert operation to make changes</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--dry-run</span> / <span class="pre">-n</span>&#160;&#160;&#160;&#160;&#160; show <span class="pre">'-f'</span> changes but don't actually make them</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--interactive</span> / <span class="pre">-i</span>&#160; edit revert instruction sheet before proceeding</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--list</span> / <span class="pre">-l</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; list mode (default if no <span class="pre">-f,</span> <span class="pre">-n</span> or <span class="pre">-i</span> present)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--short[=&lt;n&gt;]</span>&#160;&#160;&#160;&#160;&#160;&#160; display shortened hashes (default unless <span class="pre">--hash)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-short</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; display full hashes (default for <span class="pre">--hash-only)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--hash-only</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; show only hashes in list mode (aka <span class="pre">'--hash')</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-stash</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; skip preliminary stash before making changes</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--exclude</span> &lt;ref&gt;&#160;&#160;&#160;&#160; exclude &lt;ref&gt; during operation (may be repeated)</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--tgish-only</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; exclude <span class="pre">non-TopGit</span> branches (aka <span class="pre">'--tgish')</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--no-deps</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; do not include dependencies in revert mode</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--deps</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; include dependencies in list mode</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--rdeps</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; list relationships like 'tg summary <span class="pre">--rdeps'</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--stash</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; specifies a &lt;tagname&gt; of refs/tgstash</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--heads</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; list only <span class="pre">merge-base</span> <span class="pre">--independent</span> heads</tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--heads-independent</span> alternate spelling of <span class="pre">'--heads'</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">&#160;&#160;--topgit-heads</span>&#160;&#160;&#160;&#160;&#160; list only independent TopGit branch heads</tt></div>
</div>
</div>
<p>Provides the ability to revert one or more TopGit branches and their
dependencies to a previous state contained within a tag created using
the <tt class="docutils literal">tg tag</tt> command.  In addition to the actual revert mode
operation a list mode operation is also provided to examine a tag's ref
contents.</p>
<p>The default mode (<tt class="docutils literal"><span class="pre">-l</span></tt> or <tt class="docutils literal"><span class="pre">--list</span></tt>) shows the state of one or more
of the refs/branches stored in the tag data.  When no refs are given on
the command line, all refs in the tag data are shown.  With the special
ref name <tt class="docutils literal"><span class="pre">--heads</span></tt> then the indepedent heads contained in the tag
data are shown.  The <tt class="docutils literal"><span class="pre">--deps</span></tt> option shows the specified refs and all
of their dependencies in a single list with no duplicates.  The
<tt class="docutils literal"><span class="pre">--rdeps</span></tt> option shows a display similar to <tt class="docutils literal">tg summary <span class="pre">--rdeps</span></tt>
for each ref or all TopGit heads if no ref is given on the command
line.  The standard <tt class="docutils literal"><span class="pre">--no-short</span></tt>, <tt class="docutils literal"><span class="pre">--short=n</span></tt> etc. options may be
used to override the default <tt class="docutils literal"><span class="pre">--short</span></tt> output.  With <tt class="docutils literal"><span class="pre">--hash</span></tt> (or
<tt class="docutils literal"><span class="pre">--hash-only</span></tt>) show only the hash in <tt class="docutils literal"><span class="pre">--list</span></tt> mode in which case
the default is <tt class="docutils literal"><span class="pre">--no-short</span></tt>.   The <tt class="docutils literal"><span class="pre">--hash</span></tt> option can be used much
like the <tt class="docutils literal">git <span class="pre">rev-parse</span> <span class="pre">--verify</span></tt> command to extract a specific hash
value out of a TopGit tag.</p>
<p>Note that unlike <a class="reference internal" href="#tg-summary">tg summary</a>, here <tt class="docutils literal"><span class="pre">--heads</span></tt> actually does mean the
<tt class="docutils literal">git <span class="pre">merge-base</span> <span class="pre">--independent</span></tt> heads of the stored refs from the tag
data.  To see only the independent TopGit topic branch heads stored in
the tag data use the <tt class="docutils literal"><span class="pre">--topgit-heads</span></tt> option instead.  The default
for the <tt class="docutils literal"><span class="pre">--rdeps</span></tt> option is <tt class="docutils literal"><span class="pre">--topgit-heads</span></tt> but <tt class="docutils literal"><span class="pre">--heads</span></tt> can
be given explicitly to change that.  (Note that <tt class="docutils literal"><span class="pre">--heads-independent</span></tt>
is accepted as an alias for <tt class="docutils literal"><span class="pre">--heads</span></tt> as well.)</p>
<p>The revert mode has three submodes, dry-run mode (<tt class="docutils literal"><span class="pre">-n</span></tt> or
<tt class="docutils literal"><span class="pre">--dry-run</span></tt>), force mode (<tt class="docutils literal"><span class="pre">-f</span></tt> or <tt class="docutils literal"><span class="pre">--force</span></tt>) and interactive mode
(<tt class="docutils literal"><span class="pre">-i</span></tt> or <tt class="docutils literal"><span class="pre">--interactive</span></tt>).  If <tt class="docutils literal"><span class="pre">--dry-run</span></tt> (or <tt class="docutils literal"><span class="pre">-n</span></tt>) is given
no ref updates will actually be performed but what would have been
updated is shown instead.  If <tt class="docutils literal"><span class="pre">--interactive</span></tt> (or <tt class="docutils literal"><span class="pre">-i</span></tt>) is given
then the editor is invoked on an instruction sheet allowing manual
selection of the refs to be updated before proceeding.  Since revert is
potentially a destructive operation, at least one of the submodes must
be specified explicitly.  If no refs are listed on the command line
then all refs in the tag data are reverted.  Otherwise the listed refs
and all of their dependencies (unless <tt class="docutils literal"><span class="pre">--no-deps</span></tt> is given) are
reverted.  Unless <tt class="docutils literal"><span class="pre">--no-stash</span></tt> is given a new stash will be created
using <tt class="docutils literal">tg tag <span class="pre">--stash</span></tt> (except, of course, in dry-run mode) just
before actually performing the updates to facilitate recovery from
accidents.</p>
<p>Both modes accept fully-qualified (i.e. starts with <tt class="docutils literal">refs/</tt>) ref
names as well as unqualified names (which will be assumed to be located
under <tt class="docutils literal">refs/heads/</tt>).  In revert mode a tgish ref will always have
both its <tt class="docutils literal">refs/heads/</tt> and <tt class="docutils literal"><span class="pre">refs/top-bases/</span></tt> values included no
matter how it's listed unless <tt class="docutils literal"><span class="pre">--no-deps</span></tt> is given and the ref is
fully qualified (i.e. starts with <tt class="docutils literal">refs/</tt>) or one or the other of its
values was removed from the instruction sheet in interactive mode.  In
list mode a tgish ref will always have both its <tt class="docutils literal">refs/heads/</tt> and
<tt class="docutils literal"><span class="pre">refs/top-bases/</span></tt> values included only when using the <tt class="docutils literal"><span class="pre">--deps</span></tt> or
<tt class="docutils literal"><span class="pre">--rdeps</span></tt> options.</p>
<p>The <tt class="docutils literal"><span class="pre">--tgish-only</span></tt> option excludes non-tgish refs (i.e. refs that do
not have a <tt class="docutils literal"><span class="pre">refs/heads/&lt;name&gt;</span></tt>, <tt class="docutils literal"><span class="pre">refs/top-bases/&lt;name&gt;</span></tt> pair).</p>
<p>The <tt class="docutils literal"><span class="pre">--exclude</span></tt> option (which can be repeated) excludes specific
refs.  If the name given to <tt class="docutils literal"><span class="pre">--exclude</span></tt> is not fully-qualified (i.e.
starts with <tt class="docutils literal">refs/</tt>) then it will exclude both members of a tgish ref
pair.</p>
<p>The <tt class="docutils literal"><span class="pre">--quiet</span></tt> (or <tt class="docutils literal"><span class="pre">-q</span></tt>) option may be used in revert mode to
suppress non-dry-run ref change status messages.</p>
<p>The special tag name <tt class="docutils literal"><span class="pre">--stash</span></tt> (as well as with <tt class="docutils literal">&#64;{n}</tt> suffixes)
can be used to refer to <tt class="docutils literal">refs/tgstash</tt>.</p>
<p>The <tt class="docutils literal">tg revert</tt> command supports tags of tags that contains TopGit
refs.  So, for example, if you do this:</p>
<pre class="literal-block">
tg tag newtag --all
git tag -f -a -m &quot;tag the tag&quot; newtag newtag
</pre>
<p>Then <tt class="docutils literal">newtag</tt> will be a tag of a tag containing a <tt class="docutils literal">TOPGIT REFS</tt>
section.  <tt class="docutils literal">tg revert</tt> knows how to dereference the outermost
tag to get to the next (and the next etc.) tag to find the
<tt class="docutils literal">TOPGIT REFS</tt> section so after the above sequence, the tag <tt class="docutils literal">newtag</tt>
can still be used successfully with <tt class="docutils literal">tg revert</tt>.</p>
<p>NOTE:  If HEAD points to a ref that is updated by a revert operation
then NO WARNING whatsoever will be issued, but the index and working
tree will always be left completely untouched (and the reflog for
the pointed-to ref can always be used to find the previous value).</p>
</blockquote>
</div>
<div class="section" id="tg-shell">
<h2>tg shell</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> <span class="pre">-w</span> <span class="pre">[:]&lt;tgtag&gt;</span> shell <span class="pre">[--directory=&lt;dirpath&gt;]</span> <span class="pre">[-q]</span> <span class="pre">[--]</span> <span class="pre">[&lt;arg&gt;...]</span></tt></div>
</div>
<p>Enter extended <a class="reference internal" href="#wayback-machine">wayback machine</a> mode.</p>
<p>The global <tt class="docutils literal"><span class="pre">-w</span> &lt;tgtag&gt;</tt> option must be specified (but as a special
case for the <tt class="docutils literal">shell</tt> command a &lt;tgtag&gt; destination of <tt class="docutils literal">:</tt> may be
used to get a shell with no wayback ref changes).</p>
<p>The &quot;&lt;tgtag&gt;&quot; value must be the name of a tag created by (or known to)
<a class="reference internal" href="#tg-tag">tg tag</a>.  However, it may also have a <tt class="docutils literal">:</tt> prefixed to it to
indicate that it should prune (making it into a &quot;pruning wayback tag&quot;).
Use of a &quot;pruning wayback tag&quot; results in a repository that contains
exclusively those refs listed in the specified tag.  Otherwise the
wayback repository will just revert those refs while keeping the others
untouched (the default behavior).</p>
<p>The <a class="reference internal" href="#wayback-machine">wayback machine</a> activates as normal for the specified
destination but then a new <tt class="docutils literal"><span class="pre">${SHELL:-/bin/sh}</span></tt> is spawned in a
temporary non-bare repository directory that shares all the same
objects from the repository but has its own copy of the ref namespace
where the refs specified in the wayback destination have all been
changed to have their wayback values.</p>
<p>If any arguments are given a POSIX shell will be spawned instead
concatenating all the arguments together with a space and passing
them to it via a <tt class="docutils literal"><span class="pre">-c</span></tt> option.  If <tt class="docutils literal"><span class="pre">-q</span></tt> (or <tt class="docutils literal"><span class="pre">--quote</span></tt>) is given
then each argument will first be separately &quot;quoted&quot; to protect it from
the shell allowing something like this:</p>
<pre class="literal-block">
tg -w &lt;tgtag&gt; shell -q git for-each-ref --format=&quot;%(refname)&quot;
</pre>
<p>to work without needing to manually add the extra level of quoting that
would otherwise be required due to the parentheses.</p>
<p>Most of the repository configuration will be inherited, but some
will be overridden for safety and for convenience.  All &quot;gc&quot; activity
within the wayback repository will be suppressed to avoid accidents
(i.e. no auto gc will run and &quot;gc&quot; commands will complain and not run).</p>
<p>Override and/or bypass this safety protection at your own peril!
Especially <em>do not run</em> the <tt class="docutils literal">git prune</tt> plumbing command in the
wayback repository!  If you do so (or bypass any of the other safeties)
be prepared for corruption and loss of data in the repository.
Just <em>don't do that</em> in the first place!</p>
<p>Using <tt class="docutils literal">git <span class="pre">wayback-tag</span></tt> will show the tag used to enter the wayback
machine.  Using <tt class="docutils literal">git <span class="pre">wayback-updates</span></tt> will show ref changes that have
occurred since the wayback tag was created (it will not show refs that
have since been created unless a pruning wayback tag was used).
Finally, <tt class="docutils literal">git <span class="pre">wayback-repository</span></tt> will show the home repository but
so will <tt class="docutils literal">git remote <span class="pre">-v</span></tt> in the output displayed for the <tt class="docutils literal">wayback</tt>
remote.</p>
<p>The special <tt class="docutils literal">wayback</tt> remote refers to the original repository and
can be used to push ref changes back to it.  Note, however, that all
default push refspecs are disabled for safety and an explicit refspec
will need to be used to do so.</p>
<p>Unlike the normal <a class="reference internal" href="#wayback-machine">wayback machine</a> mode, <tt class="docutils literal">HEAD</tt> will be detached
to a new commit with an empty tree that contains the message and author
from the wayback tag used.  This prevents ugly status displays while
avoiding the need to checkout any files into the temporary working
tree.  The parent of this commit will, however, be set to the wayback
tag's commit making it easy to access if desired.</p>
<p>Also unlike the normal <a class="reference internal" href="#wayback-machine">wayback machine</a> mode, there are no
limitations on what can be done in the temporary repository.
And since it will be non-bare and writable, commands that may not have
been allowed in the original repository will work too.</p>
<p>When the shell spawned by this command exits, the temporary wayback
repository and all newly created objects and ref changes made in it, if
any, <em>will be lost</em>.  If work has been done in it that needs to be
saved, it must be pushed somewhere (even if only back to the original
repository using the special <tt class="docutils literal">wayback</tt> remote).</p>
<p>Lastly there's the <tt class="docutils literal"><span class="pre">--directory</span></tt> option.  If the <tt class="docutils literal"><span class="pre">--directory</span></tt>
option is used the temporary &quot;wayback repository&quot; will be created at
the specified location (which must either not exist or must be an empty
directory &#x2013; no force option available this time as too many things
could easily go wrong in that case).  If the <tt class="docutils literal"><span class="pre">--directory</span></tt> option is
used then the &quot;wayback repository&quot; <em>will persist</em> after <tt class="docutils literal">tg shell</tt>
completes allowing it to continue to be used!  Be warned though, all
the same warnings that apply to <tt class="docutils literal">git clone <span class="pre">--shared</span></tt> apply to such
a repository.  If it's created using a <tt class="docutils literal">tgstash</tt> tag those warnings
are especially salient.  Use a single argument of either <tt class="docutils literal">:</tt> (to
just create with no output) or <tt class="docutils literal">pwd</tt> (to show the full absolute path
to the new &quot;wayback repository&quot;) when using the <tt class="docutils literal"><span class="pre">--directory</span></tt> option
if the sole purpose is just to create the wayback repository for use.
Note that the <tt class="docutils literal"><span class="pre">--directory</span></tt> option <em>must</em> be listed as the first
option after the <tt class="docutils literal">shell</tt> command name if used.</p>
</blockquote>
</div>
<div class="section" id="tg-prev">
<h2>tg prev</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> prev <span class="pre">[-v]</span> <span class="pre">[-i</span> | <span class="pre">-w]</span> <span class="pre">[-a</span> | <span class="pre">-n</span> &lt;steps&gt;] [&lt;name&gt;]</tt></div>
</div>
<p>Output the &quot;previous&quot; branch(es) in the patch series containing the
current or named branch.  The &quot;previous&quot; branch(es) being one step
away by default.</p>
<dl class="docutils">
<dt>Options:</dt>
<dd><table class="first last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-i</span></kbd></td>
<td>use dependencies from index instead of branch</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-w</span></kbd></td>
<td>use dependencies from working tree instead of branch</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-n <var>&lt;steps&gt;</var></span></kbd></td>
<td>take <tt class="docutils literal">&lt;steps&gt;</tt> &quot;previous&quot; steps (default 1)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--all</span></kbd></td>
<td>take as many &quot;previous&quot; steps as possible (aka <tt class="docutils literal"><span class="pre">-a</span></tt>)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--verbose</span></kbd></td>
<td>show containing series name(s) (aka <tt class="docutils literal"><span class="pre">-v</span></tt>)</td></tr>
</tbody>
</table>
</dd>
</dl>
<p>The <tt class="docutils literal"><span class="pre">-n</span></tt> option may also be given as <tt class="docutils literal"><span class="pre">--count</span></tt> or <tt class="docutils literal"><span class="pre">--count=&lt;n&gt;</span></tt>.</p>
<p>To list all dependencies of a branch see the <tt class="docutils literal"><span class="pre">--deps</span></tt> option of
the <a class="reference internal" href="#tg-info">tg info</a> command.</p>
<p>See also <a class="reference internal" href="#navigation">NAVIGATION</a> for full details on &quot;previous&quot; steps.</p>
</blockquote>
</div>
<div class="section" id="tg-next">
<h2>tg next</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> next <span class="pre">[-v]</span> <span class="pre">[-i</span> | <span class="pre">-w]</span> <span class="pre">[-a</span> | <span class="pre">-n</span> &lt;steps&gt;] [&lt;name&gt;]</tt></div>
</div>
<p>Output the &quot;next&quot; branch(es) in the patch series containing the current
or named branch.  The &quot;next&quot; branch(es) being one step away by default.</p>
<dl class="docutils">
<dt>Options:</dt>
<dd><table class="first last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-i</span></kbd></td>
<td>use dependencies from index instead of branch</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-w</span></kbd></td>
<td>use dependencies from working tree instead of branch</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-n <var>&lt;steps&gt;</var></span></kbd></td>
<td>take <tt class="docutils literal">&lt;steps&gt;</tt> &quot;next&quot; steps (default 1)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--all</span></kbd></td>
<td>take as many &quot;next&quot; steps as possible (aka <tt class="docutils literal"><span class="pre">-a</span></tt>)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--verbose</span></kbd></td>
<td>show containing series name(s) (aka <tt class="docutils literal"><span class="pre">-v</span></tt>)</td></tr>
</tbody>
</table>
</dd>
</dl>
<p>The <tt class="docutils literal"><span class="pre">-n</span></tt> option may also be given as <tt class="docutils literal"><span class="pre">--count</span></tt> or <tt class="docutils literal"><span class="pre">--count=&lt;n&gt;</span></tt>.</p>
<p>To list all dependents of a branch see the <tt class="docutils literal"><span class="pre">--dependents</span></tt> option of
the <a class="reference internal" href="#tg-info">tg info</a> command.</p>
<p>See also <a class="reference internal" href="#navigation">NAVIGATION</a> for full details on &quot;next&quot; steps.</p>
</blockquote>
</div>
<div class="section" id="tg-migrate-bases">
<h2>tg migrate-bases</h2>
<blockquote>
<div class="line-block">
<div class="line"><tt class="docutils literal">tg <span class="pre">[...]</span> <span class="pre">migrate-bases</span> <span class="pre">(--dry-run</span> | <span class="pre">--force)</span> <span class="pre">[--no-remotes</span> | <span class="pre">--remotes-only]</span></tt></div>
</div>
<p>Transition top-bases from old location to new location.</p>
<p>Beginning with TopGit release 0.19.4, TopGit has the ability to store
the top-bases refs in either the old <tt class="docutils literal"><span class="pre">refs/top-bases/...</span></tt> location or
the new <tt class="docutils literal"><span class="pre">refs/heads/{top-bases}/...</span></tt> location.  Starting with TopGit
release 0.20.0, the default is the new location.</p>
<p>By storing the top-bases under heads, Git is less likely to complain
when manipulating them, hosting providers are more likely to provide
access to them and Git prevents them from pointing at anything other
than a commit object.  All in all a win for everyone.</p>
<p>TopGit attempts to automatically detect whether the new or old location
is being used for the top-bases and just do the right thing.  However,
by explicitly setting the config value <tt class="docutils literal"><span class="pre">topgit.top-bases</span></tt> to either
<tt class="docutils literal">refs</tt> for the old location or <tt class="docutils literal">heads</tt> for the new location the
auto-detection can be bypassed.  If no top-bases refs are present in
the repository the default prior to TopGit release 0.20.0 is to use the
old location but starting with TopGit release 0.20.0 the default is to
use the new location.</p>
<p>The <tt class="docutils literal">tg <span class="pre">migrate-bases</span></tt> command may be used to migrate top-bases refs
from the old location to the new location (or, by using the
undocumented <tt class="docutils literal"><span class="pre">--reverse</span></tt> option, vice versa).</p>
<p>With few exceptions (<tt class="docutils literal">tg create <span class="pre">-r</span></tt> and <tt class="docutils literal">tg revert</tt>), all top-bases
refs (both local <em>and</em> remote refs) are expected to be stored in the
same location (either new or old).  A repository's current location for
storing top-bases refs may be shown with the <tt class="docutils literal">tg <span class="pre">--top-bases</span></tt> command.</p>
</blockquote>
</div>
<div class="section" id="todo-tg-rename">
<h2>TODO: tg rename</h2>
</div>
</div>
<div class="section" id="implementation">
<h1>IMPLEMENTATION</h1>
<p>TopGit stores all the topic branches in the regular <tt class="docutils literal">refs/heads/</tt>
namespace (so we recommend distinguishing them with the <tt class="docutils literal">t/</tt> prefix).
Apart from that, TopGit also maintains a set of auxiliary refs in
<tt class="docutils literal"><span class="pre">refs/top-*</span></tt>.  Currently, only <tt class="docutils literal"><span class="pre">refs/top-bases/</span></tt> is used, containing the
current <em>base</em> of the given topic branch &#x2013; this is basically a merge of
all the branches the topic branch depends on; it is updated during <tt class="docutils literal">tg update</tt>
and then merged to the topic branch, and it is the base of a
patch generated from the topic branch by <tt class="docutils literal">tg patch</tt>.</p>
<p>All the metadata is tracked within the source tree and history of the
topic branch itself, in <tt class="docutils literal">.top*</tt> files; these files are kept isolated
within the topic branches during TopGit-controlled merges and are of
course omitted during <tt class="docutils literal">tg patch</tt>.  The state of these files in base
commits is undefined; look at them only in the topic branches
themselves.  Currently, two files are defined:</p>
<blockquote>
<dl class="docutils">
<dt><tt class="docutils literal">.topmsg</tt>:</dt>
<dd>Contains the description of the topic branch in a
mail-like format, plus the author information, whatever
Cc headers you choose or the post-three-dashes message.
When mailing out your patch, basically only a few extra
mail headers are inserted and then the patch itself is
appended.  Thus, as your patches evolve, you can record
nuances like whether the particular patch should have
To-list / Cc-maintainer or vice-versa and similar
nuances, if your project is into that.  <tt class="docutils literal">From</tt> is
prefilled from your current <tt class="docutils literal">GIT_AUTHOR_IDENT</tt>; other
headers can be prefilled from various optional
<tt class="docutils literal">topgit.*</tt> git config options.</dd>
<dt><tt class="docutils literal">.topdeps</tt>:</dt>
<dd>Contains the one-per-line list of branches this branch
depends on, pre-seeded by <tt class="docutils literal">tg create</tt>. A (continuously
updated) merge of these branches will be the <em>base</em> of
your topic branch.</dd>
</dl>
</blockquote>
<p>IMPORTANT: DO NOT EDIT <tt class="docutils literal">.topdeps</tt> MANUALLY!!! If you do so, you need to
know exactly what you are doing, since this file must stay in sync with
the Git history information, otherwise very bad things will happen.</p>
<p>TopGit also automagically installs a bunch of custom commit-related
hooks that will verify whether you are committing the <tt class="docutils literal">.top*</tt> files in a
sane state. It will add the hooks to separate files within the <tt class="docutils literal">hooks/</tt>
subdirectory, and merely insert calls to them to the appropriate hooks
and make them executable (but will make sure the original hook's code is
not called if the hook was not executable beforehand).</p>
<p>Another automagically installed piece is a <tt class="docutils literal">.git/info/attributes</tt>
specifier for an <tt class="docutils literal">ours</tt> merge strategy for the files <tt class="docutils literal">.topmsg</tt> and
<tt class="docutils literal">.topdeps</tt>, and the (intuitive) <tt class="docutils literal">ours</tt> merge strategy definition in
<tt class="docutils literal">.git/config</tt>.</p>
</div>
<div class="section" id="remote-handling">
<h1>REMOTE HANDLING</h1>
<p>There are two remaining issues with accessing topic branches in remote
repositories:</p>
<blockquote>
<ol type="i" class="lowerroman simple">
<li>Referring to remote topic branches from your local repository</li>
<li>Developing some of the remote topic branches locally</li>
</ol>
</blockquote>
<p>There are two somewhat contradictory design considerations here:</p>
<blockquote>
<ol type="a" class="loweralpha simple">
<li>Hacking on multiple independent TopGit remotes in a single
repository</li>
<li>Having a self-contained topic system in local refs space</li>
</ol>
</blockquote>
<p>To us, (a) does not appear to be very convincing, while (b) is quite
desirable for <tt class="docutils literal">git log topic</tt> etc. working, and increased conceptual
simplicity.</p>
<p>Thus, we choose to instantiate all the topic branches of given remote
locally; this is performed by <tt class="docutils literal">tg remote <span class="pre">--populate</span></tt>. <tt class="docutils literal">tg update</tt>
will also check if a branch can be updated from its corresponding remote
branch.  The logic needs to be somewhat involved if we are to &quot;do the
right thing&quot;.  First, we update the base, handling the remote branch as
if it was the first dependency; thus, conflict resolutions made in the
remote branch will be carried over to our local base automagically.
Then, the base is merged into the remote branch and the result is merged
to the local branch &#x2013; again, to carry over remote conflict resolutions.
In the future, this order might be adjustable on a per-update basis, in
case local changes happen to be diverging more than the remote ones.
(See the details in <a class="reference internal" href="#the-update-process">The Update Process</a> for more in depth coverage.)</p>
<p>All commands by default refer to the remote that <tt class="docutils literal">tg remote <span class="pre">--populate</span></tt>
was called on the last time (stored in the <tt class="docutils literal">topgit.remote</tt> git
configuration variable). You can manually run any command with a
different base remote by passing <tt class="docutils literal"><span class="pre">-r</span> REMOTE</tt> <em>before</em> the command
name or passing <tt class="docutils literal"><span class="pre">-u</span></tt> <em>before</em> the command to run without one.</p>
</div>
<div class="section" id="testing-topgit">
<h1>TESTING TOPGIT</h1>
<p>Running the TopGit test suite only requires POSIX compatible utilities (just
a POSIX compatible <tt class="docutils literal">make</tt> will do) AND a <tt class="docutils literal">perl</tt> binary.</p>
<p>It is <em>not</em> necessary to install TopGit in order to run the TopGit test suite.</p>
<p>To run the TopGit test suite, simply execute this from the top-level of a
TopGit checkout or expanded release tarball:</p>
<pre class="literal-block">
make test
</pre>
<p>Yup, that's it.  But you're probably thinking, &quot;Why have a whole section just
to say 'run make test'?&quot;  Am I right?</p>
<p>The simple <tt class="docutils literal">make test</tt> command produces a lot of output and while it is
summarized at the end there's a better way.</p>
<p>Do you have the <tt class="docutils literal">prove</tt> utility available?  You need <tt class="docutils literal">perl</tt> to run the
tests and <tt class="docutils literal">prove</tt> comes with <tt class="docutils literal">perl</tt> so you almost cerainly do.</p>
<p>Try running the tests like so:</p>
<pre class="literal-block">
make DEFAULT_TEST_TARGET=prove test
</pre>
<p>(For reference, the default value of <tt class="docutils literal">DEFAULT_TEST_TARGET</tt> is <tt class="docutils literal">test</tt> which
can be used to override a setting that's been altered using the instructions
shown later on below.)</p>
<p>If that works (you can interrupt it with <tt class="docutils literal"><span class="pre">Ctrl-C</span></tt>), try this next:</p>
<pre class="literal-block">
make DEFAULT_TEST_TARGET=prove TESTLIB_PROVE_OPTS=&quot;-j 4 --timer&quot; test
</pre>
<p>If that one works (again, you can interrupt it with <tt class="docutils literal"><span class="pre">Ctrl-C</span></tt>) that may end
up being the keeper for running the tests.</p>
<p>However, if you don't have <tt class="docutils literal">prove</tt> for some reason even though you do have
<tt class="docutils literal">perl</tt>, there's still an alternative for briefer output.  Try this:</p>
<pre class="literal-block">
make TESTLIB_TEST_OPTS=-q test
</pre>
<p>Much of the normal testing output will be suppressed and there's still a
summary at the end.  If you're stuck with this version but your make supports
parallel operation (the <tt class="docutils literal"><span class="pre">-j</span></tt> <em>&lt;n&gt;</em>) option, then you might try this:</p>
<pre class="literal-block">
make -j 4 TESTLIB_TEST_OPTS=-q test
</pre>
<p>If your make <em>does</em> support the parallel <tt class="docutils literal"><span class="pre">-j</span></tt> option but still seems to be
only running one test at a time try it like this instead:</p>
<pre class="literal-block">
make TESTLIB_MAKE_OPTS=&quot;-j 4&quot; TESTLIB_TEST_OPTS=-q test
</pre>
<p>The difference is that <tt class="docutils literal">make <span class="pre">-j</span> 4</tt> relies on make to properly pass down the
parallel job option all the way down to the sub-make that runs the individual
tests when not using prove.  Putting the options in <tt class="docutils literal">TESTLIB_MAKE_OPTS</tt>
passes them directly to that (and only that) particular invocation of make.</p>
<p>The final bit of advice for running the tests is that any of those <tt class="docutils literal">make</tt>
variable settings can be enabled by default in a top-level <tt class="docutils literal">config.mak</tt> file.</p>
<p>For example, to make the <tt class="docutils literal">prove <span class="pre">-j</span> 4 <span class="pre">--timer</span></tt> (my personal favorite) the
default when running the tests, add these lines (creating the file if it does
not already exist) to the <tt class="docutils literal">config.mak</tt> file located in the top-level of the
TopGit checkout (or expanded release tarball):</p>
<pre class="literal-block">
# config.mak file
# comments are allowed (if preceded by '#')
# so are blank lines

DEFAULT_TEST_TARGET = prove
TESTLIB_PROVE_OPTS = -j 4 --timer
#TESTLIB_TEST_OPTS = --color # force colorized test output
</pre>
<p>Now simply doing <tt class="docutils literal">make test</tt> will use those options by default.</p>
<p>There is copious documentation on the testing library and other options in
the various <tt class="docutils literal">README</tt> files located in the <tt class="docutils literal">t</tt> subdirectory.  The
<tt class="docutils literal">Makefile.mak</tt> file in the <tt class="docutils literal">t</tt> subdirectory contains plenty of comments
about possible makefile variable settings as well.</p>
</div>
<div class="section" id="technical">
<h1>TECHNICAL</h1>
<p>A familiarity with the terms in the <a class="reference internal" href="#glossary">GLOSSARY</a> is helpful for understanding the
content of this section.  See also the <a class="reference internal" href="#implementation">IMPLEMENTATION</a> section.</p>
<div class="section" id="the-update-process">
<h2>The Update Process</h2>
<p>When a branch is &quot;updated&quot; using the <tt class="docutils literal">tg update</tt> command the following steps
are taken:</p>
<blockquote>
<ol class="arabic simple">
<li>The branch and all of its dependencies (and theirs recursively)
are checked to see which ones are <em>out-of-date</em>.  See <a class="reference internal" href="#glossary">glossary</a>.</li>
<li>Each of the branch's direct dependencies (i.e. they are listed in
the branch's <tt class="docutils literal">.topdeps</tt> file) which is out of date is updated
before proceeding (yup, this is a recursive process).  If the
branch has a corresponding remote branch and that remote branch
has removed one or more direct dependencies, then those
remote-removed dependencies are automatically skipped at this
stage even though the remote branch's .topdeps file will not
actually be merged into the local branch until step (5).</li>
<li>Each of the branch's direct dependencies (i.e. they are listed in
the branch's <tt class="docutils literal">.topdeps</tt> file) that was updated in the previous
step is now merged into the branch's corresponding base.  If a
remote is involved, and the branch's corresponding base does NOT
contain the remote branch's corresponding base that remote base
is also merged into the branch's base at this time as well (it
will be the first item merged into the branch's base).  As with
the previous step, any remote-removed dependencies, if any, are
automatically skipped at this stage.</li>
<li>If the branch has a corresponding remote branch and the branch
does not already contain it, the branch's base (which was possibly
already updated in step (3) to contain the remote branch's base but
not the remote branch itself) is merged into the remote branch on a
detached HEAD.  Yup, this step can be a bit confusing and no, the
updated base from step (3) has not yet been merged into the branch
itself yet either.  If there is no remote branch this step does not
apply.  Using a detached HEAD allows the contents of the base to be
merged into the remote branch without actually perturbing the base's
or remote branch's refs.</li>
<li>If there is a remote branch present then use the result of step (4)
otherwise use the branch's base and merge that into the branch
itself.</li>
</ol>
</blockquote>
<p>That's it!  Simple, right? ;)</p>
<p>Unless the auto stash option has been disabled (see <a class="reference internal" href="#no-undo">no undo</a>, <a class="reference internal" href="#tg-update">tg update</a>
and <a class="reference internal" href="#tg-tag">tg tag</a>), a copy of all the old refs values will be stashed away
immediately after step (1) before starting step (2), but only if anything is
actually found to be out-of-date.</p>
</div>
<div class="section" id="merge-strategies">
<h2>Merge Strategies</h2>
<p>The <tt class="docutils literal">tg update</tt> command regularly performs merges while executing an update
operation.  In order to speed things up, it attempts to do in-index merges
where possible.  It accomplishes this by using a separate, temporary index
file and the <tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt> command possibly assisted by
the <tt class="docutils literal">git <span class="pre">merge-index</span></tt> and <tt class="docutils literal">git <span class="pre">merge-file</span></tt> commands.  This combination may
be repeated more than once to perform an octopus in-index merge.  If this
fails, the files are checked out and a normal <tt class="docutils literal">git merge</tt> three-way merge is
performed (possibly multiple times).  If the normal <tt class="docutils literal">git merge</tt> fails then
user intervention is required to resolve the merge conflict(s) and continue.</p>
<p>Since the <tt class="docutils literal">tg annihilate</tt>, <tt class="docutils literal">tg create</tt> and <tt class="docutils literal">tg depend add</tt> commands may
end up running the <tt class="docutils literal">tg update</tt> machinery behind the scenes to complete their
operation they may also result in any of these merge strategies being used.</p>
<p>In addition to the normal Git merge strategies (if the in-index merging fails),
there are four possible TopGit merge strategies that may be shown.  Since they
all involve use of the <tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt> command they are all
variations of a &quot;trivial aggressive&quot; merge.  The &quot;trivial&quot; part because all of
the merges done by <tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span></tt> are described as &quot;trivial&quot; and the
&quot;aggressive&quot; part because the <tt class="docutils literal"><span class="pre">--aggressive</span></tt> option is always used.</p>
<blockquote>
<ol class="arabic">
<li><dl class="first docutils">
<dt>&quot;trivial aggressive&quot;</dt>
<dd><p class="first last">Only two heads were involved and all merging was completed by
the <tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt> command.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&quot;trivial aggressive automatic&quot;</dt>
<dd><p class="first last">Only two heads were involved but after the
<tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt> command completed there were
still unresolved items and <tt class="docutils literal">git <span class="pre">merge-index</span></tt> had to be run
(using the <tt class="docutils literal">tg <span class="pre">index-merge-one-file</span></tt> driver) which ultimately
ran <tt class="docutils literal">git <span class="pre">merge-file</span></tt> at least once to perform a simple
automatic three-way merge.  Hence the &quot;automatic&quot; description
and the &quot;Auto-merging ...&quot; output line(s).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&quot;trivial aggressive octopus&quot;</dt>
<dd><p class="first last">This is the same as a &quot;trivial aggressive&quot; merge except that
more than two heads were involved and after merging the first
two heads, the <tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt> step was
repeated again on the result for each additional head.  All
merging was completed via multiple
<tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt> commands only.
This beast is relatively rare in the wild.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&quot;trivial aggressive automatic octopus&quot;</dt>
<dd><p class="first last">This is very similar to the &quot;trivial aggressive octopus&quot;
except that at least one of the <tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt>
commands left unresolved items that were handled the same way
as the &quot;trivial aggressive automatic&quot; strategy.  This species
is commonly seen in the wild.</p>
</dd>
</dl>
</li>
</ol>
</blockquote>
</div>
</div>
<div class="section" id="glossary">
<h1>GLOSSARY</h1>
<blockquote>
<dl class="docutils">
<dt>.topmsg</dt>
<dd>Version-controlled file stored at the root level of each
TopGit branch that contains the patch header for a TopGit
branch.  See also <a class="reference internal" href="#implementation">IMPLEMENTATION</a>.</dd>
<dt>.topdeps</dt>
<dd>Version-controlled file stored at the root level of each
TopGit branch that lists the branch's dependencies one per
line omitting the leading <tt class="docutils literal">refs/heads/</tt> part.  See also
<a class="reference internal" href="#implementation">IMPLEMENTATION</a>.</dd>
<dt>3-way merge</dt>
<dd>See three-way merge.</dd>
<dt>branch containment</dt>
<dd>Given two Git commit identifiers (e.g. hashes) C1 and C2,
commit C1 &quot;contains&quot; commit C2 if either they are the same
commit or C2 can be reached from C1 by following one or more
parent links from C1 (perhaps via one or more intermediate
commits along the way).  In other words, if C1 contains C2
then C2 is an ancestor of C1 or conversely C1 is a descendant
of C2.  Since a TopGit branch name is also the name of a Git
branch (something located under the <tt class="docutils literal">refs/heads</tt> Git
namespace) and similarly for a TopGit base, they can both be
resolved to a Git commit identifier and then participate in
a branch containment test.  An easy mnemonic for this is
&quot;children contain the genes of their parents.&quot;</dd>
<dt>BRE pattern</dt>
<dd>A Basic Regular Expression (BRE) pattern.  These are older
style regular expressions but have the advantage that all
characters other than <tt class="docutils literal">\</tt>, <tt class="docutils literal">.</tt>, <tt class="docutils literal">*</tt> and <tt class="docutils literal">[</tt>
automatically match themselves without need for backslash
quoting (well actually, <tt class="docutils literal">^</tt> and <tt class="docutils literal">$</tt> are special at the
beginning and end respectively but otherwise match themselves).</dd>
<dt>contains</dt>
<dd>See branch containment.</dd>
<dt>ERE pattern</dt>
<dd>An Extended Regular Expression (ERE) pattern.  These are newer
style regular expressions where all the regular expression
&quot;operator&quot; characters &quot;operate&quot; when NOT preceded by a
backslash and are turned into normal characters with a <tt class="docutils literal">\</tt>.
The backreference atom, however, may not work, but <tt class="docutils literal">?</tt>, <tt class="docutils literal">+</tt>
and <tt class="docutils literal">|</tt> &quot;operators&quot; do; unlike BREs.</dd>
<dt>TopGit</dt>
<dd>Excellent system for managing a history of changes to one
or more possibly interrelated patches.</dd>
<dt>TopGit branch</dt>
<dd>A Git branch that has an associated TopGit base.  Conceptually
it represents a single patch that is the difference between
the associated TopGit base and the TopGit branch.  In other
words <tt class="docutils literal">git <span class="pre">diff-tree</span> &lt;TopGit base&gt; &lt;TopGit branch&gt;</tt> except
that any <tt class="docutils literal">.topdeps</tt> and/or <tt class="docutils literal">.topmsg</tt> files are excluded
from the result and the contents of the <tt class="docutils literal">.topmsg</tt> file from
the TopGit branch is prefixed to the result.</dd>
<dt>TopGit bare branch</dt>
<dd>A Git branch whose tree does NOT contain any <tt class="docutils literal">.topdeps</tt> or
<tt class="docutils literal">.topmsg</tt> entries at the top-level of the tree.  It <em>does</em>
always have an associated &quot;TopGit base&quot; ref (otherwise it would
not be a &quot;TopGit&quot; branch).  See also <a class="reference internal" href="#bare-branches">BARE BRANCHES</a>.</dd>
<dt>bare branch</dt>
<dd>In TopGit context, &quot;bare branch&quot; almost always refers to a
&quot;TopGit bare branch&quot; and should be understood to mean such even
if the leading &quot;TopGit&quot; has been left off.</dd>
<dt>TopGit base</dt>
<dd><p class="first">A Git branch that records the base upon which a TopGit branch's
single conceptual &quot;patch&quot; is built.  The name of the Git branch
is derived from the TopGit branch name by stripping off the
leading <tt class="docutils literal">refs/heads/</tt> and prepending the correct prefix where
all TopGit bases are stored (typically either
<tt class="docutils literal"><span class="pre">refs/top-bases/</span></tt> or <tt class="docutils literal"><span class="pre">refs/heads/{top-bases}/</span></tt> &#x2013; the
prefix for any given repository can be shown by using the
<tt class="docutils literal">tg <span class="pre">--top-bases</span></tt> command and updated using the
<tt class="docutils literal">tg <span class="pre">migrate-bases</span></tt> command).</p>
<p class="last">All of a TopGit branch's dependencies are merged into the
corresponding TopGit base during a <tt class="docutils literal">tg update</tt> of a branch.</p>
</dd>
<dt>base</dt>
<dd>See TopGit base.</dd>
<dt>TopGit <tt class="docutils literal">[PATCH]</tt> branch</dt>
<dd>A TopGit branch whose subject starts with <tt class="docutils literal">[PATCH]</tt>.  By
convention these TopGit branches contain a single patch
(equivalent to a single patch file) and have at least one
dependency (i.e. their <tt class="docutils literal">.topdeps</tt> files are never empty).</dd>
<dt>TopGit <tt class="docutils literal">[BASE]</tt> branch</dt>
<dd>A TopGit branch whose subject starts with <tt class="docutils literal">[BASE]</tt>.  By
convention these TopGit branches do not actually contain
any changes and their <tt class="docutils literal">.topdeps</tt> files are empty.  They
are used to control a base dependency that another set of
branches depends on.  Sometimes these are named <tt class="docutils literal">[RELEASE]</tt>
instead because the base dependency they represent is actually
the formal release of something.</dd>
<dt>TopGit <tt class="docutils literal">[ROOT]</tt> branch</dt>
<dd>A TopGit branch whose subject starts with <tt class="docutils literal">[ROOT]</tt>.  By
convention these TopGit branches do not actually contain
any changes and their <tt class="docutils literal">.topdeps</tt> files are empty.  They
are <tt class="docutils literal">[BASE]</tt> branches where the base commit has no parent.
In other words, the base commit is a <tt class="docutils literal">root</tt> commit.</dd>
<dt>TopGit <tt class="docutils literal">[STAGE]</tt> branch</dt>
<dd>A TopGit branch whose subject starts with <tt class="docutils literal">[STAGE]</tt>.  By
convention these TopGit branches do not actually contain any
changes of their own but do have one or (typically) more
dependencies in their <tt class="docutils literal">.topdeps</tt> file.  These branches are
used to bring together one or (typically) more independent
TopGit <tt class="docutils literal">[PATCH]</tt> branches into a single branch so that
testing and/or evaluation can be performed on the result.
Sometimes these are named <tt class="docutils literal">[RELEASE]</tt> when a full release
is being made from the result.</dd>
<dt>merge conflict</dt>
<dd>When merging two (or more) heads that touch the same lines in
the file but in different ways the result is a merge conflict
that requires manual intervention.  If a merge conflict occurs
with more than two heads (an octopus merge) it's generally
replaced by multiple three-way merges so that by the time a
user sees a merge conflict needing manual resolution, there
will be only two heads involved.</dd>
<dt>merge strategy</dt>
<dd>A Git merge strategy (see the &quot;MERGE STRATEGIES&quot; section of
<tt class="docutils literal">git help merge</tt>) or one of the TopGit <a class="reference internal" href="#merge-strategies">merge strategies</a>
used to merge two or more heads.</dd>
<dt>TopGit merge strategy</dt>
<dd>See the <a class="reference internal" href="#merge-strategies">Merge Strategies</a> section above for details but
basically these are just in-index merges done using the
<tt class="docutils literal">git <span class="pre">read-tree</span> <span class="pre">-m</span> <span class="pre">--aggressive</span></tt> command one or more times
possibily assisted by the <tt class="docutils literal">git <span class="pre">merge-index</span></tt> and the
<tt class="docutils literal">git <span class="pre">merge-file</span></tt> commands.</dd>
<dt>next branch</dt>
<dd>In TopGit context the &quot;next&quot; branch refers to the branch that
corresponds to the next (aka following) patch in an ordered
(aka linearized) list of patches created by exporting the
TopGit branches in patch application order.</dd>
<dt>octopus merge</dt>
<dd>A merge involving more than two heads.  Note that if there are
less than three independent heads the resulting merge that
started out as an octopus will end up not actually being an
octopus after all.</dd>
<dt>out-of-date branch</dt>
<dd><p class="first">A TopGit branch is considered to be &quot;out-of-date&quot; when ANY of
the following are true:</p>
<blockquote>
<ol type="a" class="loweralpha simple">
<li>The TopGit branch does NOT contain its
corresponding base.</li>
<li>The TopGit branch does NOT contain its
corresponding remote branch (there may not be
a remote branch in which case this does not apply).</li>
<li>The TopGit branch's base does NOT contain its
corresponding remote branch's base (there may not be
a remote branch in which case this does not apply).</li>
<li>Any of the TopGit branches listed in the branch's
<tt class="docutils literal">.topdeps</tt> file are NOT contained by the branch's
base (see &quot;branch containment&quot; above).</li>
<li>Any of the TopGit branches listed in the branch's
<tt class="docutils literal">.topdeps</tt> file are out-of-date.</li>
</ol>
</blockquote>
<p class="last">Note that if a remote branch is present and is NOT out-of-date
then it will contain its own base and (c) is mostly redundant.</p>
</dd>
<dt>previous branch</dt>
<dd>In TopGit context the &quot;previous&quot; (or &quot;prev&quot;) branch refers to
the branch that corresponds to the previous (aka preceding)
patch in an ordered (aka linearized) list of patches created by
exporting the TopGit branches in patch application order.</dd>
<dt>remote TopGit branch</dt>
<dd>A Git branch with the same branch name as a TopGit branch
but living under <tt class="docutils literal"><span class="pre">refs/remotes/&lt;some</span> remote&gt;/</tt> instead
of just <tt class="docutils literal">refs/heads/</tt>.</dd>
<dt>remote TopGit base</dt>
<dd>The TopGit base branch corresponding to a remote TopGit branch,
which lives under <tt class="docutils literal">refs/remotes/</tt> somewhere (depending on
what the output of <tt class="docutils literal">tg <span class="pre">--top-bases</span></tt> is for that remote).</dd>
<dt>three-way merge</dt>
<dd>A three-way merge takes a common base and two heads (call them
A and B) and creates a new file that is the common base plus
all of the changes made between the common base and head A
<em>AND</em> all of the changes made between the common base and
head B.  The technique used to accomplish this is called a
&quot;merge strategy&quot;.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="references">
<h1>REFERENCES</h1>
<p>The following references are useful to understand the development of
topgit and its commands.</p>
<ul class="simple">
<li>tg depend:
<a class="reference external" href="https://lore.kernel.org/git/36ca99e90904091034m4d4d31dct78acb333612e678&#64;mail.gmail.com/T/#u">https://lore.kernel.org/git/36ca99e90904091034m4d4d31dct78acb333612e678&#64;mail.gmail.com/T/#u</a></li>
</ul>
</div>
<div class="section" id="third-party-software">
<h1>THIRD-PARTY SOFTWARE</h1>
<p>The following software understands TopGit branches:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/magit/magit">Magit</a> - a git mode for emacs
with the <a class="reference external" href="https://github.com/greenrd/magit-topgit">Magit TopGit mode</a>
that may, perhaps, be a bit outdated.</li>
</ul>
<p>IMPORTANT: Magit requires its topgit mode to be enabled first, as
described in its documentation, in the &quot;Activating extensions&quot;
subsection.  If this is not done, it will not push TopGit branches
correctly, so it's important to enable it even if you plan to mostly use
TopGit from the command line.</p>
</div>
</div>
</div>
</body>
</html>
